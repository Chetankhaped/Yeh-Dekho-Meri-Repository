import{j as e,r as m,R as ve}from"./react-DlxZUTCp-1759842755623.js";import{c as es}from"./react-dom-BWzp29CS-1759842755623.js";import{u as pe,a as J,P as ts}from"./react-redux-C-P98Gb2-1759842755623.js";import{L as oe,u as ss,B as rs}from"./react-router-dom-Bdb-ckRu-1759842755623.js";import{c as ce,a as at,b as is}from"./reduxjs-toolkit-DTP-xSya-1759842755623.js";import{a as as}from"./axios-ngrFHoWO-1759842755623.js";import{b as je,a as Et,d as jt,e as wt,f as ns,g as me}from"./react-router-BPxH7IWH-1759842755623.js";import{c as os}from"./class-variance-authority-BZNqoTUr-1759842755623.js";import{c as ls}from"./clsx-B-dksMZM-1759842755623.js";import{t as cs}from"./tailwind-merge-yGZq-iow-1759842755623.js";import{D as We,S as Le,E as qe,B as et,C as Lt,L as tt,a as pt,b as Mt,G as St,Z as Nt,F as Re,A as st,c as Pt,d as fe,P as He,U as gt,T as Me,e as ke,f as Ve,g as be,h as ze,i as nt,j as kt,k as ds,l as us,R as ms,m as hs,n as ps,M as gs,o as fs,p as It,q as xs,r as Bt,s as ot,t as ys,u as bs,v as vs,w as js,x as ws,V as Ss,y as Ns}from"./lucide-react-Bwb7aIZ5-1759842755623.js";import{f as xe,n as _e,d as ks,T as As,m as Cs,r as zs}from"./face-api.js-CFXGeRpd-1759842755623.js";import"./tensorflow-tfjs-core-DKl9eqPX-1759842755623.js";import{d as Ts}from"./ricky0123-vad-BGK2Sb9V-1759842755623.js";import{F as Fs}from"./monaco-editor-react-C3bfXoxn-1759842755623.js";import{c as Rs,p as Ds}from"./zustand-BLmaKcqL-1759842755623.js";import{T as Es,I as Ls,S as Ms,a as Ps,P as Is,C as Bs,V as Ws,L as _s,b as Us,c as $s,d as qs,e as Hs,R as Vs,f as Os}from"./radix-ui-react-select-DtCo-LZI-1759842755623.js";import{L as Qs,T as Gs,C as Ys,R as Js}from"./radix-ui-react-tabs-CQ0hlUYY-1759842755623.js";import"./onnxruntime-web-BS86J_hp-1759842755623.js";import"./scheduler-DYLXRpC5-1759842755623.js";import"./use-sync-external-store-CdemCVNx-1759842755623.js";import"./remix-run-router-Ci2Y9YYq-1759842755623.js";import"./redux-BXkGT1VS-1759842755623.js";import"./immer-dvkNig1Z-1759842755623.js";import"./redux-thunk-ClJT1hhx-1759842755623.js";import"./tslib-Jgn7YJSQ-1759842755623.js";import"./monaco-editor-loader-D5VDKzXM-1759842755623.js";import"./state-local-BBNhjlcY-1759842755623.js";import"./radix-ui-number-BdQq_4o_-1759842755623.js";import"./radix-ui-primitive-DW48STyt-1759842755623.js";import"./radix-ui-react-collection-C9fGmzhw-1759842755623.js";import"./radix-ui-react-context-kYYdm0ok-1759842755623.js";import"./radix-ui-react-compose-refs-CnW39phI-1759842755623.js";import"./radix-ui-react-slot-BP7OAlfj-1759842755623.js";import"./radix-ui-react-direction-DEpR-Iog-1759842755623.js";import"./radix-ui-react-dismissable-layer-BWersoD5-1759842755623.js";import"./radix-ui-react-primitive-Ccmd2lZ3-1759842755623.js";import"./radix-ui-react-use-callback-ref-DB2ALkkA-1759842755623.js";import"./radix-ui-react-use-escape-keydown-CpTyq2Wz-1759842755623.js";import"./radix-ui-react-focus-guards-J_Fwq7HK-1759842755623.js";import"./radix-ui-react-focus-scope-BnBQ6r0f-1759842755623.js";import"./radix-ui-react-id-CMmDLGWl-1759842755623.js";import"./radix-ui-react-use-layout-effect-BLBHhQJC-1759842755623.js";import"./radix-ui-react-popper-nWFZBPzI-1759842755623.js";import"./floating-ui-react-dom-CVt6gxss-1759842755623.js";import"./floating-ui-dom-BjyBBDsT-1759842755623.js";import"./floating-ui-core-Bwhz63HV-1759842755623.js";import"./floating-ui-utils-ye2j5HVc-1759842755623.js";import"./radix-ui-react-arrow-CSKvvd4u-1759842755623.js";import"./radix-ui-react-use-size-CA34Ld29-1759842755623.js";import"./radix-ui-react-portal-DftVdmLB-1759842755623.js";import"./radix-ui-react-use-controllable-state-BwNldZ2N-1759842755623.js";import"./radix-ui-react-use-previous-BDa4Vmv3-1759842755623.js";import"./radix-ui-react-visually-hidden-Bi8kDfLI-1759842755623.js";import"./aria-hidden-DvXkyWUv-1759842755623.js";import"./react-remove-scroll-DQX7clLU-1759842755623.js";import"./react-remove-scroll-bar-CNq0fS3a-1759842755623.js";import"./react-style-singleton-BnlMSeKT-1759842755623.js";import"./get-nonce-C-Z93AgS-1759842755623.js";import"./use-sidecar-BwhRgdM9-1759842755623.js";import"./use-callback-ref-VNxSiPgx-1759842755623.js";import"./radix-ui-react-roving-focus-FRCww80J-1759842755623.js";import"./radix-ui-react-presence-CGyXrRVK-1759842755623.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function s(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=s(i);fetch(i.href,n)}})();const Ks="http://localhost:4000",ie=as.create({baseURL:Ks,withCredentials:!1}),Qe=a=>{a?ie.defaults.headers.common.Authorization=`Bearer ${a}`:delete ie.defaults.headers.common.Authorization},Ge="qp_token",ft=localStorage.getItem(Ge);ft&&Qe(ft);const ut=(a={})=>({...a,faceDescriptor:a.referenceDescriptor||null,hasReferenceFace:!!(a.hasReferenceFace||a.referenceDescriptor),referenceDescriptor:a.referenceDescriptor||null}),Ye=ce("auth/register",async(a,{rejectWithValue:t})=>{var s;try{const{data:r}=await ie.post("/api/auth/register",a);return r}catch(r){return t(((s=r.response)==null?void 0:s.data)||{message:"Registration failed"})}}),Je=ce("auth/login",async(a,{rejectWithValue:t})=>{var s;try{const{data:r}=await ie.post("/api/auth/login",a);return r}catch(r){return t(((s=r.response)==null?void 0:s.data)||{message:"Login failed"})}}),Ke=ce("auth/loadProfile",async(a,{rejectWithValue:t})=>{var s;try{const{data:r}=await ie.get("/api/auth/me");return r}catch(r){return t(((s=r.response)==null?void 0:s.data)||{message:"Unable to load profile"})}}),Ue=ce("auth/verifyFace",async(a,{rejectWithValue:t})=>{var s;try{const{data:r}=await ie.post("/api/auth/verify-face",{descriptor:a});return r}catch(r){return t(((s=r.response)==null?void 0:s.data)||{message:"Face verification failed"})}}),Wt=at({name:"auth",initialState:{user:null,token:ft||null,status:"idle",error:null,verificationStatus:"idle",verificationError:null},reducers:{logout(a){a.user=null,a.token=null,localStorage.removeItem(Ge),Qe(null),a.verificationStatus="idle",a.verificationError=null}},extraReducers:a=>{a.addCase(Ye.pending,t=>{t.status="loading",t.error=null}).addCase(Ye.fulfilled,(t,s)=>{t.status="succeeded",t.user={...ut(s.payload.user),isFaceVerified:!1},t.token=s.payload.token,localStorage.setItem(Ge,s.payload.token),Qe(s.payload.token),t.verificationStatus="idle",t.verificationError=null}).addCase(Ye.rejected,(t,s)=>{var r;t.status="failed",t.error=((r=s.payload)==null?void 0:r.message)||"Registration failed"}).addCase(Je.pending,t=>{t.status="loading",t.error=null}).addCase(Je.fulfilled,(t,s)=>{t.status="succeeded",t.user={...ut(s.payload.user),isFaceVerified:!1},t.token=s.payload.token,localStorage.setItem(Ge,s.payload.token),Qe(s.payload.token),t.verificationStatus="idle",t.verificationError=null}).addCase(Je.rejected,(t,s)=>{var r;t.status="failed",t.error=((r=s.payload)==null?void 0:r.message)||"Login failed"}).addCase(Ke.pending,t=>{t.status="loading"}).addCase(Ke.fulfilled,(t,s)=>{var n;t.status="succeeded";const r=((n=t.user)==null?void 0:n.isFaceVerified)??!1,i=ut(s.payload);t.user={...t.user,...i,isFaceVerified:r&&!!i.hasReferenceFace}}).addCase(Ke.rejected,(t,s)=>{var r;t.status="failed",t.error=((r=s.payload)==null?void 0:r.message)||"Unable to load profile"}).addCase(Ue.pending,t=>{t.verificationStatus="loading",t.verificationError=null}).addCase(Ue.fulfilled,t=>{t.verificationStatus="succeeded",t.verificationError=null,t.user&&(t.user.isFaceVerified=!0)}).addCase(Ue.rejected,(t,s)=>{var r;t.verificationStatus="failed",t.verificationError=((r=s.payload)==null?void 0:r.message)||"Face verification failed",t.user&&(t.user.isFaceVerified=!1)})}}),{logout:Xs}=Wt.actions,Zs=Wt.reducer,er="/assets/Logo-lEGE9mBY-1759842755623.png",tr=()=>{const a=pe(),t=je(),{user:s}=J(i=>i.auth),r=()=>{a(Xs()),t("/login")};return e.jsx("header",{style:{padding:"1rem 1.5rem",background:"#ff9248",color:"#fff"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(oe,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.75rem",fontWeight:700,fontSize:"1.2rem",color:"#fff",textDecoration:"none"},children:[e.jsx("img",{src:er,alt:"Pentacore Solutions Logo",style:{height:"2.5rem",width:"auto",objectFit:"contain"}}),e.jsx("span",{children:"Pentacore Solutions"})]}),e.jsx("nav",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:s?e.jsxs(e.Fragment,{children:[e.jsx(oe,{to:"/dashboard",style:{color:"#fff",textDecoration:"none",fontWeight:500,padding:"0.5rem 1.25rem",borderRadius:"8px",background:"#3b82f6",transition:"background 0.2s",display:"inline-block",border:"none",fontSize:"0.95rem"},onMouseEnter:i=>i.target.style.background="#2563eb",onMouseLeave:i=>i.target.style.background="#3b82f6",children:"Dashboard"}),s.role==="student"&&e.jsx(oe,{to:"/face-enrollment",style:{color:"#fff",textDecoration:"none",fontWeight:500,padding:"0.5rem 1.25rem",borderRadius:"8px",background:s.isFaceVerified?"#10b981":"#f59e0b",transition:"background 0.2s",display:"inline-block",border:"none",fontSize:"0.95rem"},onMouseEnter:i=>i.target.style.background=s.isFaceVerified?"#059669":"#d97706",onMouseLeave:i=>i.target.style.background=s.isFaceVerified?"#10b981":"#f59e0b",children:s.isFaceVerified?"‚úì Verified":"Verify Face"}),e.jsx(oe,{to:"/about",style:{color:"#fff",textDecoration:"none",fontWeight:500,padding:"0.5rem 1.25rem",borderRadius:"8px",background:"#8b5cf6",transition:"background 0.2s",display:"inline-block",border:"none",fontSize:"0.95rem"},onMouseEnter:i=>i.target.style.background="#7c3aed",onMouseLeave:i=>i.target.style.background="#8b5cf6",children:"About"}),e.jsx("button",{type:"button",onClick:r,style:{color:"#fff",fontWeight:500,padding:"0.5rem 1.25rem",borderRadius:"8px",background:"#ef4444",transition:"background 0.2s",border:"none",cursor:"pointer",fontSize:"0.95rem"},onMouseEnter:i=>i.target.style.background="#dc2626",onMouseLeave:i=>i.target.style.background="#ef4444",children:"Logout"})]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{to:"/about",style:{color:"#fff",textDecoration:"none",fontWeight:500,padding:"0.5rem 1.25rem",borderRadius:"8px",background:"#8b5cf6",transition:"background 0.2s",display:"inline-block",border:"none",fontSize:"0.95rem"},onMouseEnter:i=>i.target.style.background="#7c3aed",onMouseLeave:i=>i.target.style.background="#8b5cf6",children:"About"}),e.jsx(oe,{to:"/login",style:{color:"#fff",textDecoration:"none",fontWeight:500,padding:"0.5rem 1.25rem",borderRadius:"8px",background:"#3b82f6",transition:"background 0.2s",display:"inline-block",border:"none",fontSize:"0.95rem"},onMouseEnter:i=>i.target.style.background="#2563eb",onMouseLeave:i=>i.target.style.background="#3b82f6",children:"Login"}),e.jsx(oe,{to:"/register",style:{color:"#fff",textDecoration:"none",fontWeight:500,padding:"0.5rem 1.25rem",borderRadius:"8px",background:"#10b981",transition:"background 0.2s",display:"inline-block",border:"none",fontSize:"0.95rem"},onMouseEnter:i=>i.target.style.background="#059669",onMouseLeave:i=>i.target.style.background="#10b981",children:"Register"})]})})]})})},sr=()=>e.jsx("footer",{style:{background:"#0f172a",color:"#94a3b8",padding:"1rem 1.5rem",textAlign:"center"},children:e.jsxs("small",{children:["¬© ",new Date().getFullYear()," Smart Quiz Platform. Advanced anti-cheat online assessment system."]})}),we=({children:a})=>{const{user:t,token:s}=J(i=>i.auth),r=Et();return!t||!s?e.jsx(jt,{to:"/login",replace:!0,state:{from:r}}):a};function ae(...a){return cs(ls(a))}const rr=os("inline-flex items-center justify-center rounded-lg text-sm font-medium transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",gradient:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-lg hover:shadow-xl hover:scale-105",success:"bg-gradient-to-r from-green-600 to-emerald-600 text-white shadow-lg hover:shadow-xl",danger:"bg-gradient-to-r from-red-600 to-rose-600 text-white shadow-lg hover:shadow-xl"},size:{default:"h-10 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-12 rounded-lg px-8 text-base",xl:"h-14 rounded-lg px-10 text-lg",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),se=m.forwardRef(({className:a,variant:t,size:s,asChild:r=!1,...i},n)=>e.jsx("button",{className:ae(rr({variant:t,size:s,className:a})),ref:n,...i}));se.displayName="Button";const ir=()=>{const a=je(),t=[{icon:e.jsx(Le,{className:"w-8 h-8"}),title:"Advanced Anti-Cheat",description:"Real-time proctoring with AI-powered face detection, liveness verification, and behavior monitoring",color:"purple"},{icon:e.jsx(qe,{className:"w-8 h-8"}),title:"Live Proctoring",description:"Continuous face tracking, gaze detection, and multiple person detection during exams",color:"blue"},{icon:e.jsx(et,{className:"w-8 h-8"}),title:"AI-Powered Detection",description:"Machine learning algorithms detect suspicious patterns, audio anomalies, and cheating attempts",color:"cyan"},{icon:e.jsx(Lt,{className:"w-8 h-8"}),title:"Code Execution",description:"Support for coding questions with real-time code execution in multiple programming languages",color:"orange"},{icon:e.jsx(tt,{className:"w-8 h-8"}),title:"Secure Authentication",description:"2FA, JWT tokens, and role-based access control ensure platform security",color:"green"},{icon:e.jsx(pt,{className:"w-8 h-8"}),title:"Analytics Dashboard",description:"Comprehensive analytics with detailed reports, violation tracking, and performance metrics",color:"pink"}],s=[{name:"React",icon:e.jsx(Mt,{}),category:"Frontend"},{name:"Node.js",icon:e.jsx(St,{}),category:"Backend"},{name:"MongoDB",icon:e.jsx(We,{}),category:"Database"},{name:"Face-API.js",icon:e.jsx(qe,{}),category:"AI/ML"},{name:"WebSocket",icon:e.jsx(Nt,{}),category:"Real-time"},{name:"Docker",icon:e.jsx(Re,{}),category:"DevOps"}];return e.jsxs("div",{className:"landing-page",children:[e.jsxs("section",{className:"hero-section",children:[e.jsx("div",{className:"hero-gradient"}),e.jsx("div",{className:"container",children:e.jsxs("div",{className:"hero-content",children:[e.jsxs("h1",{className:"hero-title animate-fadeIn",style:{animationDelay:"0.1s"},children:["Smart Quiz Platform with",e.jsx("span",{className:"gradient-text",children:" Advanced Anti-Cheat"})]}),e.jsx("p",{className:"hero-subtitle animate-fadeIn",style:{animationDelay:"0.2s"},children:"Experience the next generation of online assessments with AI-powered proctoring, real-time monitoring, and comprehensive security features"}),e.jsx("div",{className:"hero-demo-section animate-fadeIn",style:{animationDelay:"0.3s"},children:e.jsxs("div",{className:"demo-card",children:[e.jsx("div",{className:"demo-icon",children:e.jsx(We,{size:24})}),e.jsxs("div",{className:"demo-content",children:[e.jsx("h3",{className:"demo-title",children:"Load Demo Data"}),e.jsx("p",{className:"demo-description",children:"Try the platform with sample quizzes and users"}),e.jsx(se,{variant:"primary",size:"md",onClick:async()=>{if(window.confirm("This will populate the database with demo quizzes and sample users. Continue?"))try{const i=await(await fetch("http://localhost:4000/api/seed",{method:"POST",headers:{"Content-Type":"application/json"}})).json();i.success?(alert("Demo data loaded successfully! You can now login with demo credentials."),a("/login")):alert("Failed to load demo data: "+i.message)}catch(r){alert("Error loading demo data: "+r.message)}},leftIcon:e.jsx(We,{}),children:"Load Demo Data"})]})]})})]})})]}),e.jsx("section",{className:"features-section",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{className:"section-title",children:"Powerful Features"}),e.jsx("p",{className:"section-subtitle",children:"Everything you need for secure and intelligent online assessments"})]}),e.jsx("div",{className:"features-grid",children:t.map((r,i)=>e.jsxs("div",{className:`feature-card feature-card--${r.color} animate-fadeIn`,style:{animationDelay:`${i*.1}s`},children:[e.jsx("div",{className:`feature-icon feature-icon--${r.color}`,children:r.icon}),e.jsx("h3",{className:"feature-title",children:r.title}),e.jsx("p",{className:"feature-description",children:r.description})]},i))})]})}),e.jsx("section",{className:"tech-section",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{className:"section-title",children:"Built with Modern Technology"}),e.jsx("p",{className:"section-subtitle",children:"Leveraging cutting-edge tools and frameworks for reliability and performance"})]}),e.jsx("div",{className:"tech-grid",children:s.map((r,i)=>e.jsxs("div",{className:"tech-card animate-fadeIn",style:{animationDelay:`${i*.05}s`},children:[e.jsx("div",{className:"tech-icon",children:r.icon}),e.jsx("div",{className:"tech-name",children:r.name}),e.jsx("div",{className:"tech-category",children:r.category})]},i))})]})}),e.jsx("footer",{className:"landing-footer",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"footer-content",children:e.jsxs("div",{className:"footer-links",children:[e.jsxs("div",{className:"footer-column",children:[e.jsx("h4",{children:"Product"}),e.jsx(oe,{to:"/about",children:"Features"}),e.jsx(oe,{to:"/about",children:"Tech Stack"}),e.jsx(oe,{to:"/register",children:"Pricing"})]}),e.jsxs("div",{className:"footer-column",children:[e.jsx("h4",{children:"Resources"}),e.jsx(oe,{to:"/about",children:"Documentation"}),e.jsx(oe,{to:"/about",children:"API Reference"}),e.jsx(oe,{to:"/about",children:"Support"})]}),e.jsxs("div",{className:"footer-column",children:[e.jsx("h4",{children:"Legal"}),e.jsx(oe,{to:"/about",children:"Privacy Policy"}),e.jsx(oe,{to:"/about",children:"Terms of Service"}),e.jsx(oe,{to:"/about",children:"Security"})]})]})})})})]})},ar=()=>{const a=pe(),t=je(),s=Et(),{user:r,status:i,error:n}=J(c=>c.auth),[l,g]=m.useState({email:"",password:""});m.useEffect(()=>{var c,f;if(r){const y=((f=(c=s.state)==null?void 0:c.from)==null?void 0:f.pathname)||"/dashboard";t(y,{replace:!0})}},[r,t,s]);const d=c=>{c.preventDefault(),a(Je(l))};return e.jsxs("section",{className:"card",style:{maxWidth:420,margin:"3rem auto"},children:[e.jsx("h1",{children:"Welcome back"}),e.jsx("p",{style:{color:"#64748b"},children:"Log in to access your proctored exams."}),e.jsxs("form",{onSubmit:d,children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{id:"email",type:"email",value:l.email,onChange:c=>g({...l,email:c.target.value}),required:!0}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{id:"password",type:"password",value:l.password,onChange:c=>g({...l,password:c.target.value}),required:!0}),i==="failed"&&e.jsx("p",{style:{color:"#ef4444"},children:n}),e.jsx("button",{type:"submit",className:"primary-btn",style:{width:"100%"},disabled:i==="loading",children:i==="loading"?"Verifying‚Ä¶":"Log in"})]}),e.jsxs("p",{style:{marginTop:"1rem",textAlign:"center"},children:["New here? ",e.jsx(oe,{to:"/register",children:"Create an account"})]})]})},nr=()=>{const a=pe(),t=je(),{user:s,status:r,error:i}=J(d=>d.auth),[n,l]=m.useState({username:"",email:"",password:"",role:"student"});m.useEffect(()=>{s&&t("/dashboard",{replace:!0})},[s,t]);const g=d=>{d.preventDefault(),a(Ye(n))};return e.jsxs("section",{className:"card",style:{maxWidth:480,margin:"3rem auto"},children:[e.jsx("h1",{children:"Create your account"}),e.jsx("p",{style:{color:"#64748b"},children:"Join the Smart Quiz with Anti-Cheat Features platform."}),e.jsxs("form",{onSubmit:g,children:[e.jsx("label",{htmlFor:"username",children:"Username"}),e.jsx("input",{id:"username",value:n.username,onChange:d=>l({...n,username:d.target.value}),required:!0}),e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{id:"email",type:"email",value:n.email,onChange:d=>l({...n,email:d.target.value}),required:!0}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("input",{id:"password",type:"password",value:n.password,onChange:d=>l({...n,password:d.target.value}),required:!0,minLength:6}),e.jsx("label",{htmlFor:"role",children:"Role"}),e.jsxs("select",{id:"role",value:n.role,onChange:d=>l({...n,role:d.target.value}),children:[e.jsx("option",{value:"student",children:"Student"}),e.jsx("option",{value:"admin",children:"Administrator"})]}),r==="failed"&&e.jsx("p",{style:{color:"#ef4444"},children:i}),e.jsx("button",{type:"submit",className:"primary-btn",style:{width:"100%"},disabled:r==="loading",children:r==="loading"?"Creating‚Ä¶":"Create account"})]}),e.jsxs("p",{style:{marginTop:"1rem",textAlign:"center"},children:["Already registered? ",e.jsx(oe,{to:"/login",children:"Log in"})]})]})},De=ce("quizzes/fetchAll",async(a,{rejectWithValue:t})=>{var s;try{const{data:r}=await ie.get("/api/quizzes");return r}catch(r){return t(((s=r.response)==null?void 0:s.data)||{message:"Unable to load quizzes"})}}),$e=ce("quizzes/fetchById",async(a,{rejectWithValue:t})=>{var s;try{const{data:r}=await ie.get(`/api/quizzes/${a}`);return r}catch(r){return t(((s=r.response)==null?void 0:s.data)||{message:"Unable to load quiz"})}}),_t=ce("quizzes/create",async(a,{rejectWithValue:t})=>{var s;try{const{data:r}=await ie.post("/api/quizzes",a);return r}catch(r){return t(((s=r.response)==null?void 0:s.data)||{message:"Unable to create quiz"})}}),xt=ce("quizzes/update",async({quizId:a,payload:t},{rejectWithValue:s})=>{var r;try{const{data:i}=await ie.put(`/api/quizzes/${a}`,t);return i}catch(i){return s(((r=i.response)==null?void 0:r.data)||{message:"Unable to update quiz"})}}),yt=ce("quizzes/delete",async(a,{rejectWithValue:t})=>{var s;try{return await ie.delete(`/api/quizzes/${a}`),a}catch(r){return t(((s=r.response)==null?void 0:s.data)||{message:"Unable to delete quiz"})}}),bt=ce("quizzes/togglePublish",async({quizId:a,isPublished:t},{rejectWithValue:s})=>{var r;try{const{data:i}=await ie.put(`/api/quizzes/${a}`,{isPublished:t});return i}catch(i){return s(((r=i.response)==null?void 0:r.data)||{message:"Unable to update quiz status"})}}),or=at({name:"quizzes",initialState:{items:[],current:null,status:"idle",error:null},reducers:{},extraReducers:a=>{a.addCase(De.pending,t=>{t.status="loading"}).addCase(De.fulfilled,(t,s)=>{t.status="succeeded",t.items=s.payload}).addCase(De.rejected,(t,s)=>{var r;t.status="failed",t.error=((r=s.payload)==null?void 0:r.message)||"Unable to load quizzes"}).addCase($e.pending,t=>{t.status="loading"}).addCase($e.fulfilled,(t,s)=>{t.status="succeeded",t.current=s.payload}).addCase($e.rejected,(t,s)=>{var r;t.status="failed",t.error=((r=s.payload)==null?void 0:r.message)||"Unable to load quiz"}).addCase(_t.fulfilled,(t,s)=>{t.items.push(s.payload),t.error=null}).addCase(xt.fulfilled,(t,s)=>{t.items=t.items.map(r=>r._id===s.payload._id?s.payload:r),t.current&&t.current._id===s.payload._id&&(t.current=s.payload),t.error=null}).addCase(xt.rejected,(t,s)=>{var r;t.error=((r=s.payload)==null?void 0:r.message)||"Unable to update quiz"}).addCase(yt.fulfilled,(t,s)=>{t.items=t.items.filter(r=>r._id!==s.payload),t.current&&t.current._id===s.payload&&(t.current=null),t.error=null}).addCase(yt.rejected,(t,s)=>{var r;t.error=((r=s.payload)==null?void 0:r.message)||"Unable to delete quiz"}).addCase(bt.fulfilled,(t,s)=>{t.items=t.items.map(r=>r._id===s.payload._id?s.payload:r),t.current&&t.current._id===s.payload._id&&(t.current=s.payload),t.error=null}).addCase(bt.rejected,(t,s)=>{var r;t.error=((r=s.payload)==null?void 0:r.message)||"Unable to update quiz status"})}}),lr=or.reducer,Xe=ce("results/startExam",async(a,{rejectWithValue:t})=>{var s;try{const{data:r}=await ie.post("/api/results/start",{quizId:a});return r}catch(r){return t(((s=r.response)==null?void 0:s.data)||{message:"Unable to start exam"})}}),Ut=ce("results/submitExam",async({resultId:a,answers:t,score:s},{rejectWithValue:r})=>{var i;try{const{data:n}=await ie.post(`/api/results/${a}/submit`,{answers:t,score:s});return n}catch(n){return r(((i=n.response)==null?void 0:i.data)||{message:"Unable to submit exam"})}}),Ce=ce("results/fetchForUser",async(a,{rejectWithValue:t})=>{var s;try{const{data:r}=await ie.get(`/api/results/user/${a}`);return r}catch(r){return t(((s=r.response)==null?void 0:s.data)||{message:"Unable to load results"})}}),vt=ce("results/fetchDetail",async(a,{rejectWithValue:t})=>{var s;try{const{data:r}=await ie.get(`/api/results/${a}`);return r}catch(r){return t(((s=r.response)==null?void 0:s.data)||{message:"Unable to load result"})}}),Ee=ce("results/fetchAll",async(a,{rejectWithValue:t})=>{var s;try{const{data:r}=await ie.get("/api/results");return r}catch(r){return t(((s=r.response)==null?void 0:s.data)||{message:"Unable to load results"})}}),$t=at({name:"results",initialState:{current:null,list:[],status:"idle",error:null,listStatus:"idle",listError:null},reducers:{resetCurrent(a){a.current=null}},extraReducers:a=>{a.addCase(Xe.pending,t=>{t.status="loading",t.error=null}).addCase(Xe.fulfilled,(t,s)=>{t.status="succeeded",t.current=s.payload}).addCase(Xe.rejected,(t,s)=>{var r;t.status="failed",t.error=((r=s.payload)==null?void 0:r.message)||"Unable to start exam"}).addCase(Ut.fulfilled,(t,s)=>{t.current=s.payload}).addCase(Ce.fulfilled,(t,s)=>{t.list=s.payload,t.listStatus="succeeded",t.listError=null}).addCase(Ce.pending,t=>{t.listStatus="loading",t.listError=null}).addCase(Ce.rejected,(t,s)=>{var r;t.listStatus="failed",t.listError=((r=s.payload)==null?void 0:r.message)||"Unable to load results"}).addCase(Ee.pending,t=>{t.listStatus="loading",t.listError=null}).addCase(Ee.fulfilled,(t,s)=>{t.list=s.payload,t.listStatus="succeeded",t.listError=null}).addCase(Ee.rejected,(t,s)=>{var r;t.listStatus="failed",t.listError=((r=s.payload)==null?void 0:r.message)||"Unable to load results"}).addCase(vt.fulfilled,(t,s)=>{t.current=s.payload}).addCase(vt.rejected,(t,s)=>{var r;t.error=((r=s.payload)==null?void 0:r.message)||"Unable to load result"})}}),{resetCurrent:na}=$t.actions,cr=$t.reducer,V=m.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:ae("rounded-xl border border-border bg-card text-card-foreground shadow-md transition-all duration-300 hover:shadow-lg",a),...t}));V.displayName="Card";const dr=m.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:ae("flex flex-col space-y-1.5 p-6",a),...t}));dr.displayName="CardHeader";const ur=m.forwardRef(({className:a,...t},s)=>e.jsx("h3",{ref:s,className:ae("font-semibold leading-none tracking-tight text-2xl",a),...t}));ur.displayName="CardTitle";const mr=m.forwardRef(({className:a,...t},s)=>e.jsx("p",{ref:s,className:ae("text-sm text-muted-foreground",a),...t}));mr.displayName="CardDescription";const hr=m.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:ae("p-6 pt-0",a),...t}));hr.displayName="CardContent";const pr=m.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:ae("flex items-center p-6 pt-0",a),...t}));pr.displayName="CardFooter";const lt=a=>{if(!a)return null;if(typeof a=="string"||typeof a=="number")return String(a);if(typeof a=="object"){if(a._id)return String(a._id);if(a.id)return String(a.id);if(a.userId)return String(a.userId)}return null},Te=a=>lt(a),rt=a=>lt(a),Oe=a=>a?lt(a.createdBy):null,Ie=a=>a?lt(a.user):null,gr=()=>{var O,j,K;const a=pe(),t=je(),{user:s}=J(p=>p.auth),{items:r,status:i}=J(p=>p.quizzes),{list:n,listStatus:l}=J(p=>p.results),[g,d]=m.useState(null),c=(s==null?void 0:s.role)==="admin",f=(s==null?void 0:s.role)==="instructor",y=m.useMemo(()=>Te(s),[s]),M=(...p)=>{},A=m.useMemo(()=>{if(M("[Dashboard myResults] Results length:",n==null?void 0:n.length),!s||s.role!=="student"||!y)return[];const p=n.filter(C=>{const h=Ie(C),o=!!(h&&h===y);return o&&M("[Dashboard myResults] Checking result:",C._id,"status:",C.status),o&&(C.status==="submitted"||C.status==="completed")});return M("[Dashboard myResults] Filtered results:",p.length,p),p},[n,s,y]),S=m.useMemo(()=>{const p={totalQuizzes:0,quizzesCompleted:0,averageScore:null,sessionsWithAlerts:0,recentActivity:[]};if(!s)return p;if(c){const C=n.length,h=n.filter(u=>{var b;return(((b=u.proctoringLog)==null?void 0:b.length)??0)>0}).length,o=n.filter(u=>typeof u.score=="number"),x=o.length?Math.round(o.reduce((u,b)=>u+b.score,0)/o.length*10)/10:null;return M("[Dashboard Stats] Admin:",{totalSubmissions:C,scoredResults:o.length,averageScore:x,resultsArray:n}),{totalQuizzes:r.length,quizzesCompleted:C,averageScore:x,sessionsWithAlerts:h,recentActivity:n.slice(0,5)}}if(f){const C=r.filter(u=>{const b=Oe(u);return y&&b===y}),h=n.filter(u=>{const b=Oe(u==null?void 0:u.quiz);return y&&b===y}),o=h.filter(u=>typeof u.score=="number"),x=o.length?Math.round(o.reduce((u,b)=>u+b.score,0)/o.length*10)/10:null;return M("[Dashboard Stats] Instructor:",{instructorQuizCount:C.length,instructorResultsCount:h.length,averageScore:x,currentUserId:y}),{totalQuizzes:C.length,quizzesCompleted:h.length,averageScore:x,sessionsWithAlerts:h.filter(u=>{var b;return(((b=u.proctoringLog)==null?void 0:b.length)??0)>0}).length,recentActivity:h.slice(0,5)}}{const C=A.filter(o=>typeof o.score=="number"),h=C.length?Math.round(C.reduce((o,x)=>o+x.score,0)/C.length*10)/10:null;return M("[Dashboard Stats] Student:",{myResultsCount:A.length,scoredResults:C.length,averageScore:h,resultsArray:A}),{totalQuizzes:r.length,quizzesCompleted:A.length,averageScore:h,sessionsWithAlerts:0,recentActivity:A.slice(0,5)}}},[s,c,f,r,n,A,y]),R=p=>{if(!p)return"Date pending";const C=new Date(p);return Number.isNaN(C.getTime())?"Date pending":C.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"})},w=p=>{if(!p)return"Submitted";switch(p){case"completed":return"Graded";case"submitted":return"Awaiting grading";case"in-progress":return"In progress";default:return p.replace(/-/g," ")}},_=p=>typeof(p==null?void 0:p.score)=="number"?`${p.score}%`:(p==null?void 0:p.status)==="in-progress"?"In progress":(p==null?void 0:p.status)==="submitted"?"Awaiting grading":"Pending",N=m.useMemo(()=>c?{heroSubtitle:"Orchestrate the platform and keep assessments running smoothly.",quickActions:[{icon:fe,title:"All Quizzes",description:"Manage every assessment across cohorts",onClick:()=>t("/quizzes"),color:"blue"},{icon:He,title:"Create Quiz",description:"Publish a new organization-wide quiz",onClick:()=>t("/manage-quiz"),color:"purple"},{icon:gt,title:"Student References",description:"Upload and manage face reference photos",onClick:()=>t("/admin/references"),color:"cyan"},{icon:Re,title:"All Results",description:"Review submissions and proctoring logs",onClick:()=>t("/results"),color:"green"}],spotlightTitle:"Administrator focus",spotlightSubtitle:"Insights to keep the platform running smoothly.",spotlightCards:[{icon:st,title:"Live Load",description:"Monitor submissions across all cohorts in real time."},{icon:Le,title:"Proctoring Alerts",description:"Triage flagged sessions to safeguard academic integrity."},{icon:Pt,title:"Platform Controls",description:"Adjust access policies, integrations, and proctoring rules."}],activityTitle:"Latest submissions",activitySubtitle:"Recent quiz attempts across the organization.",activityEmpty:"No submissions yet. Encourage instructors to publish a quiz.",checklistTitle:"Today‚Äôs admin checklist",checklistSubtitle:"Stay proactive with these quick health checks.",checklistItems:["Review AI-proctoring alerts flagged overnight.","Approve new instructor-created quizzes waiting for publish.","Export the latest platform-wide performance snapshot."]}:f?{heroSubtitle:"Coach your learners and track class performance at a glance.",quickActions:[{icon:fe,title:"My Quizzes",description:"Review and update your assessments",onClick:()=>t("/quizzes"),color:"blue"},{icon:He,title:"Create Quiz",description:"Design a new assessment for your class",onClick:()=>t("/manage-quiz"),color:"purple"},{icon:Re,title:"Review Submissions",description:"Grade and release scores",onClick:()=>t("/results"),color:"green"},{icon:pt,title:"Recent Activity",description:"Monitor learner progress",onClick:()=>t("/activity"),color:"cyan"}],spotlightTitle:"Instructor playbook",spotlightSubtitle:"Priorities tailored to your cohort.",spotlightCards:[{icon:pt,title:"Performance Trends",description:"Compare average scores and completion rates for each quiz."},{icon:gt,title:"Learner Outreach",description:"Follow up with learners showing repeated alerts or low scores."},{icon:fe,title:"Content Refresh",description:"Keep your assessments current with updated materials."}],activityTitle:"Latest learner submissions",activitySubtitle:"Newest attempts from your classes.",activityEmpty:"No recent attempts. Share a direct invite to get learners started.",checklistTitle:"Keep learners engaged",checklistSubtitle:"Quick wins for your next session.",checklistItems:["Grade pending submissions and release feedback.","Schedule a follow-up quiz or practice activity.","Send reminders to learners who have not started yet."]}:{heroSubtitle:"Track your progress and jump back into upcoming quizzes.",quickActions:[{icon:fe,title:"Browse Quizzes",description:"Find upcoming and available quizzes",onClick:()=>t("/quizzes"),color:"blue"},{icon:Re,title:"My Results",description:"Review your latest scores and feedback",onClick:()=>t("/results"),color:"green"},{icon:ke,title:"My Attempts",description:"See in-progress or submitted quizzes",onClick:()=>t("/my-attempts"),color:"cyan"},{icon:Me,title:"Recent Activity",description:"Stay on top of recent submissions",onClick:()=>t("/activity"),color:"purple"}],spotlightTitle:"Stay on track",spotlightSubtitle:"Shortcuts to keep your learning momentum.",spotlightCards:[{icon:Me,title:"Mastery Goals",description:"Aim for consistent scores above 70% to stay in the green."},{icon:ke,title:"Plan Your Time",description:"Preview upcoming quizzes and schedule study blocks."},{icon:Ve,title:"Celebrate Wins",description:"Review detailed feedback to reinforce what you got right."}],activityTitle:"Recent quiz activity",activitySubtitle:"Your latest submissions and status updates.",activityEmpty:"No activity yet. Start a quiz to see progress here.",checklistTitle:"Next steps",checklistSubtitle:"A few ideas to get the most out of the platform.",checklistItems:["Attempt an available quiz assigned by your instructor.","Review feedback on your latest graded submission.","Update your study plan with topics to revisit."]},[c,f,t]);if(m.useEffect(()=>{s&&(a(De()),c||f?a(Ee()).then(p=>{var C;M("[Dashboard] Admin/Instructor results fetched:",((C=p.payload)==null?void 0:C.length)||0)}):y&&a(Ce(y)).then(p=>{var C;M("[Dashboard] Student results fetched:",((C=p.payload)==null?void 0:C.length)||0)}))},[a,s,c,f,y]),!s)return null;const B=N.quickActions||[],E=[{icon:Le,title:"AI Anti-Cheat",description:"Real-time face detection & behavior monitoring",color:"purple"},{icon:qe,title:"Live Proctoring",description:"Continuous tracking with gaze & pose detection",color:"blue"},{icon:Lt,title:"Code Execution",description:"Support for coding questions with multiple languages",color:"orange"},{icon:et,title:"ML Detection",description:"Machine learning for anomaly detection",color:"cyan"}],$=[{icon:St,name:"React",category:"Frontend Framework"},{icon:Mt,name:"Node.js",category:"Backend Runtime"},{icon:We,name:"MongoDB",category:"Database"},{icon:qe,name:"Face-API.js",category:"AI/ML Library"},{icon:Nt,name:"WebSocket",category:"Real-time Comm"},{icon:tt,name:"JWT + 2FA",category:"Authentication"}],U=[{name:"Pentacore Solutions Team",role:"Full Stack Development"},{name:"Architecture Team",role:"System Design & Security"},{name:"AI/ML Team",role:"Proctoring & Detection"},{name:"DevOps Team",role:"Infrastructure & Deployment"}];return e.jsxs("div",{className:"dashboard-page",children:[e.jsxs("section",{className:"dashboard-hero",children:[e.jsx("div",{className:"hero-gradient"}),e.jsx("div",{className:"container",children:e.jsxs("div",{className:"hero-content",children:[e.jsxs("div",{className:"welcome-section",children:[e.jsxs("h1",{className:"welcome-title",children:["Welcome back, ",e.jsxs("span",{className:"gradient-text",children:[(s==null?void 0:s.username)||"User","!"]})]}),e.jsx("p",{className:"welcome-subtitle",children:N.heroSubtitle})]}),e.jsxs("div",{className:"stats-cards",children:[e.jsxs(V,{className:"stat-card stat-card--blue",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(fe,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:i==="loading"?"...":S.totalQuizzes}),e.jsx("div",{className:"stat-label",children:c?"Published Quizzes":f?"My Quizzes":"Available Quizzes"})]})]}),e.jsxs(V,{className:"stat-card stat-card--green",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(be,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:l==="loading"?"...":S.quizzesCompleted}),e.jsx("div",{className:"stat-label",children:c?"Total Submissions":f?"Submissions Received":"Completed Quizzes"})]})]}),e.jsxs(V,{className:"stat-card stat-card--purple",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Ve,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:l==="loading"?"...":S.averageScore===null?"‚Äî":`${S.averageScore}%`}),e.jsx("div",{className:"stat-label",children:"Average Score"})]})]}),e.jsxs(V,{className:"stat-card stat-card--orange",children:[e.jsx("div",{className:"stat-icon",children:c||f?e.jsx(ze,{}):e.jsx(Me,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:l==="loading"?"...":c||f?S.sessionsWithAlerts:S.averageScore===null?"Getting Started":S.averageScore>=70?"Excellent":S.averageScore>=50?"Good":"Improving"}),e.jsx("div",{className:"stat-label",children:c||f?"Sessions with Alerts":"Performance"})]})]})]})]})})]}),e.jsxs("div",{className:"container dashboard-content",children:[e.jsx("section",{className:"section",style:{marginTop:0},children:e.jsx("div",{className:"quick-actions-grid",children:B.map((p,C)=>{const h=p.icon;return e.jsxs(V,{className:`quick-action-card quick-action-card--${p.color}`,onClick:p.onClick,children:[e.jsx("div",{className:`action-icon action-icon--${p.color}`,children:h?e.jsx(h,{}):null}),e.jsx("h3",{className:"action-title",children:p.title}),e.jsx("p",{className:"action-description",children:p.description}),e.jsx("div",{className:"action-arrow",children:"‚Üí"})]},C)})})}),((O=N==null?void 0:N.spotlightCards)==null?void 0:O.length)>0&&e.jsxs("section",{className:"section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{className:"section-title",children:N.spotlightTitle}),e.jsx("p",{className:"section-subtitle",children:N.spotlightSubtitle})]}),e.jsx("div",{className:"role-spotlight-grid",children:N.spotlightCards.map((p,C)=>{const h=p.icon;return e.jsxs(V,{className:"role-spotlight-card",children:[e.jsx("div",{className:"role-spotlight-icon",children:h?e.jsx(h,{}):null}),e.jsx("h3",{className:"role-spotlight-title",children:p.title}),e.jsx("p",{className:"role-spotlight-description",children:p.description})]},`${p.title}-${C}`)})})]}),e.jsxs("section",{className:"section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{className:"section-title",children:N.activityTitle}),e.jsx("p",{className:"section-subtitle",children:N.activitySubtitle})]}),(j=S.recentActivity)!=null&&j.length?e.jsx("div",{className:"recent-activity-grid",children:S.recentActivity.map(p=>{var Z,Y,F,le,ee,Fe;const C=((Z=p.quiz)==null?void 0:Z.title)||"Untitled Quiz",h=((Y=p.user)==null?void 0:Y.username)||p.studentName||"Learner",o=((le=(F=p.quiz)==null?void 0:F.creator)==null?void 0:le.username)||((ee=p.quiz)==null?void 0:ee.instructorName),x=p.submittedAt||p.updatedAt||p.createdAt,u=((Fe=p.proctoringLog)==null?void 0:Fe.length)??0,b=w(p.status),D=_(p),I=p._id||`${C}-${x}`;return e.jsxs(V,{className:"recent-activity-card",children:[e.jsxs("div",{className:"recent-activity-header",children:[e.jsx("h3",{children:C}),e.jsx("span",{className:"recent-activity-score",children:D})]}),(c||f)&&e.jsxs("p",{className:"recent-activity-meta",children:[e.jsx("strong",{children:"Learner:"})," ",h]}),!c&&!f&&o&&e.jsxs("p",{className:"recent-activity-meta",children:[e.jsx("strong",{children:"Instructor:"})," ",o]}),e.jsx("p",{className:"recent-activity-meta",children:R(x)}),e.jsxs("div",{className:"recent-activity-footer",children:[e.jsx("span",{className:"recent-activity-status",children:b}),u>0&&e.jsxs("span",{className:"recent-activity-alerts",children:["‚ö†Ô∏è ",u," alert",u!==1?"s":""]})]})]},I)})}):e.jsxs(V,{className:"empty-state-card",children:[e.jsx("h3",{children:"No recent activity"}),e.jsx("p",{children:N.activityEmpty})]})]}),((K=N==null?void 0:N.checklistItems)==null?void 0:K.length)>0&&e.jsxs("section",{className:"section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{className:"section-title",children:N.checklistTitle}),e.jsx("p",{className:"section-subtitle",children:N.checklistSubtitle})]}),e.jsx(V,{className:"role-checklist-card",children:e.jsx("ul",{className:"role-checklist-list",children:N.checklistItems.map((p,C)=>e.jsxs("li",{className:"role-checklist-item",children:[e.jsx("span",{className:"role-checklist-index",children:String(C+1).padStart(2,"0")}),e.jsx("span",{className:"role-checklist-text",children:p})]},`${p}-${C}`))})})]}),e.jsxs("section",{className:"section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{className:"section-title",children:"Core platform capabilities"}),e.jsx("p",{className:"section-subtitle",children:"Security, reliability, and performance features built for high-stakes assessments."})]}),e.jsx("div",{className:"features-grid",children:E.map(p=>{const C=p.icon;return e.jsxs(V,{className:"feature-card",children:[e.jsx("div",{className:`feature-icon feature-icon--${p.color}`,children:C?e.jsx(C,{}):null}),e.jsx("h3",{className:"feature-title",children:p.title}),e.jsx("p",{className:"feature-description",children:p.description})]},p.title)})})]}),e.jsxs("section",{className:"section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{className:"section-title",children:"Technology stack"}),e.jsx("p",{className:"section-subtitle",children:"Modern tooling powers the end-to-end assessment experience."})]}),e.jsx("div",{className:"tech-stack-grid",children:$.map(p=>{const C=p.icon;return e.jsxs(V,{className:"tech-stack-card",children:[e.jsx("div",{className:"tech-stack-icon",children:C?e.jsx(C,{}):null}),e.jsxs("div",{className:"tech-stack-info",children:[e.jsx("h3",{className:"tech-stack-name",children:p.name}),e.jsx("span",{className:"tech-stack-category",children:p.category})]})]},p.name)})})]}),e.jsxs("section",{className:"section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{className:"section-title",children:"Behind the platform"}),e.jsx("p",{className:"section-subtitle",children:"Cross-functional teams collaborate to deliver secure, scalable assessments."})]}),e.jsx("div",{className:"developers-grid",children:U.map(p=>e.jsxs(V,{className:"developer-card",children:[e.jsx("div",{className:"developer-avatar",children:p.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"developer-name",children:p.name}),e.jsx("p",{className:"developer-role",children:p.role})]})]},p.name))})]})]})]})};let mt=!1;const fr=()=>{const a="/";return`${a.endsWith("/")?a:`${a}/`}face-models`},ct=async()=>{if(mt)return;const a=fr();try{await Promise.all([_e.tinyFaceDetector.loadFromUri(a),_e.faceLandmark68TinyNet.loadFromUri(a),_e.faceRecognitionNet.loadFromUri(a)]),mt=!0}catch(t){throw mt=!1,t.message=`Failed to load face-api models from ${a}. ${t.message||""}`,t}},zt=.48,xr=()=>{const a=m.useRef(null),t=m.useRef(null),s=m.useRef(null),r=pe(),i=je(),{user:n,verificationStatus:l,verificationError:g}=J(p=>p.auth),[d,c]=m.useState("loading-models"),[f,y]=m.useState(""),[M,A]=m.useState(!1),[S,R]=m.useState("prompt"),[w,_]=m.useState(null),[N,B]=m.useState(!1),[E,$]=m.useState(null),U=m.useMemo(()=>n!=null&&n.referenceDescriptor?new Float32Array(n.referenceDescriptor):null,[n==null?void 0:n.referenceDescriptor]);m.useEffect(()=>{n&&n.isFaceVerified&&i("/dashboard",{replace:!0})},[n,i]),m.useEffect(()=>{(async()=>{try{console.log("üîÑ Loading face-api models..."),await ct(),console.log("‚úÖ Face-api models loaded successfully"),B(!0),U?(console.log("‚úÖ Reference descriptor found, ready for enrollment"),c("awaiting-consent")):(console.warn("‚ö†Ô∏è No reference descriptor found"),c("missing-reference"),y("No reference face is available. Ask an administrator to upload your photo before continuing."))}catch(C){console.error("‚ùå Failed to load face-api models:",C),c("error"),y("Unable to load facial recognition models. Please refresh and try again.")}})()},[U]),m.useEffect(()=>{var h;if(!((h=navigator==null?void 0:navigator.permissions)!=null&&h.query)){console.warn("‚ö†Ô∏è Permissions API not available in this browser");return}let p=!1,C;return navigator.permissions.query({name:"camera"}).then(o=>{if(p)return;console.log("üîç Camera permission state:",o.state),C=o;const x=()=>{R(o.state),console.log("üîÑ Permission state changed to:",o.state),o.state==="denied"&&(A(!1),c("permission-blocked"),y("Camera access is blocked for this site. Enable permissions in your browser settings."))};x();const u=()=>x();o.addEventListener?o.addEventListener("change",u):o.onchange=u}).catch(o=>{console.warn("‚ö†Ô∏è Failed to query camera permission:",o)}),()=>{p=!0,C!=null&&C.removeEventListener?C.removeEventListener("change",()=>{}):C&&(C.onchange=null)}},[]),m.useEffect(()=>()=>{t.current&&(t.current.getTracks().forEach(p=>p.stop()),t.current=null)},[]);const O=async()=>{if(!N||!U){console.warn("‚ö†Ô∏è Camera request blocked:",{modelsLoaded:N,hasReference:!!U});return}try{console.log("üì∏ Requesting camera access..."),c("requesting-permission");const p=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});console.log("‚úÖ Camera access granted!",p),t.current=p,a.current&&(a.current.srcObject=p,a.current.onloadedmetadata=()=>{!s.current||!a.current||(s.current.width=a.current.videoWidth,s.current.height=a.current.videoHeight,console.log("‚úÖ Camera feed started:",a.current.videoWidth,"x",a.current.videoHeight))}),c("ready"),y(""),$({status:"pending",text:"Camera ready. Align your face and press verify."})}catch(p){console.error("‚ùå Camera access failed:",p.name,p.message),A(!1),(p==null?void 0:p.name)==="NotAllowedError"||(p==null?void 0:p.name)==="PermissionDeniedError"?(c("permission-blocked"),y("Camera access was denied. Allow permissions in your browser and try again.")):(p==null?void 0:p.name)==="NotFoundError"?(c("error"),y("No camera was detected. Connect a camera and retry.")):(c("error"),y(`Unable to access the camera: ${p.name}. Please retry.`))}},j=async()=>{if(!a.current||d!=="ready"||!U){y("Camera is not ready yet.");return}c("processing"),y(""),_(null),$(null);try{const p=await xe.detectSingleFace(a.current,new xe.TinyFaceDetectorOptions).withFaceLandmarks(!0).withFaceDescriptor();if(!p){c("ready"),y("No face detected. Ensure your face is well-lit and centered."),$({status:"absent",text:"No face detected. Ensure you are in frame and try again."});return}if(s.current&&a.current){const h=s.current.getContext("2d");s.current.width=a.current.videoWidth,s.current.height=a.current.videoHeight,h.drawImage(a.current,0,0,s.current.width,s.current.height)}const C=xe.euclideanDistance(U,p.descriptor);if(_(C),C>zt){c("ready"),y(`Face mismatch detected. Distance ${C.toFixed(3)} is above the allowed threshold.`),$({status:"mismatch",text:`Distance ${C.toFixed(3)} exceeds the allowed threshold. Adjust lighting or positioning and retry.`});return}await r(Ue(Array.from(p.descriptor))).unwrap(),c("success"),$({status:"success",text:`Identity confirmed! Match distance ${C.toFixed(3)} is within the approved threshold. Redirecting...`}),setTimeout(()=>{i("/dashboard",{replace:!0})},1500)}catch(p){console.error("‚ùå Verification error:",p),c("ready"),y((p==null?void 0:p.message)||"Verification failed. Please try again."),$({status:"error",text:(p==null?void 0:p.message)||"Verification failed. Please try again."})}};if(!n)return null;if(d==="success")return e.jsxs("section",{className:"card",style:{maxWidth:800,margin:"2rem auto",textAlign:"center"},children:[e.jsx("h1",{children:"‚úÖ Verification Successful!"}),e.jsx("p",{style:{color:"#166534",fontSize:"1.1rem",marginTop:"1rem"},children:"Your identity has been confirmed. Redirecting to dashboard..."}),e.jsx("div",{style:{marginTop:"2rem"},children:e.jsx("div",{className:"spinner",style:{margin:"0 auto"}})})]});if(!U)return e.jsxs("section",{className:"card",style:{maxWidth:800,margin:"2rem auto"},children:[e.jsx("h1",{children:"Face Verification"}),e.jsx("p",{style:{color:"#ef4444"},children:"No reference face is on file. Contact an administrator to upload your photo."})]});const K=d!=="ready"||l==="loading"||!M||!U;return e.jsxs("section",{className:"card",style:{maxWidth:900,margin:"2rem auto"},children:[e.jsx("h1",{children:"Face Verification"}),e.jsx("p",{style:{color:"#64748b",maxWidth:600},children:"Please verify your identity before starting proctored exams. The captured frame is used only for comparison with the administrator-approved reference photo."}),E&&e.jsx("div",{style:{margin:"1rem 0",padding:"0.85rem 1rem",borderRadius:"12px",border:"1px solid rgba(148, 163, 184, 0.35)",background:E.status==="success"?"#dcfce7":E.status==="mismatch"||E.status==="error"?"#fee2e2":E.status==="absent"?"#fef9c3":"#f1f5f9",color:E.status==="success"?"#166534":E.status==="mismatch"||E.status==="error"?"#b91c1c":E.status==="absent"?"#92400e":"#0f172a"},role:"status",children:E.text}),e.jsxs("div",{className:"grid two",style:{alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx("video",{ref:a,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",borderRadius:"12px",background:"#0f172a0d",minHeight:240}}),e.jsx("canvas",{ref:s,style:{display:"none"}})]}),["awaiting-consent","permission-blocked","missing-reference"].includes(d)&&e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("button",{type:"button",className:"primary-btn",onClick:()=>{A(!0),y(""),O()},disabled:d==="missing-reference"||l==="loading"||!N,children:d==="requesting-permission"?"Opening camera‚Ä¶":"Enable camera"}),S==="denied"&&e.jsx("p",{style:{marginTop:"0.5rem",color:"#b91c1c"},children:"Camera permission is denied. Update site permissions and try again."})]})]}),e.jsxs("div",{children:[e.jsx("h3",{children:"Verification steps"}),e.jsxs("ol",{style:{color:"#475569",lineHeight:1.6,paddingLeft:"1.2rem"},children:[e.jsx("li",{children:"Click ‚ÄúEnable camera‚Äù and allow access in the browser prompt."}),e.jsx("li",{children:"Look directly at the camera with even lighting."}),e.jsx("li",{children:"Press ‚ÄúVerify my identity‚Äù to begin the comparison. If you see a mismatch, adjust your lighting and try again."})]}),w!==null&&e.jsxs("p",{style:{color:"#0f172a",marginTop:"0.75rem"},children:["Latest match distance: ",e.jsx("strong",{children:w.toFixed(3)})," (threshold ‚â§ ",zt,")"]}),f&&e.jsx("p",{style:{color:"#ef4444",marginTop:"0.75rem"},role:"alert",children:f}),g&&e.jsx("p",{style:{color:"#ef4444",marginTop:"0.75rem"},role:"alert",children:g}),e.jsx("button",{type:"button",className:"primary-btn",onClick:j,disabled:K,style:{marginTop:"1rem"},children:l==="loading"||d==="processing"?"Verifying‚Ä¶":"Verify my identity"})]})]})]})};class yr{constructor({sendEvent:t,onNotify:s}){this.sendEvent=t,this.onNotify=s,this.cooldowns=new Map,this.counts=new Map,this.violations=[],this.riskScore=0,this.startTime=Date.now()}trigger(t,s,r={},i={}){const n=Date.now(),l=i.cooldownMs??5e3,g=`${t}-${s}`,d=this.cooldowns.get(g)||0;if(n-d<l)return;const c=(this.counts.get(t)||0)+1;this.counts.set(t,c),this.cooldowns.set(g,n);const f=this.calculateRiskIncrease(t,s,c);this.riskScore=Math.min(100,this.riskScore+f);const y={eventType:t,severity:s,timestamp:n,count:c,riskScore:this.riskScore,...r};this.violations.push(y);const M={eventType:t,severity:s,eventData:{count:c,totalViolations:this.violations.length,riskScore:this.riskScore,...r}};this.sendEvent(M),typeof this.onNotify=="function"&&this.onNotify(M),this.riskScore>=80&&i.autoTerminate!==!1&&this.trigger("auto_terminate","critical",{reason:"Risk score exceeded threshold",finalScore:this.riskScore})}calculateRiskIncrease(t,s,r){const i={low:2,medium:5,high:10,critical:20},n=Math.min(r/3,2);return i[s]*n}getViolationSummary(){return{totalViolations:this.violations.length,riskScore:this.riskScore,duration:Date.now()-this.startTime,violationsByType:this.getViolationsByType(),timeline:this.violations}}getViolationsByType(){const t={};return this.violations.forEach(s=>{t[s.eventType]||(t[s.eventType]={count:0,severity:s.severity}),t[s.eventType].count++}),t}reset(){this.cooldowns.clear(),this.counts.clear(),this.violations=[],this.riskScore=0,this.startTime=Date.now()}}class br{constructor(){this.violations=[],this.gazeHistory=[],this.headPoseHistory=[],this.bodyMovementHistory=[],this.warningsIssued=0,this.trackingInterval=null,this.alertCallback=null,this.isTracking=!1,this.thresholds={gazeDeviation:.3,headRotation:35,bodyMovement:50,blinkRate:30,eyesClosed:2,lookAwayDuration:3,multiplePersons:1,suspiciousMovement:5},this.lastViolationTime={head_rotation:0,eye_gaze_away:0,body_movement:0,suspicious_expression:0,mouth_movement:0},this.violationCooldown=3e3,this.state={lastFacePosition:null,lastLandmarks:null,eyesClosedStart:null,lookAwayStart:null,blinkCount:0,lastBlinkTime:null,videoElement:null,canvasElement:null}}initialize(t,s,r){this.state.videoElement=t,this.state.canvasElement=s,this.alertCallback=r}startTracking(){this.isTracking||(this.isTracking=!0,this.trackingInterval=setInterval(()=>{this.analyzeFrame()},1e3),console.log("üëÅÔ∏è Movement tracking started"))}stopTracking(){this.trackingInterval&&(clearInterval(this.trackingInterval),this.trackingInterval=null),this.isTracking=!1,console.log("üëÅÔ∏è Movement tracking stopped")}async analyzeFrame(){const{videoElement:t,canvasElement:s}=this.state;if(!(!t||!s))try{if(!_e.tinyFaceDetector.isLoaded||!_e.faceLandmark68TinyNet.isLoaded){console.warn("[Movement Engine] Face models not loaded yet, skipping frame");return}const r=await ks(t,new As({scoreThreshold:.3})).withFaceLandmarks(!0);if(console.log(`[Movement Engine] Detected ${(r==null?void 0:r.length)||0} face(s)`),!r||r.length===0){this.handleNoFaceDetected();return}if(r.length>1){this.handleMultipleFacesDetected(r.length);return}const i=r[0];this.analyzeEyeGaze(i),this.analyzeHeadPose(i),this.analyzeBodyMovement(i),this.analyzeBlinkRate(i),this.drawTrackingOverlay(i)}catch(r){console.error("‚ùå Frame analysis error:",r)}}analyzeEyeGaze(t){const s=t.landmarks,r=s.getLeftEye(),i=s.getRightEye(),n=this.getCenter(r),l=this.getCenter(i),g={x:(n.x+l.x)/2,y:(n.y+l.y)/2},d={x:this.state.videoElement.videoWidth/2,y:this.state.videoElement.videoHeight/2},c=Math.sqrt(Math.pow(g.x-d.x,2)+Math.pow(g.y-d.y,2))/this.state.videoElement.videoWidth;if(c>this.thresholds.gazeDeviation)if(!this.state.lookAwayStart)this.state.lookAwayStart=Date.now();else{const f=(Date.now()-this.state.lookAwayStart)/1e3;f>this.thresholds.lookAwayDuration&&this.triggerViolation("eye_gaze_away",{deviation:c.toFixed(2),duration:f.toFixed(1),severity:"medium"})}else this.state.lookAwayStart=null;this.gazeHistory.push({timestamp:Date.now(),deviation:c,vector:g}),this.gazeHistory=this.gazeHistory.filter(f=>Date.now()-f.timestamp<6e4)}analyzeHeadPose(t){const s=t.landmarks,i=s.positions[30],n=this.getCenter(s.getLeftEye()),l=this.getCenter(s.getRightEye()),g={x:(n.x+l.x)/2,y:(n.y+l.y)/2},d=Math.atan2(i.x-g.x,i.y-g.y)*(180/Math.PI),c=Math.atan2(l.y-n.y,l.x-n.x)*(180/Math.PI),f=Math.atan2(i.y-g.y,g.x-i.x)*(180/Math.PI),y={yaw:Math.abs(d),pitch:Math.abs(f),roll:Math.abs(c),timestamp:Date.now()};y.yaw>this.thresholds.headRotation&&this.triggerViolation("head_rotation",{yaw:y.yaw.toFixed(1),pitch:y.pitch.toFixed(1),roll:y.roll.toFixed(1),severity:"medium"}),this.headPoseHistory.push(y),this.headPoseHistory=this.headPoseHistory.filter(M=>Date.now()-M.timestamp<6e4)}analyzeBodyMovement(t){const s=t.detection.box,r={x:s.x+s.width/2,y:s.y+s.height/2,width:s.width,height:s.height,timestamp:Date.now()};if(this.state.lastFacePosition){const i=r.x-this.state.lastFacePosition.x,n=r.y-this.state.lastFacePosition.y,l=Math.sqrt(i*i+n*n),g=Math.abs(r.width-this.state.lastFacePosition.width);l>this.thresholds.bodyMovement&&this.triggerViolation("excessive_movement",{movement:l.toFixed(1),direction:i>0?"right":"left",severity:"low"}),g>this.thresholds.bodyMovement&&this.triggerViolation("distance_change",{change:g.toFixed(1),direction:g>0?"closer":"farther",severity:"medium"}),this.bodyMovementHistory.push({timestamp:Date.now(),movement:l,sizeChange:g}),this.bodyMovementHistory=this.bodyMovementHistory.filter(d=>Date.now()-d.timestamp<6e4)}this.state.lastFacePosition=r}analyzeFacialExpressions(t){const s=t.expressions;s.surprised>.7&&this.triggerViolation("suspicious_expression",{expression:"surprised",confidence:s.surprised.toFixed(2),severity:"low"});const i=t.landmarks.getMouth();this.getVerticalDistance(i)>15&&this.triggerViolation("mouth_movement",{type:"talking_suspected",severity:"medium"})}analyzeBlinkRate(t){const s=t.landmarks,r=s.getLeftEye(),i=s.getRightEye(),n=this.calculateEyeAspectRatio(r),l=this.calculateEyeAspectRatio(i);if((n+l)/2<.2)if(!this.state.eyesClosedStart)this.state.eyesClosedStart=Date.now(),this.state.blinkCount++;else{const c=(Date.now()-this.state.eyesClosedStart)/1e3;c>this.thresholds.eyesClosed&&this.triggerViolation("eyes_closed",{duration:c.toFixed(1),severity:"high"})}else this.state.eyesClosedStart=null;const d=Date.now();if(this.state.lastBlinkTime){const c=(d-this.state.lastBlinkTime)/6e4,f=this.state.blinkCount/c;f>this.thresholds.blinkRate&&(this.triggerViolation("abnormal_blink_rate",{rate:f.toFixed(1),severity:"low"}),this.state.blinkCount=0,this.state.lastBlinkTime=d)}else this.state.lastBlinkTime=d}handleNoFaceDetected(){this.triggerViolation("no_face_detected",{severity:"critical",message:"Student not visible in camera"})}handleMultipleFacesDetected(t){this.triggerViolation("multiple_faces",{count:t,severity:"critical",message:`${t} people detected in frame`})}triggerViolation(t,s){const r=Date.now(),i=this.lastViolationTime[t]||0;if(r-i<this.violationCooldown)return;this.lastViolationTime[t]=r;const n={type:t,timestamp:r,data:s,warningLevel:this.calculateWarningLevel(t,s.severity)};this.violations.push(n),this.alertCallback&&this.alertCallback(n),console.warn("‚ö†Ô∏è Violation detected:",t,s)}calculateWarningLevel(t,s){const r=["no_face_detected","multiple_faces"],i=["eyes_closed","head_rotation"],n=["eye_gaze_away","distance_change","mouth_movement"];return r.includes(t)||s==="critical"?(this.warningsIssued+=3,"critical"):i.includes(t)||s==="high"?(this.warningsIssued+=2,"high"):n.includes(t)||s==="medium"?(this.warningsIssued+=1,"medium"):"low"}getCenter(t){const s=t.reduce((i,n)=>i+n.x,0)/t.length,r=t.reduce((i,n)=>i+n.y,0)/t.length;return{x:s,y:r}}getVerticalDistance(t){const s=t.map(r=>r.y);return Math.max(...s)-Math.min(...s)}calculateEyeAspectRatio(t){const s=Math.sqrt(Math.pow(t[1].x-t[5].x,2)+Math.pow(t[1].y-t[5].y,2)),r=Math.sqrt(Math.pow(t[2].x-t[4].x,2)+Math.pow(t[2].y-t[4].y,2)),i=Math.sqrt(Math.pow(t[0].x-t[3].x,2)+Math.pow(t[0].y-t[3].y,2));return(s+r)/(2*i)}drawTrackingOverlay(t){const{canvasElement:s,videoElement:r}=this.state;if(!s)return;const i=s.getContext("2d"),n={width:r.videoWidth,height:r.videoHeight};Cs(s,n),i.clearRect(0,0,s.width,s.height);const l=zs(t,n),g=l.detection.box;i.strokeStyle="#00ff00",i.lineWidth=2,i.strokeRect(g.x,g.y,g.width,g.height);const d=l.landmarks,c=d.getLeftEye(),f=d.getRightEye();i.fillStyle="#00ffff",[c,f].forEach(M=>{const A=this.getCenter(M);i.beginPath(),i.arc(A.x,A.y,3,0,2*Math.PI),i.fill()});const y=d.positions[30];i.fillStyle="#ff0000",i.beginPath(),i.arc(y.x,y.y,4,0,2*Math.PI),i.fill()}getViolationSummary(){const t=this.violations.filter(r=>Date.now()-r.timestamp<6e4),s={total:this.violations.length,last60s:t.length,warningsIssued:this.warningsIssued,byType:{},bySeverity:{critical:0,high:0,medium:0,low:0}};return this.violations.forEach(r=>{s.byType[r.type]=(s.byType[r.type]||0)+1,s.bySeverity[r.warningLevel]++}),s}reset(){this.violations=[],this.gazeHistory=[],this.headPoseHistory=[],this.bodyMovementHistory=[],this.warningsIssued=0,this.state={lastFacePosition:null,lastLandmarks:null,eyesClosedStart:null,lookAwayStart:null,blinkCount:0,lastBlinkTime:null,videoElement:this.state.videoElement,canvasElement:this.state.canvasElement}}}class vr{constructor(){this.blinkHistory=[],this.movementHistory=[],this.textureHistory=[],this.lastBlinkTime=null,this.consecutiveNoBlinkFrames=0,this.alertCallback=null,this.startTime=null,this.suspiciousFrameCount=0,this.lastAlertTime=0,this.thresholds={minBlinksPerMinute:8,maxBlinksPerMinute:40,blinkDuration:[100,400],minHeadMovement:5,textureVariance:.02,microMovementThreshold:2,noBlinkTimeout:45e3,screenDetectionScore:.7,warmupPeriod:1e4,minSuspiciousFrames:5,alertCooldown:5e3}}initialize(t){this.alertCallback=t,this.startTime=Date.now(),console.log("üîç Liveness Detection initialized")}analyzeLiveness(t,s){if(!t||!s)return;const r=Date.now();if(this.startTime&&r-this.startTime<this.thresholds.warmupPeriod)return{isLive:!0,confidence:1,warnings:[]};const i={isLive:!0,confidence:1,warnings:[]};if(t.landmarks){const f=this.analyzeBlinkPattern(t);f.suspicious&&(i.warnings.push(f.reason),i.confidence*=.7)}const n=this.analyzeMicroMovements(t);n.suspicious&&(i.warnings.push(n.reason),i.confidence*=.8);const l=this.analyzeTexture(t,s);l.suspicious&&(i.warnings.push(l.reason),i.confidence*=.8);const g=this.analyzeDepth(t);g.suspicious&&(i.warnings.push(g.reason),i.confidence*=.8),this.detectScreen(t,s).isScreen&&(i.warnings.push("Screen/display detected"),i.confidence*=.5),i.confidence<.7?this.suspiciousFrameCount++:this.suspiciousFrameCount=0;const c=r-this.lastAlertTime;return this.suspiciousFrameCount>=this.thresholds.minSuspiciousFrames&&c>this.thresholds.alertCooldown&&(i.confidence<.4?(this.triggerAlert("LIVENESS_CHECK_FAILED","critical",{confidence:i.confidence.toFixed(2),warnings:i.warnings,message:"Possible photo/video spoof detected"}),this.lastAlertTime=r):i.confidence<.7&&(this.triggerAlert("LIVENESS_SUSPICIOUS","high",{confidence:i.confidence.toFixed(2),warnings:i.warnings}),this.lastAlertTime=r)),i}analyzeBlinkPattern(t){const s=t.landmarks;if(!s)return{suspicious:!1};const r=s.getLeftEye(),i=s.getRightEye(),n=this.calculateEAR(r),l=this.calculateEAR(i),g=(n+l)/2,d=Date.now(),c=g<.2;if(c&&!this.lastBlinkTime)this.lastBlinkTime=d;else if(!c&&this.lastBlinkTime){const M=d-this.lastBlinkTime;if(this.blinkHistory.push({time:d,duration:M}),this.lastBlinkTime=null,this.consecutiveNoBlinkFrames=0,M<this.thresholds.blinkDuration[0]||M>this.thresholds.blinkDuration[1])return{suspicious:!0,reason:`Unnatural blink duration: ${M}ms`}}else c||this.consecutiveNoBlinkFrames++;this.blinkHistory=this.blinkHistory.filter(M=>d-M.time<6e4);const f=this.blinkHistory.length;if(this.blinkHistory.length>10){if(f<this.thresholds.minBlinksPerMinute)return{suspicious:!0,reason:`Too few blinks: ${f}/min (photo/video suspected)`};if(f>this.thresholds.maxBlinksPerMinute)return{suspicious:!0,reason:`Too many blinks: ${f}/min (artificial)`}}return(this.blinkHistory.length>0?d-this.blinkHistory[this.blinkHistory.length-1].time:1/0)>this.thresholds.noBlinkTimeout?{suspicious:!0,reason:"No blinking detected for extended period (static image suspected)"}:{suspicious:!1}}calculateEAR(t){if(!t||t.length<6)return 1;const s=this.distance(t[1],t[5]),r=this.distance(t[2],t[4]),i=this.distance(t[0],t[3]);return(s+r)/(2*i)}distance(t,s){return Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2))}analyzeMicroMovements(t){const s=t.detection.box,r={x:s.x+s.width/2,y:s.y+s.height/2,time:Date.now()};if(this.movementHistory.push(r),this.movementHistory=this.movementHistory.filter(l=>r.time-l.time<5e3),this.movementHistory.length<20)return{suspicious:!1};const i=[];for(let l=1;l<this.movementHistory.length;l++){const g=this.movementHistory[l].x-this.movementHistory[l-1].x,d=this.movementHistory[l].y-this.movementHistory[l-1].y,c=Math.sqrt(g*g+d*d);i.push(c)}const n=i.reduce((l,g)=>l+g,0)/i.length;return n<this.thresholds.microMovementThreshold?{suspicious:!0,reason:`Insufficient natural movement: ${n.toFixed(2)}px (static image suspected)`}:{suspicious:!1}}analyzeTexture(t,s){const r=t.detection.box,i=document.createElement("canvas"),n=i.getContext("2d"),l=50;i.width=l,i.height=l;try{n.drawImage(s,r.x,r.y,r.width,r.height,0,0,l,l);const g=n.getImageData(0,0,l,l),d=this.calculateVariance(g.data);if(this.textureHistory.push({time:Date.now(),variance:d}),this.textureHistory=this.textureHistory.filter(c=>Date.now()-c.time<3e3),d<this.thresholds.textureVariance)return{suspicious:!0,reason:`Low texture variance: ${d.toFixed(4)} (screen/photo suspected)`}}catch{}return{suspicious:!1}}calculateVariance(t){let s=0,r=0;const i=t.length/4;for(let g=0;g<t.length;g+=4){const d=(t[g]+t[g+1]+t[g+2])/3;s+=d,r+=d*d}const n=s/i;return(r/i-n*n)/65025}analyzeDepth(t){const s=t.landmarks;if(!s)return{suspicious:!1};const r=s.positions[30],i=this.getCenter(s.getLeftEye()),n=this.getCenter(s.getRightEye()),l=this.distance(i,n),d=(this.distance(r,i)+this.distance(r,n))/2/l;return d<.3||d>2?{suspicious:!0,reason:"Unusual depth ratio (flat surface suspected)"}:{suspicious:!1}}getCenter(t){const s=t.reduce((i,n)=>i+n.x,0)/t.length,r=t.reduce((i,n)=>i+n.y,0)/t.length;return{x:s,y:r}}detectScreen(t,s){const r=t.detection.box,i=r.width/r.height;return i<.6||i>1.4?{isScreen:!0,confidence:.8,reason:"Unusual aspect ratio (screen suspected)"}:s.videoWidth>0&&r.width/s.videoWidth<.15?{isScreen:!0,confidence:.9,reason:"Face too small (device screen suspected)"}:{isScreen:!1}}triggerAlert(t,s,r){this.alertCallback&&this.alertCallback({type:t,timestamp:Date.now(),data:{...r,severity:s},warningLevel:this.calculateWarningLevel(s)}),console.warn("‚ö†Ô∏è Liveness Alert:",t,r)}calculateWarningLevel(t){return t==="critical"?3:t==="high"?2:t==="medium"?1:0}reset(){this.blinkHistory=[],this.movementHistory=[],this.textureHistory=[],this.lastBlinkTime=null,this.consecutiveNoBlinkFrames=0}}const jr={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://localhost:4000",VITE_API_PORT:"4000",VITE_WS_URL:"ws://localhost:4000"};class wr{constructor(){this.audioContext=null,this.analyser=null,this.microphone=null,this.dataArray=null,this.isListening=!1,this.alertCallback=null,this.startTime=null,this.lastAlertTime=0,this.suspiciousAudioCount=0,this.debugEnabled=typeof import.meta<"u"&&jr&&!1,this.speechHistory=[],this.backgroundNoiseLevel=0,this.lastSpeechTime=null,this.consecutiveSpeechFrames=0,this.silenceFrames=0,this.lastPatternAlertTime=0,this.lastVolumeFluctuationAlertTime=0,this.lastPatternAnalysisTime=0,this.thresholds={speechThreshold:25e-5,backgroundNoiseMax:2e-4,multipleSpeakersThreshold:.15,whisperDetectionThreshold:1e-4,minSpeechDuration:500,frequencyRangeHuman:[85,255],suspiciousPatternWindow:5e3,warmupPeriod:8e3,minSuspiciousDetections:4,alertCooldown:15e3,patternAlertCooldown:6e4,volumeFluctuationCooldown:3e4,patternAnalysisInterval:2e3,minPatternIntervals:6,patternVarianceThreshold:5e4,patternAvgIntervalMax:1800,volumeFluctuationSensitivity:.03}}async initialize(t,s){try{this.alertCallback=s,this.startTime=Date.now(),this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.analyser.smoothingTimeConstant=.3,this.microphone=this.audioContext.createMediaStreamSource(t),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=10,this.microphone.connect(this.gainNode),this.gainNode.connect(this.analyser);const r=this.audioContext.createGain();r.gain.value=.001,this.gainNode.connect(r),r.connect(this.audioContext.destination);const i=this.analyser.frequencyBinCount;return this.dataArray=new Uint8Array(i),this.debugEnabled&&console.log("üé§ Advanced Audio Detection initialized with 10x gain boost (+20dB) [0.1% output volume]"),!0}catch(r){return console.error("Failed to initialize audio detection:",r),!1}}startListening(){this.isListening||!this.analyser||(this.isListening=!0,this.analyzeAudio(),this.debugEnabled&&console.log("üé§ Audio monitoring started"))}stopListening(){this.isListening=!1,this.audioContext&&this.audioContext.state!=="closed"&&this.audioContext.close(),this.debugEnabled&&console.log("üé§ Audio monitoring stopped")}analyzeAudio(){if(!this.isListening)return;this.analyser.getByteFrequencyData(this.dataArray);const t=new Float32Array(this.analyser.fftSize);this.analyser.getFloatTimeDomainData(t);const s=Date.now();if(this.startTime&&s-this.startTime<this.thresholds.warmupPeriod){requestAnimationFrame(()=>this.analyzeAudio());return}this.startTime&&s-this.startTime>=this.thresholds.warmupPeriod&&s-this.startTime<this.thresholds.warmupPeriod+100&&this.debugEnabled&&console.log("üé§ Audio detection warmup complete - now actively monitoring");const r=this.detectSpeech(this.dataArray,t);if(r.isSpeech){const i=this.detectMultipleSpeakers(this.dataArray);i.detected&&(this.suspiciousAudioCount++,this.suspiciousAudioCount>=this.thresholds.minSuspiciousDetections&&s-this.lastAlertTime>this.thresholds.alertCooldown&&(this.triggerAlert("MULTIPLE_SPEAKERS_DETECTED","critical",{confidence:i.confidence,message:"Multiple voices detected - possible external help"}),this.lastAlertTime=s,this.suspiciousAudioCount=0));const n=this.detectWhispering(this.dataArray,r.volume);n.detected&&s-this.lastAlertTime>this.thresholds.alertCooldown&&(this.triggerAlert("WHISPERING_DETECTED","high",{volume:n.volume,message:"Low-volume speech detected (whispering)"}),this.lastAlertTime=s),this.speechHistory.push({time:s,volume:r.volume,frequencies:this.extractFrequencyProfile(this.dataArray)}),this.consecutiveSpeechFrames++,this.silenceFrames=0}else this.silenceFrames++,this.consecutiveSpeechFrames=0,this.silenceFrames>10&&(this.suspiciousAudioCount=0);this.speechHistory=this.speechHistory.filter(i=>s-i.time<this.thresholds.suspiciousPatternWindow),this.speechHistory.length>20&&this.analyzePatterns(),requestAnimationFrame(()=>this.analyzeAudio())}detectSpeech(t,s){let r=0;for(let d=0;d<s.length;d++)r+=s[d]*s[d];const i=Math.sqrt(r/s.length),n=this.getVoiceFrequencies(t),l=n.reduce((d,c)=>d+c,0)/n.length,g=i>this.thresholds.speechThreshold&&l>30;return this.debugEnabled&&Math.random()<.002&&console.log(`üé§ Audio levels: RMS=${i.toFixed(4)}, VoiceEnergy=${l.toFixed(1)}, IsSpeech=${g}`),{isSpeech:g,volume:i,voiceEnergy:l}}getVoiceFrequencies(t){const r=this.audioContext.sampleRate/this.analyser.fftSize,[i,n]=this.thresholds.frequencyRangeHuman,l=Math.floor(i/r),g=Math.ceil(n/r);return Array.from(t.slice(l,g))}detectMultipleSpeakers(t){if(this.speechHistory.length<5)return{detected:!1};const s=this.extractFrequencyProfile(t),r=this.speechHistory.slice(-10).map(l=>l.frequencies);let i=0;for(let l=0;l<s.length;l++){const g=r.map(f=>f[l]),d=g.reduce((f,y)=>f+y,0)/g.length,c=g.reduce((f,y)=>f+Math.pow(y-d,2),0)/g.length;i+=c}const n=i/s.length;return n>this.thresholds.multipleSpeakersThreshold?{detected:!0,confidence:Math.min(n/this.thresholds.multipleSpeakersThreshold,1),variance:n}:{detected:!1}}extractFrequencyProfile(t){const r=Math.floor(t.length/8),i=[];for(let n=0;n<8;n++){const l=n*r,g=l+r,d=Array.from(t.slice(l,g)),c=d.reduce((f,y)=>f+y,0)/d.length;i.push(c/255)}return i}detectWhispering(t,s){const i=this.getVoiceFrequencies(t).some(n=>n>20);return s>this.thresholds.whisperDetectionThreshold&&s<this.thresholds.speechThreshold&&i?{detected:!0,volume:s.toFixed(4)}:{detected:!1}}analyzePatterns(){const t=Date.now();if(t-this.lastPatternAnalysisTime<this.thresholds.patternAnalysisInterval||(this.lastPatternAnalysisTime=t,this.speechHistory.length<5))return;const s=[];for(let n=1;n<this.speechHistory.length;n++){const l=this.speechHistory[n].time-this.speechHistory[n-1].time;l<2e3&&s.push(l)}if(s.length>=this.thresholds.minPatternIntervals){const n=s.reduce((g,d)=>g+d,0)/s.length;s.reduce((g,d)=>g+Math.pow(d-n,2),0)/s.length<this.thresholds.patternVarianceThreshold&&n<this.thresholds.patternAvgIntervalMax&&t-this.lastPatternAlertTime>this.thresholds.patternAlertCooldown&&(this.triggerAlert("SUSPICIOUS_SPEECH_PATTERN","high",{pattern:"regular_intervals",avgInterval:Math.round(n),message:"Regular speech pattern detected (possible Q&A exchange)"}),this.lastPatternAlertTime=t)}const r=[];for(let n=1;n<this.speechHistory.length;n++){const l=Math.abs(this.speechHistory[n].volume-this.speechHistory[n-1].volume);r.push(l)}const i=r.reduce((n,l)=>n+l,0)/r.length;i>this.thresholds.volumeFluctuationSensitivity&&t-this.lastVolumeFluctuationAlertTime>this.thresholds.volumeFluctuationCooldown&&(this.triggerAlert("VOLUME_FLUCTUATION","medium",{change:i.toFixed(4),message:"Significant volume fluctuations (multiple speakers suspected)"}),this.lastVolumeFluctuationAlertTime=t)}triggerAlert(t,s,r){this.alertCallback&&this.alertCallback({type:t,timestamp:Date.now(),data:{...r,severity:s},warningLevel:this.calculateWarningLevel(s)}),this.debugEnabled&&console.warn("üé§ Audio Alert:",t,r)}calculateWarningLevel(t){return t==="critical"?3:t==="high"?2:t==="medium"?1:0}reset(){this.speechHistory=[],this.lastSpeechTime=null,this.consecutiveSpeechFrames=0,this.silenceFrames=0}}const Sr="http://localhost:4000",Tt="ws://localhost:4000",Nr=({resultId:a,faceDescriptor:t,quizId:s,children:r})=>{const i=m.useRef(null),n=m.useRef(null),l=m.useRef(null),g=m.useRef(null),d=m.useRef(null),c=m.useRef(null),f=m.useRef(null),y=m.useRef(null),M=m.useRef(null),A=m.useRef(null),S=m.useRef(null),R=m.useRef({status:"pending",message:"Awaiting camera signal‚Ä¶"}),w=m.useRef(null),_=m.useRef(null),N=m.useRef(null),[B,E]=m.useState("awaiting-consent"),[$,U]=m.useState([]),[O,j]=m.useState(""),[K,p]=m.useState(!1),[C,h]=m.useState(""),[o,x]=m.useState({camera:"prompt",microphone:"prompt"}),[u,b]=m.useState({status:"pending",message:"Awaiting camera signal‚Ä¶"}),[D,I]=m.useState(null),{token:Z}=J(T=>T.auth),Y=m.useCallback(T=>{const G=R.current;(G.status!==T.status||G.message!==T.message)&&(R.current=T,b(T))},[]),F=m.useCallback(T=>{var G;if(((G=d.current)==null?void 0:G.readyState)===WebSocket.OPEN){const q=new Date().toISOString();d.current.send(JSON.stringify({type:"EVENT",payload:{...T,timestamp:q}})),U(X=>[{...T,timestamp:q},...X.slice(0,9)])}},[]),le=m.useCallback(async T=>{var G,q,X,ne;if(!Z){console.warn("[Proctoring] Skipping violation report because auth token is unavailable.");return}try{const re=T.type.toLowerCase(),he=typeof T.warningLevel=="number"?T.warningLevel:T.warningLevel==="critical"?3:T.warningLevel==="high"?2:T.warningLevel==="medium"?1:0,ge=((G=T.data)==null?void 0:G.severity)||(he>=3?"critical":he===2?"high":he===1?"medium":"low"),Ae=he>=3?"critical":he===2?"high":he===1?"medium":"low",Se=await fetch(`${Sr}/api/proctoring/violations/report`,{method:"POST",headers:{Authorization:`Bearer ${Z}`,"Content-Type":"application/json"},body:JSON.stringify({quizId:s,attemptId:a,violationType:re,severity:ge,warningLevel:Ae,data:T.data||{}})});if(Se.status===401){console.warn("[Proctoring] Violation reporting returned 401. Prompting user to refresh session."),j("Your session expired‚Äîrefresh the page or sign in again to resume secure monitoring.");return}Se.ok||console.error("Failed to report violation:",await Se.text()),ge!=="low"&&(I({type:T.type,severity:ge,message:((q=T.data)==null?void 0:q.message)||"Suspicious activity detected",warningLevel:T.warningLevel||1}),setTimeout(()=>I(null),5e3)),F({eventType:((ne=(X=T.type)==null?void 0:X.toUpperCase)==null?void 0:ne.call(X))||"UNKNOWN",severity:ge,data:T.data})}catch(re){console.error("Failed to report violation:",re)}},[Z,s,a,F]),ee=m.useMemo(()=>{const T=new yr({sendEvent:F,onNotify:G=>{j(`${G.eventType} detected (${G.severity})`),setTimeout(()=>j(""),4e3)}});return y.current=T,T},[F]),Fe=m.useCallback(()=>{if(!Z||!a){console.log("[WebSocket] Missing token or resultId");return}console.log("[WebSocket] Connecting to:",`${Tt}/ws/proctor`);const T=new WebSocket(`${Tt}/ws/proctor`);d.current=T,T.onopen=()=>{console.log("[WebSocket] Connection opened, sending AUTH"),T.send(JSON.stringify({type:"AUTH",token:Z,resultId:a})),E("monitoring")},T.onmessage=G=>{const q=JSON.parse(G.data);console.log("[WebSocket] Received message:",q)},T.onclose=G=>{console.log("[WebSocket] Connection closed:",G.code,G.reason),E("disconnected")},T.onerror=G=>{console.error("[WebSocket] Error:",G),E("error")}},[Z,a]),ye=m.useCallback(async()=>{var T,G;if(n.current){E("monitoring");return}try{if(E("loading-models"),await ct(),E("requesting-permission"),!((T=navigator==null?void 0:navigator.mediaDevices)!=null&&T.getUserMedia)){h("Camera and microphone access are not available in this browser or connection. Use a supported, up-to-date browser over HTTPS or localhost."),E("permission-blocked"),p(!1);return}const q=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});n.current=q,i.current&&(i.current.srcObject=q,i.current.onloadedmetadata=()=>{const X=f.current;X&&i.current&&(X.width=i.current.videoWidth,X.height=i.current.videoHeight,console.log("[Video] Metadata loaded, dimensions:",i.current.videoWidth,"x",i.current.videoHeight),E("calibrating"))}),E("calibrating");try{const X=await Ts.MicVAD.new({onSpeechStart:()=>{M.current=Date.now()},onSpeechEnd:()=>{if(M.current){const ne=Date.now()-M.current;ne>1500&&ee.trigger("VOICE_DETECTED","medium",{durationMs:ne})}M.current=null}});X.start(),l.current=X}catch(X){console.warn("VAD unavailable",X)}Fe(),!w.current&&i.current&&f.current&&(w.current=new br,await w.current.initialize(i.current,f.current,le),w.current.startTracking()),_.current||(_.current=new vr,_.current.initialize(le),console.log("üîç Liveness detection enabled")),!N.current&&q&&(N.current=new wr,await N.current.initialize(q,le)&&(N.current.startListening(),console.log("üé§ Audio detection enabled")))}catch(q){E("awaiting-consent"),p(!1),(q==null?void 0:q.name)==="NotAllowedError"||(q==null?void 0:q.name)==="PermissionDeniedError"?(h("Camera and microphone permissions are blocked for this site. Click the padlock icon near the address bar and allow both camera and microphone before restarting the exam."),E("permission-blocked")):(q==null?void 0:q.name)==="NotFoundError"?h("No camera or microphone was detected. Connect the required devices and try again."):(G=q==null?void 0:q.message)!=null&&G.toLowerCase().includes("secure context")?(h("Camera and microphone access require using HTTPS or localhost. Update the URL and reload the exam."),E("permission-blocked")):h("Camera and microphone access is required to continue. Please allow the browser prompt and try again.")}},[Fe,ee]);return m.useEffect(()=>()=>{n.current&&(n.current.getTracks().forEach(T=>T.stop()),n.current=null),l.current&&l.current.stop(),d.current&&d.current.close(),w.current&&w.current.stopTracking(),_.current&&_.current.reset(),N.current&&N.current.stopListening(),clearInterval(c.current)},[]),m.useEffect(()=>{K&&ye().catch(()=>{})},[K,ye]),m.useEffect(()=>{var X;if(!((X=navigator==null?void 0:navigator.permissions)!=null&&X.query))return;const T=[];let G=!1;const q=async ne=>{try{const re=await navigator.permissions.query({name:ne});if(G)return;const he=()=>{G||(x(Ae=>({...Ae,[ne]:re.state})),re.state==="denied"?(p(!1),E("permission-blocked"),h("Browser permissions for the camera or microphone are blocked. Update your site permissions, then restart proctoring.")):re.state==="granted"&&B==="permission-blocked"&&(h(""),E("awaiting-consent")))},ge=()=>he();he(),re.addEventListener?re.addEventListener("change",ge):re.onchange=ge,T.push({statusRef:re,handler:ge})}catch{}};return["camera","microphone"].forEach(ne=>q(ne)),()=>{G=!0,T.forEach(({statusRef:ne,handler:re})=>{ne.removeEventListener?ne.removeEventListener("change",re):ne.onchange=null})}},[B]),m.useEffect(()=>{var he;if(!t){console.log("[Face Detection] No faceDescriptor available");return}if(!i.current||!i.current.videoWidth){console.log("[Face Detection] Video not ready - videoRef:",!!i.current,"videoWidth:",(he=i.current)==null?void 0:he.videoWidth);return}const T=.48,G=3e3,q=15e3,X=12e3;S.current||(S.current=new xe.TinyFaceDetectorOptions({inputSize:416,scoreThreshold:.3}),console.log("[Face Detection] Initialized with scoreThreshold: 0.3")),console.log("[Face Detection] Creating face matcher with descriptor length:",t.length);const ne=new xe.LabeledFaceDescriptors("candidate",[new Float32Array(t)]);g.current=new xe.FaceMatcher([ne],T),console.log("[Face Detection] Face matcher created successfully");const re=async()=>{var ge,Ae,Se;if(!i.current||!g.current){console.log("[Face Detection] Missing refs - video:",!!i.current,"matcher:",!!g.current);return}try{const de=await xe.detectAllFaces(i.current,S.current).withFaceLandmarks(!0).withFaceDescriptors();console.log(`[Face Detection] Found ${(de==null?void 0:de.length)||0} face(s)`);const v=Date.now();if(de&&de.length>0&&_.current){const k=_.current.analyzeLiveness(de[0],i.current);k&&!k.isLive&&console.warn("‚ö†Ô∏è Liveness check failed:",k)}if(!de||de.length===0){const k=f.current;k&&k.getContext("2d").clearRect(0,0,k.width,k.height),A.current||(A.current=v),v-A.current>G&&ee.trigger("FACE_NOT_DETECTED","medium",{durationMs:v-A.current}),Y({status:"absent",message:"No face detected. Please stay visible."});return}A.current=null,de.length>1&&(ee.trigger("MULTIPLE_FACES_DETECTED","high",{faceCount:de.length},{cooldownMs:q}),Y({status:"multiple",message:"More than one face detected. Only the verified student should be visible."}));const L=de.map(k=>({detection:k,match:g.current.findBestMatch(k.descriptor)})),z=i.current,P=f.current;if(P&&z&&z.videoWidth&&z.videoHeight){(P.width!==z.videoWidth||P.height!==z.videoHeight)&&(P.width=z.videoWidth,P.height=z.videoHeight);const k=P.getContext("2d");k.clearRect(0,0,P.width,P.height),L.forEach(Q=>{var Ct;const ue=(Ct=Q.detection.detection)==null?void 0:Ct.box;if(!ue)return;const At=Q.match.label==="candidate",dt=At&&Q.match.distance<=T?"#22c55e":"#ef4444";k.lineWidth=3,k.strokeStyle=dt,k.strokeRect(ue.x,ue.y,ue.width,ue.height),k.globalAlpha=.15,k.fillStyle=dt,k.fillRect(ue.x,ue.y,ue.width,ue.height),k.globalAlpha=1,k.font='16px "Inter", system-ui, sans-serif',k.fillStyle=dt;const Zt=At?`You (${Q.match.distance.toFixed(3)})`:`Extra face (${Q.match.distance.toFixed(3)})`;k.fillText(Zt,ue.x+4,Math.max(18,ue.y-6))})}const W=L.find(k=>k.match.label==="candidate"),H=L.reduce((k,Q)=>k?Q.match.distance<k.match.distance?Q:k:Q,null);if(!W){if(H!=null&&H.match){ee.trigger("FACE_MISMATCH","high",{distance:Number(H.match.distance.toFixed(3))});const k=(Ae=(ge=H.detection)==null?void 0:ge.detection)==null?void 0:Ae.box;if((Se=i.current)!=null&&Se.videoWidth&&(k!=null&&k.width)){const Q=k.width/i.current.videoWidth;Q<.18&&ee.trigger("SPOOF_RISK_DETECTED","medium",{reason:"face_too_small",relativeWidth:Number(Q.toFixed(3))},{cooldownMs:X})}}else ee.trigger("FACE_MISMATCH","high",{});Y({status:"mismatch",message:"Face does not match the approved reference. Please adjust and try again."});return}const te=L.find(k=>k!==W);te&&ee.trigger("SECONDARY_FACE_PRESENT","medium",{closestDistance:Number(te.match.distance.toFixed(3))},{cooldownMs:q}),W.match.distance>T?(ee.trigger("FACE_MISMATCH","medium",{distance:Number(W.match.distance.toFixed(3))}),Y({status:"mismatch",message:`Face detected but distance ${W.match.distance.toFixed(3)} exceeds the threshold.`})):Y(te?{status:"multiple",message:"Additional face detected alongside the verified student."}:{status:"match",message:`Identity confirmed (distance ${W.match.distance.toFixed(3)}).`})}catch(de){console.error("[Face Detection] Error in runLoop:",de),Y({status:"error",message:"Face detection error. Check console."})}};return re(),c.current=setInterval(re,750),()=>clearInterval(c.current)},[t,ee,Y,B]),m.useEffect(()=>{const T=()=>{document.hidden&&ee.trigger("TAB_SWITCH","medium",{})};return document.addEventListener("visibilitychange",T),()=>document.removeEventListener("visibilitychange",T)},[ee]),m.useEffect(()=>{(async()=>{var G;if(window.getScreenDetails)try{const q=await window.getScreenDetails();q.screens.length>1&&ee.trigger("MULTI_MONITOR_DETECTED","high",{detectionMethod:"WindowManagementAPI",screens:q.screens.length},{cooldownMs:6e4})}catch{}else{const q=(G=window.screen)==null?void 0:G.isExtended,X=window.screenX<0||window.screenY<0||window.screenX>window.screen.width;(q||X)&&ee.trigger("MULTI_MONITOR_DETECTED","medium",{detectionMethod:"Heuristic",isExtended:q,suspiciousCoords:X},{cooldownMs:6e4})}})()},[ee]),K?e.jsxs("div",{style:{display:"grid",gap:"1.5rem"},children:[D&&e.jsxs("div",{role:"alert",style:{position:"fixed",top:"20px",right:"20px",maxWidth:"400px",padding:"1.5rem",borderRadius:"12px",background:D.severity==="critical"?"#7f1d1d":D.severity==="high"?"#991b1b":"#b91c1c",color:"#fff",boxShadow:"0 20px 50px rgba(0,0,0,0.4)",zIndex:9999,border:"2px solid rgba(255,255,255,0.2)",animation:"slideInRight 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"0.75rem"},children:[e.jsx("h4",{style:{margin:0,fontSize:"1.1rem",fontWeight:600},children:"‚ö†Ô∏è Proctoring Alert"}),e.jsx("button",{onClick:()=>I(null),style:{background:"transparent",border:"none",color:"#fff",fontSize:"1.5rem",cursor:"pointer",padding:0,lineHeight:1},children:"√ó"})]}),e.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.95},children:e.jsx("strong",{children:D.type.replace(/_/g," ").toUpperCase()})}),e.jsx("p",{style:{margin:"0.5rem 0 0",fontSize:"0.9rem",opacity:.9},children:D.message}),e.jsxs("div",{style:{marginTop:"0.75rem",padding:"0.5rem",background:"rgba(0,0,0,0.2)",borderRadius:"6px",fontSize:"0.85rem"},children:[e.jsx("strong",{children:"Warning Level:"})," ",D.warningLevel,"/3",e.jsx("br",{}),e.jsx("strong",{children:"Severity:"})," ",D.severity.toUpperCase()]}),e.jsx("p",{style:{margin:"0.75rem 0 0",fontSize:"0.8rem",opacity:.8},children:"Please maintain proper exam conduct. Repeated violations may result in disqualification."})]}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center"},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx("video",{ref:i,autoPlay:!0,muted:!0,playsInline:!0,style:{width:280,borderRadius:"16px",boxShadow:"0 10px 30px rgba(15,23,42,0.25)"}}),e.jsx("canvas",{ref:f,style:{position:"absolute",inset:0,width:"100%",height:"100%",borderRadius:"16px",pointerEvents:"none"}}),e.jsx("span",{style:{position:"absolute",bottom:"0.75rem",left:"0.75rem",background:"#0f172a",color:"#fff",padding:"0.35rem 0.75rem",borderRadius:"999px",fontSize:"0.75rem"},children:B})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h3",{children:"Live proctoring"}),e.jsx("p",{style:{color:"#64748b"},children:"Your camera, microphone, and system signals are analyzed locally. Only anonymized alerts are sent to the server."}),e.jsx("div",{style:{padding:"0.85rem 1rem",borderRadius:"12px",border:"1px solid rgba(148, 163, 184, 0.35)",background:u.status==="match"?"#dcfce7":u.status==="mismatch"||u.status==="multiple"?"#fee2e2":"#f1f5f9",color:u.status==="match"?"#166534":u.status==="mismatch"||u.status==="multiple"?"#b91c1c":"#0f172a"},role:"status",children:u.message}),O&&e.jsx("p",{style:{color:"#ef4444"},children:O}),e.jsxs("div",{children:[e.jsx("h4",{children:"Recent events"}),e.jsxs("ul",{style:{listStyle:"none",padding:0,maxHeight:120,overflowY:"auto"},children:[$.map(T=>e.jsxs("li",{style:{fontSize:"0.85rem",color:"#475569"},children:[e.jsx("strong",{children:T.eventType})," (",T.severity,") ‚Äî ",T.timestamp]},T.timestamp+T.eventType)),$.length===0&&e.jsx("li",{style:{color:"#94a3b8"},children:"No alerts logged."})]})]})]})]}),e.jsx("div",{children:r})]}):e.jsxs("section",{className:"card",style:{maxWidth:760,margin:"1rem auto"},children:[e.jsx("h2",{children:"Enable secure proctoring"}),e.jsx("p",{style:{color:"#475569",lineHeight:1.6},children:"To protect exam integrity, we need temporary access to your camera and microphone. Analysis happens locally in your browser; only anonymized alerts are sent to the server. You can revoke access at any time by leaving the exam or disabling permissions in your browser settings."}),e.jsxs("ul",{style:{color:"#475569",lineHeight:1.6},children:[e.jsx("li",{children:"Camera: verifies your identity and confirms you stay present."}),e.jsx("li",{children:"Microphone: detects sustained speech that may indicate assistance."}),e.jsx("li",{children:"System checks: monitor tab switches and multi-monitor setups."})]}),O&&e.jsx("p",{style:{color:"#ef4444"},children:O}),C&&e.jsxs("div",{role:"alert",style:{margin:"1rem 0",padding:"1rem",borderRadius:"12px",background:"#fee2e2",border:"1px solid #fecaca",color:"#b91c1c"},children:[e.jsx("strong",{children:"Camera & microphone access is blocked."}),e.jsx("p",{style:{marginTop:"0.5rem",color:"#7f1d1d"},children:C}),e.jsxs("ul",{style:{marginTop:"0.5rem",paddingLeft:"1.2rem",color:"#b91c1c"},children:[e.jsx("li",{children:"Chrome: select the padlock icon ‚Üí Site settings ‚Üí Allow Camera & Microphone."}),e.jsx("li",{children:"Edge: select the padlock icon ‚Üí Permissions ‚Üí Reset permissions, then allow the prompt."}),e.jsx("li",{children:"Safari: go to Settings > Websites and enable camera & microphone for this site."})]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Current status ‚Äî camera: ",o.camera,", microphone: ",o.microphone]})]}),e.jsx("button",{type:"button",className:"primary-btn",onClick:()=>{j(""),h(""),p(!0)},children:"I consent and start proctoring"})]})},kr=Rs(Ds(a=>({theme:"light",setTheme:t=>{a({theme:t});const s=window.document.documentElement;if(s.classList.remove("light","dark"),t==="system"){const r=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";s.classList.add(r)}else s.classList.add(t)},toggleTheme:()=>{a(t=>{const s=t.theme==="light"?"dark":"light",r=window.document.documentElement;return r.classList.remove("light","dark"),r.classList.add(s),{theme:s}})}}),{name:"theme-storage"})),Ar=Vs,Cr=Os,qt=ve.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(Es,{ref:r,className:ae("flex h-10 w-full items-center justify-between rounded-md border border-input","bg-background px-3 py-2 text-sm ring-offset-background","placeholder:text-muted-foreground","focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","[&>span]:line-clamp-1",a),...s,children:[t,e.jsx(Ls,{asChild:!0,children:e.jsx(nt,{className:"h-4 w-4 opacity-50"})})]}));qt.displayName="SelectTrigger";const Ht=ve.forwardRef(({className:a,...t},s)=>e.jsx(Ms,{ref:s,className:ae("flex cursor-default items-center justify-center py-1",a),...t,children:e.jsx(kt,{className:"h-4 w-4"})}));Ht.displayName="SelectScrollUpButton";const Vt=ve.forwardRef(({className:a,...t},s)=>e.jsx(Ps,{ref:s,className:ae("flex cursor-default items-center justify-center py-1",a),...t,children:e.jsx(nt,{className:"h-4 w-4"})}));Vt.displayName="SelectScrollDownButton";const Ot=ve.forwardRef(({className:a,children:t,position:s="popper",...r},i)=>e.jsx(Is,{children:e.jsxs(Bs,{ref:i,className:ae("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-border","bg-popover text-popover-foreground shadow-lg","data-[state=open]:animate-fade-in data-[state=closed]:animate-fade-out",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:s,...r,children:[e.jsx(Ht,{}),e.jsx(Ws,{className:ae("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(Vt,{})]})}));Ot.displayName="SelectContent";const zr=ve.forwardRef(({className:a,...t},s)=>e.jsx(_s,{ref:s,className:ae("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...t}));zr.displayName="SelectLabel";const Qt=ve.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(Us,{ref:r,className:ae("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none","focus:bg-accent focus:text-accent-foreground","data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx($s,{children:e.jsx(ds,{className:"h-4 w-4"})})}),e.jsx(qs,{children:t})]}));Qt.displayName="SelectItem";const Tr=ve.forwardRef(({className:a,...t},s)=>e.jsx(Hs,{ref:s,className:ae("-mx-1 my-1 h-px bg-muted",a),...t}));Tr.displayName="SelectSeparator";const Fr=({className:a,size:t="default",...s})=>{const r={sm:"w-4 h-4 border-2",default:"w-8 h-8 border-2",lg:"w-12 h-12 border-4",xl:"w-16 h-16 border-4"};return e.jsx("div",{className:ae("inline-block animate-spin rounded-full border-current border-t-transparent",r[t],a),role:"status","aria-label":"Loading",...s,children:e.jsx("span",{className:"sr-only",children:"Loading..."})})},Ft=[{value:"javascript",label:"JavaScript",extension:".js"},{value:"python",label:"Python",extension:".py"},{value:"java",label:"Java",extension:".java"},{value:"cpp",label:"C++",extension:".cpp"},{value:"c",label:"C",extension:".c"},{value:"csharp",label:"C#",extension:".cs"},{value:"typescript",label:"TypeScript",extension:".ts"},{value:"go",label:"Go",extension:".go"},{value:"rust",label:"Rust",extension:".rs"},{value:"php",label:"PHP",extension:".php"},{value:"ruby",label:"Ruby",extension:".rb"},{value:"sql",label:"SQL",extension:".sql"}],Be={javascript:`// Write your JavaScript code here
console.log("Hello, World!");`,python:`# Write your Python code here
print("Hello, World!")`,java:`public class Main {
    public static void main(String[] args) {
        System.out.println("Hello, World!");
    }
}`,cpp:`#include <iostream>
using namespace std;

int main() {
    cout << "Hello, World!" << endl;
    return 0;
}`,c:`#include <stdio.h>

int main() {
    printf("Hello, World!\\n");
    return 0;
}`,csharp:`using System;

class Program {
    static void Main() {
        Console.WriteLine("Hello, World!");
    }
}`,typescript:`// Write your TypeScript code here
console.log("Hello, World!");`,go:`package main

import "fmt"

func main() {
    fmt.Println("Hello, World!")
}`,rust:`fn main() {
    println!("Hello, World!");
}`,php:`<?php
echo "Hello, World!";
?>`,ruby:`# Write your Ruby code here
puts "Hello, World!"`,sql:`-- Write your SQL query here
SELECT "Hello, World!";`};function Rr({initialCode:a="",language:t="javascript",onLanguageChange:s,onCodeChange:r,onRunCode:i,readOnly:n=!1,height:l="500px",showToolbar:g=!0,allowLanguageChange:d=!0}){const c=m.useRef(null),{theme:f}=kr(),[y,M]=m.useState(a||Be[t]),[A,S]=m.useState(t),[R,w]=m.useState(!1),[_,N]=m.useState(14),[B,E]=m.useState(!1);m.useEffect(()=>{a?M(a):Be[A]&&M(Be[A])},[a,A]);const $=(o,x)=>{c.current=o,o.addCommand(x.KeyMod.CtrlCmd|x.KeyCode.Enter,()=>{i&&i()}),o.addCommand(x.KeyMod.CtrlCmd|x.KeyCode.KeyS,u=>{u.preventDefault(),K()}),x.editor.defineTheme("customDark",{base:"vs-dark",inherit:!0,rules:[],colors:{"editor.background":"#1e1e1e","editor.foreground":"#d4d4d4","editor.lineHighlightBackground":"#2a2a2a","editorLineNumber.foreground":"#858585","editorCursor.foreground":"#ffffff","editor.selectionBackground":"#264f78","editor.inactiveSelectionBackground":"#3a3d41"}}),x.editor.defineTheme("customLight",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#ffffff","editor.foreground":"#000000","editor.lineHighlightBackground":"#f0f0f0","editorLineNumber.foreground":"#237893","editorCursor.foreground":"#000000","editor.selectionBackground":"#add6ff","editor.inactiveSelectionBackground":"#e5ebf1"}})},U=o=>{M(o),r&&r(o)},O=o=>{S(o),s&&s(o),a||M(Be[o]||"")},j=()=>{const o=Be[A]||"";M(o),r&&r(o)},K=()=>{const o=Ft.find(I=>I.value===A),x=`code${(o==null?void 0:o.extension)||".txt"}`,u=new Blob([y],{type:"text/plain"}),b=URL.createObjectURL(u),D=document.createElement("a");D.href=b,D.download=x,D.click(),URL.revokeObjectURL(b)},p=()=>{const o=document.createElement("input");o.type="file",o.accept=".js,.py,.java,.cpp,.c,.cs,.ts,.go,.rs,.php,.rb,.sql",o.onchange=x=>{const u=x.target.files[0];if(u){const b=new FileReader;b.onload=D=>{const I=D.target.result;M(I),r&&r(I)},b.readAsText(u)}},o.click()},C=()=>{w(!R)},h=()=>f==="dark"?"customDark":f==="light"?"customLight":window.matchMedia("(prefers-color-scheme: dark)").matches?"customDark":"customLight";return e.jsxs("div",{className:`border rounded-lg overflow-hidden ${R?"fixed inset-0 z-50 bg-background":""}`,children:[g&&e.jsxs("div",{className:"flex items-center justify-between gap-2 p-2 border-b bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsxs(Ar,{value:A,onValueChange:O,children:[e.jsx(qt,{className:"w-[180px] h-9",children:e.jsx(Cr,{})}),e.jsx(Ot,{children:Ft.map(o=>e.jsx(Qt,{value:o.value,children:o.label},o.value))})]}),i&&e.jsxs(se,{size:"sm",onClick:i,disabled:n,className:"gap-1",children:[e.jsx(us,{className:"h-4 w-4"}),"Run",e.jsx("kbd",{className:"ml-1 text-xs opacity-70",children:"(Ctrl+Enter)"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[!n&&e.jsxs(e.Fragment,{children:[e.jsx(se,{size:"sm",variant:"ghost",onClick:j,title:"Reset to default",children:e.jsx(ms,{className:"h-4 w-4"})}),e.jsx(se,{size:"sm",variant:"ghost",onClick:p,title:"Upload file",children:e.jsx(hs,{className:"h-4 w-4"})})]}),e.jsx(se,{size:"sm",variant:"ghost",onClick:K,title:"Download file",children:e.jsx(ps,{className:"h-4 w-4"})}),e.jsx(se,{size:"sm",variant:"ghost",onClick:C,title:"Toggle fullscreen",children:R?e.jsx(gs,{className:"h-4 w-4"}):e.jsx(fs,{className:"h-4 w-4"})}),e.jsx(se,{size:"sm",variant:"ghost",onClick:()=>E(!B),title:"Settings",children:e.jsx(Pt,{className:"h-4 w-4"})})]})]}),B&&e.jsx("div",{className:"p-3 border-b bg-muted/30 flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Font Size:"}),e.jsxs("select",{value:_,onChange:o=>N(Number(o.target.value)),className:"px-2 py-1 border rounded text-sm",children:[e.jsx("option",{value:"12",children:"12px"}),e.jsx("option",{value:"14",children:"14px"}),e.jsx("option",{value:"16",children:"16px"}),e.jsx("option",{value:"18",children:"18px"}),e.jsx("option",{value:"20",children:"20px"})]})]})}),e.jsx(Fs,{height:R?"calc(100vh - 120px)":l,language:A,value:y,onChange:U,onMount:$,theme:h(),options:{fontSize:_,minimap:{enabled:R},scrollBeyondLastLine:!1,automaticLayout:!0,tabSize:2,wordWrap:"on",lineNumbers:"on",readOnly:n,formatOnPaste:!0,formatOnType:!0,suggest:{enabled:!0},quickSuggestions:{other:!0,comments:!0,strings:!0},padding:{top:16,bottom:16}},loading:e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(Fr,{size:"lg"})})})]})}const Dr=()=>{const{quizId:a}=wt(),t=pe(),s=je(),{current:r,status:i}=J(v=>v.quizzes),{current:n}=J(v=>v.results),{user:l}=J(v=>v.auth),[g,d]=m.useState({}),[c,f]=m.useState(0),[y,M]=m.useState(!1),[A,S]=m.useState(null),[R,w]=m.useState(null),_=m.useRef(null),[N,B]=m.useState(!1),[E,$]=m.useState("idle"),[U,O]=m.useState(""),[j,K]=m.useState(null),p=m.useRef(null),C=m.useRef(null),h=m.useMemo(()=>Te(l),[l]);m.useEffect(()=>{t($e(a))},[t,a]),m.useEffect(()=>{r&&(!n||n.quiz!==r._id||n.status!=="in-progress")&&t(Xe(r._id))},[t,r,n]),m.useEffect(()=>{if(r!=null&&r.timeLimit&&(n==null?void 0:n.status)==="in-progress"){const v=Date.now();return w(v),S(r.timeLimit*60),_.current=setInterval(()=>{const L=Math.floor((Date.now()-v)/1e3),z=r.timeLimit*60-L;z<=0?(S(0),clearInterval(_.current),Se()):S(z)},1e3),()=>{_.current&&clearInterval(_.current)}}},[r,n]);const o=m.useMemo(()=>r!=null&&r.expiryDate?new Date(r.expiryDate)<new Date:!1,[r]),{list:x}=J(v=>v.results),{attemptsTaken:u,attemptsRemaining:b,canTakeQuiz:D}=m.useMemo(()=>{const v=rt(r);if(!v||!h)return{attemptsTaken:0,attemptsRemaining:null,canTakeQuiz:!0};const z=x.filter(H=>{const te=rt(H.quiz),k=Ie(H);return(H.status==="submitted"||H.status==="completed")&&te===v&&k===h}).length,P=r.maxAttempts;if(!P)return{attemptsTaken:z,attemptsRemaining:null,canTakeQuiz:!0};const W=P-z;return{attemptsTaken:z,attemptsRemaining:W,canTakeQuiz:W>0}},[r,x,h]);m.useEffect(()=>{l&&(l.role==="admin"||l.role==="instructor"||l.isFaceVerified?B(!0):l.hasReferenceFace?l.role==="student"&&l.hasReferenceFace&&!l.isFaceVerified&&(B(!1),$("idle")):B(!0))},[l]);const I=async()=>{try{$("loading"),O("Loading face detection models..."),await ct(),O("Requesting camera access...");const v=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});K(v),p.current&&(p.current.srcObject=v,await p.current.play()),$("ready"),O('Camera ready. Click "Verify my identity" to begin.')}catch(v){console.error("Camera access error:",v),$("error"),O(v.name==="NotAllowedError"?"Camera access denied. Please allow camera access in your browser settings.":"Failed to access camera. Please check your camera connection.")}},Z=async()=>{if(!(!p.current||!C.current))try{$("verifying"),O("Analyzing your face...");const v=C.current,L=v.getContext("2d");v.width=p.current.videoWidth,v.height=p.current.videoHeight,L.drawImage(p.current,0,0,v.width,v.height);const z=await xe.detectSingleFace(p.current,new xe.TinyFaceDetectorOptions).withFaceLandmarks(!0).withFaceDescriptor();if(!z){$("error"),O("No face detected. Please ensure your face is clearly visible and try again.");return}const P=Array.from(z.descriptor);await t(Ue(P)).unwrap(),$("success"),O("Identity confirmed! You may now start the quiz."),j&&(j.getTracks().forEach(W=>W.stop()),K(null)),setTimeout(()=>{B(!0)},2e3)}catch(v){console.error("Verification error:",v),$("error"),O(v.message||"Verification failed. Please adjust lighting and try again.")}};m.useEffect(()=>()=>{j&&j.getTracks().forEach(v=>v.stop())},[j]);const Y=m.useMemo(()=>(r==null?void 0:r.questions)??[],[r]),F=Y[c],le=F?g[F._id]||{}:{};m.useEffect(()=>{r!=null&&r._id&&(d({}),f(0))},[r==null?void 0:r._id]);const ee=m.useCallback((v,L)=>{var P,W;if(!v)return!1;const z=L||{};switch(v.questionType){case"multiple-choice":case"true-false":return!!z.selectedOption;case"code":return!!(z.codeAnswer&&z.codeAnswer.trim());case"fill-in-blank":{const H=((P=v.blankAnswers)==null?void 0:P.length)||1,te=Array.isArray(z.blankAnswers)?z.blankAnswers:[];return te.length<H?!1:te.every(k=>typeof k=="string"&&k.trim())}case"matching":{const H=((W=v.matchingPairs)==null?void 0:W.length)||0,te=Array.isArray(z.matchingAnswers)?z.matchingAnswers:[];return te.length<H?!1:v.matchingPairs.every(k=>{const Q=te.find(ue=>ue.left===k.left);return Q&&Q.right})}case"essay":return!!(z.essayAnswer&&z.essayAnswer.trim());case"file-upload":return Array.isArray(z.uploadedFiles)&&z.uploadedFiles.length>0;default:return!!z.selectedOption}},[]),{answeredCount:Fe,unansweredCount:ye}=m.useMemo(()=>{const v=Y.reduce((L,z)=>{const P=g[z._id];return ee(z,P)?L+1:L},0);return{answeredCount:v,unansweredCount:Math.max(Y.length-v,0)}},[Y,g,ee]);m.useEffect(()=>{if(Y.length===0){f(0);return}f(v=>v>=Y.length?Y.length-1:v<0?0:v)},[Y.length]);const T=m.useCallback((v,L)=>{d(z=>{const P=z[v]||{},W=L(P)||{};return{...z,[v]:W}})},[]),G=m.useCallback((v,L)=>{T(v,z=>({...z,selectedOption:L}))},[T]),q=m.useCallback((v,L)=>{T(v,z=>({...z,codeAnswer:L}))},[T]),X=m.useCallback((v,L,z,P)=>{T(v,W=>{const H=Array.from({length:P},(te,k)=>{var Q;return((Q=W.blankAnswers)==null?void 0:Q[k])||""});return H[L]=z,{...W,blankAnswers:H}})},[T]),ne=m.useCallback((v,L,z)=>{T(v,P=>{const W=Array.isArray(P.matchingAnswers)?[...P.matchingAnswers]:[],H=W.findIndex(k=>k.left===L),te={left:L,right:z};return H>=0?W[H]=te:W.push(te),{...P,matchingAnswers:W}})},[T]),re=m.useCallback((v,L)=>{T(v,z=>({...z,essayAnswer:L}))},[T]),he=m.useCallback((v,L)=>{const z=Array.from(L||[]).map(P=>({name:P.name,size:P.size,type:P.type}));T(v,P=>({...P,uploadedFiles:z}))},[T]),ge=()=>{f(v=>{const L=Math.max(Y.length-1,0);return Math.min(v+1,L)})},Ae=()=>{f(v=>Math.max(v-1,0))},Se=async()=>{if(!n||!r)return;M(!0);const v=Y.reduce((L,z)=>{var te;const P=g[z._id]||{},W={questionId:z._id},H=Number(z.maxScore)>0?Number(z.maxScore):1;switch(z.questionType){case"multiple-choice":if(W.selectedOption=P.selectedOption||"",W.selectedOption){const k=`${W.selectedOption}`.trim().toLowerCase(),Q=`${z.correctAnswer||""}`.trim().toLowerCase();k&&k===Q&&(L.score+=H)}L.maxScore+=H;break;case"true-false":{const k=P.selectedOption??"";if(W.selectedOption=k,k!==""){const Q=`${k}`.trim().toLowerCase(),ue=`${z.correctAnswer||""}`.trim().toLowerCase();Q&&Q===ue&&(L.score+=H)}L.maxScore+=H;break}case"code":{const k=P.codeAnswer||"";W.textAnswer=k,W.codeAnswer=k,L.maxScore+=H;break}case"fill-in-blank":{const k=Array.isArray(P.blankAnswers)?P.blankAnswers:Array.from({length:((te=z.blankAnswers)==null?void 0:te.length)||1},()=>"");W.blankAnswers=k,W.textAnswer=k.join(" || "),W.partialCredit=!!z.partialCredit,L.maxScore+=H;break}case"matching":{const k=Array.isArray(P.matchingAnswers)?P.matchingAnswers:[];W.matchingAnswers=k,W.textAnswer=k.filter(Q=>Q&&Q.left&&Q.right).map(Q=>`${Q.left} ‚Üí ${Q.right}`).join(" | "),W.partialCredit=!!z.partialCredit,L.maxScore+=H;break}case"essay":{const k=P.essayAnswer||"";W.essayAnswer=k,W.textAnswer=k,L.maxScore+=H;break}case"file-upload":{const k=Array.isArray(P.uploadedFiles)?P.uploadedFiles:[];W.uploadedFiles=k,W.textAnswer=k.map(Q=>Q.name).join(", "),W.maxFileSize=z.maxFileSize,L.maxScore+=H;break}default:W.selectedOption=P.selectedOption||"",L.maxScore+=H}return L.answers.push(W),L},{answers:[],score:0,maxScore:0});try{await t(Ut({resultId:n._id,answers:v.answers,score:v.score})).unwrap(),s(`/results/${n._id}`)}catch(L){console.error(L)}finally{M(!1)}},de=m.useCallback(v=>!Number.isFinite(v)||v<=0?"":v>=1024*1024?`${(v/(1024*1024)).toFixed(1)} MB`:v>=1024?`${(v/1024).toFixed(1)} KB`:`${v} B`,[]);return i==="loading"||!r?e.jsx("p",{children:"Loading quiz‚Ä¶"}):!N&&(l==null?void 0:l.role)==="student"&&(l!=null&&l.hasReferenceFace)&&!(l!=null&&l.isFaceVerified)?e.jsxs("section",{className:"card",style:{maxWidth:"900px",margin:"2rem auto"},children:[e.jsx("h1",{children:"Face Verification"}),e.jsx("p",{style:{color:"#64748b",maxWidth:"600px",marginBottom:"1.5rem"},children:"Please verify your identity before starting proctored exams. The captured frame is used only for comparison with the administrator-approved reference photo."}),U&&e.jsxs("div",{style:{margin:"1rem 0",padding:"0.85rem 1rem",borderRadius:"12px",border:"1px solid rgba(148, 163, 184, 0.35)",background:E==="success"?"#dcfce7":E==="error"?"#fee2e2":E==="verifying"?"#fef9c3":"#f1f5f9",color:E==="success"?"#166534":E==="error"?"#b91c1c":E==="verifying"?"#854d0e":"#0f172a",display:"flex",alignItems:"center",gap:"0.75rem"},children:[E==="success"&&e.jsx(be,{size:20}),E==="error"&&e.jsx(It,{size:20}),E==="verifying"&&e.jsx(ze,{size:20}),e.jsx("span",{children:U})]}),e.jsxs("div",{style:{margin:"1.5rem 0",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{style:{position:"relative",width:"fit-content",margin:"0 auto"},children:[e.jsx("video",{ref:p,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"480px",maxWidth:"100%",borderRadius:"12px",border:"2px solid #e2e8f0",background:"#0f172a",display:j?"block":"none"}}),e.jsx("canvas",{ref:C,style:{display:"none"}}),!j&&e.jsxs("div",{style:{width:"480px",maxWidth:"100%",height:"360px",borderRadius:"12px",border:"2px dashed #cbd5e1",background:"#f8fafc",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"1rem",color:"#64748b"},children:[e.jsx(xs,{size:48}),e.jsx("p",{children:"Camera preview will appear here"})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[!j&&E!=="success"&&e.jsx("button",{type:"button",className:"primary-btn",onClick:I,disabled:E==="loading",style:{minWidth:"200px"},children:E==="loading"?"Loading...":"Enable camera"}),j&&E==="ready"&&e.jsx("button",{type:"button",className:"primary-btn",onClick:Z,style:{minWidth:"200px"},children:"Verify my identity"}),E==="error"&&j&&e.jsx("button",{type:"button",className:"primary-btn",onClick:Z,style:{minWidth:"200px"},children:"Try again"})]})]}),e.jsxs("div",{style:{marginTop:"2rem",padding:"1.5rem",background:"#f8fafc",borderRadius:"12px",border:"1px solid #e2e8f0"},children:[e.jsx("h3",{style:{fontSize:"1rem",marginBottom:"1rem"},children:"Verification steps"}),e.jsxs("ol",{style:{paddingLeft:"1.5rem",margin:0,color:"#475569",lineHeight:"1.8"},children:[e.jsx("li",{children:'Click "Enable camera" and allow access in the browser prompt.'}),e.jsx("li",{children:"Look directly at the camera with even lighting."}),e.jsx("li",{children:'Press "Verify my identity" to begin the comparison. If you see a mismatch, adjust your lighting and try again.'})]})]}),e.jsx("div",{style:{marginTop:"1.5rem",textAlign:"center"},children:e.jsx("button",{type:"button",onClick:()=>s("/dashboard"),style:{background:"transparent",border:"1px solid #cbd5e1",padding:"0.5rem 1.5rem",borderRadius:"8px",cursor:"pointer",color:"#475569"},children:"Back to Dashboard"})})]}):o?e.jsxs("section",{className:"card",style:{maxWidth:"600px",margin:"2rem auto",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"‚è∞"}),e.jsx("h1",{children:"Quiz Expired"}),e.jsxs("p",{style:{color:"#64748b",marginBottom:"2rem"},children:["This quiz expired on ",new Date(r.expiryDate).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),"."]}),e.jsx("button",{type:"button",className:"primary-btn",onClick:()=>s("/dashboard"),children:"Back to Dashboard"})]}):!D&&(l==null?void 0:l.role)!=="admin"?e.jsxs("section",{className:"card",style:{maxWidth:"600px",margin:"2rem auto",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"üö´"}),e.jsx("h1",{children:"Maximum Attempts Reached"}),e.jsxs("p",{style:{color:"#64748b",marginBottom:"2rem"},children:["You have reached the maximum number of attempts (",r.maxAttempts,") for this quiz. You have already attempted this quiz ",u," time",u!==1?"s":"","."]}),e.jsx("button",{type:"button",className:"primary-btn",onClick:()=>s("/results"),children:"View My Results"})]}):n?e.jsx(Nr,{resultId:n._id,faceDescriptor:l==null?void 0:l.faceDescriptor,quizId:r._id,children:e.jsxs("section",{className:"card",style:{minHeight:"500px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h1",{children:r.title}),e.jsxs("span",{style:{color:"#94a3b8"},children:["Question ",c+1," of ",Y.length]})]}),e.jsx("p",{style:{color:"#64748b",marginBottom:"1rem"},children:r.description}),(l==null?void 0:l.role)==="student"&&!(l!=null&&l.hasReferenceFace)&&e.jsxs("div",{style:{marginBottom:"1rem",padding:"0.75rem 1rem",borderRadius:"10px",border:"1px solid rgba(148, 163, 184, 0.45)",background:"#f8fafc",color:"#0f172a",display:"flex",gap:"0.75rem",alignItems:"flex-start"},children:[e.jsx(ze,{size:18,style:{flexShrink:0,color:"#d97706",marginTop:"0.15rem"}}),e.jsxs("div",{children:[e.jsx("strong",{style:{display:"block",marginBottom:"0.25rem"},children:"Limited proctoring in effect"}),e.jsx("span",{style:{color:"#475569"},children:"We couldn't find a reference photo for you, so facial matching is disabled for this attempt. Visit your profile to enrol a reference face and unlock full proctoring protection."})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",marginBottom:"1rem",flexWrap:"wrap"},children:[r.timeLimit&&A!==null&&e.jsxs("div",{style:{padding:"0.5rem 1rem",background:A<300?"#fef2f2":"#eff6ff",border:`1px solid ${A<300?"#fecaca":"#bfdbfe"}`,borderRadius:"8px",display:"flex",alignItems:"center",gap:"0.5rem",color:A<300?"#dc2626":"#2563eb",fontWeight:"600"},children:[e.jsx("span",{children:"‚è±Ô∏è"}),e.jsxs("span",{children:["Time Remaining: ",Math.floor(A/60),":",String(A%60).padStart(2,"0")]})]}),r.maxAttempts&&e.jsxs("div",{style:{padding:"0.5rem 1rem",background:"#fef3c7",border:"1px solid #fcd34d",borderRadius:"8px",display:"flex",alignItems:"center",gap:"0.5rem",color:"#92400e",fontSize:"0.875rem"},children:[e.jsx("span",{children:"üìù"}),e.jsxs("span",{children:["Attempt: ",u+1," of ",r.maxAttempts,b!==null&&` (${b} remaining)`]})]}),r.expiryDate&&!o&&e.jsxs("div",{style:{padding:"0.5rem 1rem",background:"#fef3c7",border:"1px solid #fcd34d",borderRadius:"8px",display:"flex",alignItems:"center",gap:"0.5rem",color:"#92400e",fontSize:"0.875rem"},children:[e.jsx("span",{children:"üìÖ"}),e.jsxs("span",{children:["Expires: ",new Date(r.expiryDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{flex:1,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#10b981"},children:Fe}),e.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b"},children:"Answered"})]}),e.jsxs("div",{style:{flex:1,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#f59e0b"},children:ye}),e.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b"},children:"Unanswered"})]}),e.jsxs("div",{style:{flex:1,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#2563eb"},children:Y.length}),e.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b"},children:"Total"})]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"0.5rem"},children:"Question Navigation:"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem"},children:Y.map((v,L)=>{const z=ee(v,g[v._id]);return e.jsx("button",{type:"button",onClick:()=>f(L),style:{padding:"0.5rem 0.75rem",borderRadius:"6px",border:c===L?"2px solid #2563eb":"1px solid #e2e8f0",background:z?"#10b98133":"#ffffff",color:c===L?"#2563eb":"#0f172a",cursor:"pointer",fontWeight:c===L?"600":"400",minWidth:"40px"},children:L+1},v._id)})})]}),F?e.jsxs("article",{style:{marginTop:"1.5rem",minHeight:"300px"},children:[e.jsx("h2",{style:{color:"#0f172a",marginBottom:"1rem"},children:F.questionText}),F.questionType==="multiple-choice"&&e.jsx("div",{style:{display:"grid",gap:"0.75rem",marginTop:"1rem"},children:F.options&&F.options.length>0?F.options.map((v,L)=>{const z=le.selectedOption===v;return e.jsxs("label",{style:{padding:"0.9rem 1rem",borderRadius:"10px",border:z?"2px solid #2563eb":"1px solid #e2e8f0",cursor:"pointer",background:z?"#eff6ff":"#ffffff",transition:"all 0.2s"},children:[e.jsx("input",{type:"radio",name:F._id,value:v,checked:z,onChange:()=>G(F._id,v),style:{marginRight:"0.75rem"}}),e.jsx("span",{style:{color:"#0f172a"},children:v})]},`${F._id}-${L}`)}):e.jsx("p",{style:{color:"#ef4444"},children:"No options available for this question."})}),F.questionType==="true-false"&&e.jsx("div",{style:{display:"flex",gap:"1rem",marginTop:"1rem",flexWrap:"wrap"},children:["True","False"].map(v=>{const L=le.selectedOption===v;return e.jsxs("label",{style:{padding:"0.9rem 1rem",borderRadius:"10px",border:L?"2px solid #2563eb":"1px solid #e2e8f0",cursor:"pointer",background:L?"#eff6ff":"#ffffff",transition:"all 0.2s",display:"flex",alignItems:"center"},children:[e.jsx("input",{type:"radio",name:F._id,value:v,checked:L,onChange:()=>G(F._id,v),style:{marginRight:"0.75rem"}}),e.jsx("span",{style:{color:"#0f172a"},children:v})]},`${F._id}-${v}`)})}),F.questionType==="code"&&e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"0.75rem",background:"#f1f5f9",borderRadius:"6px",marginBottom:"1rem",border:"1px solid #e2e8f0"},children:[e.jsxs("p",{style:{margin:0,fontSize:"0.875rem",color:"#64748b"},children:[e.jsx("strong",{children:"Language:"})," ",F.codeLanguage||"javascript"]}),F.evaluationNotes&&e.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.875rem",color:"#475569"},children:[e.jsx("strong",{children:"Note:"})," ",F.evaluationNotes]})]}),e.jsx(Rr,{initialCode:le.codeAnswer??F.starterCode??"",language:F.codeLanguage||"javascript",onCodeChange:v=>q(F._id,v),height:"400px",showToolbar:!1,allowLanguageChange:!1})]}),F.questionType==="fill-in-blank"&&(()=>{var z;const v=((z=F.blankAnswers)==null?void 0:z.length)||1,L=Array.from({length:v},(P,W)=>{var H;return((H=le.blankAnswers)==null?void 0:H[W])||""});return e.jsxs("div",{style:{marginTop:"1rem",display:"flex",flexDirection:"column",gap:"0.85rem"},children:[L.map((P,W)=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.35rem"},children:[e.jsxs("label",{style:{fontWeight:600,color:"#0f172a"},children:["Blank ",W+1]}),e.jsx("input",{value:P,onChange:H=>X(F._id,W,H.target.value,v),placeholder:`Enter response for blank ${W+1}`,style:{padding:"0.65rem 0.85rem",borderRadius:"8px",border:"1px solid #cbd5e1"}})]},`${F._id}-blank-${W}`)),e.jsxs("div",{style:{fontSize:"0.85rem",color:"#64748b",display:"flex",flexDirection:"column",gap:"0.25rem"},children:[e.jsx("span",{children:F.caseSensitive?"Answers are case sensitive.":"Answers are not case sensitive."}),F.partialCredit&&e.jsx("span",{children:"Partial credit is available for partially correct responses."})]})]})})(),F.questionType==="matching"&&(()=>{var z;const v=Array.from(new Set((F.matchingPairs||[]).map(P=>P==null?void 0:P.right).filter(Boolean))),L=Array.isArray(le.matchingAnswers)?le.matchingAnswers:[];return e.jsxs("div",{style:{marginTop:"1rem",display:"flex",flexDirection:"column",gap:"1rem"},children:[(z=F.matchingPairs)==null?void 0:z.map((P,W)=>{var te;const H=((te=L.find(k=>k.left===P.left))==null?void 0:te.right)||"";return e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(160px, 1fr) minmax(200px, 2fr)",gap:"1rem",alignItems:"center"},children:[e.jsx("div",{style:{padding:"0.75rem 1rem",background:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0",color:"#0f172a"},children:P.left}),e.jsxs("select",{"aria-label":`Match for ${P.left}`,value:H,onChange:k=>ne(F._id,P.left,k.target.value),style:{padding:"0.65rem 0.85rem",borderRadius:"8px",border:"1px solid #cbd5e1"},children:[e.jsx("option",{value:"",children:"Select the matching answer"}),v.map(k=>e.jsx("option",{value:k,children:k},`${F._id}-target-${k}`))]})]},`${F._id}-match-${W}`)}),F.partialCredit&&e.jsx("small",{style:{color:"#64748b"},children:"Partial credit may be awarded for partially correct matches."})]})})(),F.questionType==="essay"&&e.jsxs("div",{style:{marginTop:"1rem",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[F.wordLimit&&e.jsxs("span",{style:{color:"#64748b",fontSize:"0.9rem"},children:["Word limit: ",F.wordLimit," words"]}),e.jsx("textarea",{rows:F.wordLimit&&F.wordLimit<=200?8:10,value:le.essayAnswer||"",onChange:v=>re(F._id,v.target.value),placeholder:"Write your response here...",style:{padding:"0.75rem 1rem",borderRadius:"10px",border:"1px solid #cbd5e1",minHeight:"200px",lineHeight:1.5}}),F.rubric&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"#475569"},children:[e.jsx("strong",{children:"Focus on:"})," ",F.rubric]}),F.sampleAnswer&&e.jsxs("details",{style:{fontSize:"0.85rem",color:"#475569"},children:[e.jsx("summary",{style:{cursor:"pointer"},children:"View instructor sample answer"}),e.jsx("p",{style:{marginTop:"0.5rem"},children:F.sampleAnswer})]})]}),F.questionType==="file-upload"&&e.jsxs("div",{style:{marginTop:"1rem",display:"flex",flexDirection:"column",gap:"0.85rem"},children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`${F._id}-file-upload`,style:{fontWeight:600,color:"#0f172a",display:"block",marginBottom:"0.35rem"},children:"Upload supporting files"}),e.jsx("input",{id:`${F._id}-file-upload`,type:"file",multiple:!0,accept:(F.allowedFileTypes||[]).map(v=>`.${v}`).join(",")||void 0,onChange:v=>{he(F._id,v.target.files),v.target.value=""}}),e.jsxs("small",{style:{display:"block",marginTop:"0.35rem",color:"#64748b"},children:[F.allowedFileTypes&&F.allowedFileTypes.length?`Allowed types: ${F.allowedFileTypes.join(", ")}`:"All file types allowed",F.maxFileSize&&` ‚Ä¢ Max size: ${F.maxFileSize} MB per file`]})]}),Array.isArray(le.uploadedFiles)&&le.uploadedFiles.length>0?e.jsx("ul",{style:{listStyle:"none",padding:0,margin:0,display:"flex",flexDirection:"column",gap:"0.5rem"},children:le.uploadedFiles.map((v,L)=>e.jsxs("li",{style:{padding:"0.65rem 0.85rem",borderRadius:"8px",border:"1px solid #e2e8f0",background:"#f8fafc",color:"#0f172a",display:"flex",justifyContent:"space-between",gap:"1rem"},children:[e.jsx("span",{children:v.name}),e.jsx("span",{style:{color:"#64748b",fontSize:"0.85rem"},children:de(v.size)})]},`${F._id}-file-${L}`))}):e.jsx("p",{style:{color:"#64748b",fontSize:"0.9rem"},children:"No files selected yet. Attach your work before submitting."}),e.jsx("small",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:"Files are stored for manual review. Large uploads may take additional time to process."})]})]}):e.jsx("div",{style:{marginTop:"1.5rem",padding:"2rem",textAlign:"center",background:"#fef3c7",borderRadius:"8px"},children:e.jsx("p",{style:{color:"#92400e"},children:"‚ö†Ô∏è Unable to load question. Please try refreshing the page."})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"2rem"},children:[e.jsx("button",{type:"button",className:"primary-btn",onClick:Ae,disabled:c===0,children:"Previous"}),c<Y.length-1?e.jsx("button",{type:"button",className:"primary-btn",onClick:ge,children:"Next"}):e.jsx("button",{type:"button",className:"primary-btn",onClick:Se,disabled:y||ye>0,title:ye>0?`Please answer all questions (${ye} remaining)`:"Submit your exam",children:y?"Submitting‚Ä¶":ye>0?`Answer ${ye} more to submit`:"Submit Exam"})]}),c===Y.length-1&&ye>0&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"#fef3c7",border:"1px solid #fbbf24",borderRadius:"8px",color:"#92400e"},children:[e.jsx("strong",{children:"‚ö†Ô∏è Attention:"})," You have ",ye," unanswered question",ye!==1?"s":"",". Please answer all questions before submitting."]})]})}):e.jsx("p",{children:"Preparing your proctoring session‚Ä¶"})},Er=()=>{const a=pe(),t=je(),{user:s}=J(f=>f.auth),{list:r,listStatus:i,listError:n}=J(f=>f.results),l=(s==null?void 0:s.role)==="admin",g=(s==null?void 0:s.role)==="instructor",d=m.useMemo(()=>Te(s),[s]);m.useEffect(()=>{s&&(l||g?a(Ee()):d&&a(Ce(d)))},[a,s,l,g,d]);const c=m.useMemo(()=>Array.isArray(r)?l?r:g?r.filter(f=>{const y=Oe(f==null?void 0:f.quiz);return d&&y===d}):d?r.filter(f=>Ie(f)===d):r:[],[r,l,g,d]);return e.jsxs("section",{className:"card",children:[e.jsx("h1",{children:"Exam History"}),e.jsx("p",{style:{color:"#64748b"},children:l?"Review all student submissions, scores, and proctoring alerts.":g?"Monitor learner submissions, scores, and proctoring alerts for your quizzes.":"Review your scores and any proctoring alerts captured during each session."}),i==="loading"&&e.jsx("p",{children:"Loading results‚Ä¶"}),n&&e.jsx("p",{style:{color:"#ef4444"},children:n}),i!=="loading"&&e.jsxs("div",{className:"grid",children:[c.map(f=>{var R,w,_;const y=f.submittedAt||f.updatedAt||f.createdAt,M=((R=f.user)==null?void 0:R.username)||"Unknown",A=f.score||0,S=((w=f.proctoringLog)==null?void 0:w.length)??0;return e.jsxs("div",{className:"card",style:{boxShadow:"none",border:"1px solid #e2e8f0",transition:"box-shadow 0.2s, border-color 0.2s",cursor:"pointer"},onMouseEnter:N=>{N.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.1)",N.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:N=>{N.currentTarget.style.boxShadow="none",N.currentTarget.style.borderColor="#e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"0.75rem"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1.125rem"},children:((_=f.quiz)==null?void 0:_.title)||"Untitled Quiz"}),e.jsxs("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"6px",fontSize:"0.875rem",fontWeight:600,background:A>=70?"#dcfce7":A>=50?"#fef3c7":"#fee2e2",color:A>=70?"#166534":A>=50?"#854d0e":"#991b1b"},children:[A,"%"]})]}),(l||g)&&e.jsxs("p",{style:{color:"#64748b",margin:"0.5rem 0",fontSize:"0.9rem"},children:[e.jsx("strong",{children:"Student:"})," ",M]}),y&&e.jsxs("p",{style:{color:"#94a3b8",margin:"0.5rem 0",fontSize:"0.875rem"},children:["üìÖ ",new Date(y).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})," at ",new Date(y).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]}),S>0&&e.jsxs("p",{style:{color:"#ef4444",margin:"0.5rem 0",fontSize:"0.875rem",fontWeight:500},children:["‚ö†Ô∏è ",S," proctoring alert",S!==1?"s":""]}),e.jsx("button",{type:"button",className:"primary-btn",style:{marginTop:"1rem",width:"100%"},onClick:()=>t(`/results/${f._id}`),children:l||g?"Review Submission":"View Details"})]},f._id)}),i==="succeeded"&&c.length===0&&e.jsxs("div",{style:{textAlign:"center",padding:"3rem",color:"#94a3b8",gridColumn:"1 / -1"},children:[e.jsx("p",{style:{fontSize:"1.125rem",marginBottom:"0.5rem"},children:"No results yet."}),e.jsx("p",{style:{fontSize:"0.875rem"},children:l?"Student submissions will appear here once they complete quizzes.":g?"Learner submissions will appear here once your quizzes are attempted.":"Start taking quizzes to see your results here."})]})]})]})},Rt={low:"#22c55e",medium:"#f97316",high:"#ef4444"},Lr=()=>{var A,S,R;const{resultId:a}=wt(),t=pe(),{current:s,detailStatus:r}=J(w=>w.results),[i,n]=m.useState(!1);if(m.useEffect(()=>{a&&t(vt(a))},[t,a]),r==="loading"||!s)return e.jsx("section",{className:"card",children:e.jsxs("div",{style:{textAlign:"center",padding:"2rem"},children:[e.jsx("div",{style:{fontSize:"2rem",marginBottom:"1rem"},children:"‚è≥"}),e.jsx("p",{style:{color:"#64748b"},children:"Loading your results..."})]})});if(r==="failed")return e.jsx("section",{className:"card",children:e.jsxs("div",{style:{textAlign:"center",padding:"2rem"},children:[e.jsx("div",{style:{fontSize:"2rem",marginBottom:"1rem"},children:"‚ùå"}),e.jsx("p",{style:{color:"#ef4444"},children:"Failed to load results. Please try again."})]})});const l=((S=(A=s.quiz)==null?void 0:A.questions)==null?void 0:S.length)||0,g=Number.isFinite(s.totalScore)?s.totalScore:Number.isFinite(s.autoMaxScore)?s.autoMaxScore:l,d=Number.isFinite(s.pointsEarned)?s.pointsEarned:Number.isFinite(s.autoScore)?s.autoScore:0,c=(s.answers||[]).filter(w=>{var B,E;if(w.isCorrect!==void 0)return w.isCorrect;if(w.awardedScore!==void 0)return w.awardedScore>0;if(w.pointsAwarded!==void 0)return w.pointsAwarded>0;const _=(E=(B=s.quiz)==null?void 0:B.questions)==null?void 0:E.find($=>$._id===w.questionId),N=w.answer||w.selectedOption||w.textAnswer||"";return N&&N===(_==null?void 0:_.correctAnswer)}).length,f=Number.isFinite(s.score)?Math.round(s.score):g>0?Math.round(d/g*100):0,y=Math.round(d*100)/100,M=Math.round((g||0)*100)/100;return e.jsxs("section",{className:"card",children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"2rem",padding:"2rem",background:"#f8fafc",borderRadius:"12px"},children:[e.jsx("h1",{style:{marginBottom:"0.5rem"},children:(R=s.quiz)==null?void 0:R.title}),e.jsxs("div",{style:{fontSize:"3rem",fontWeight:"bold",color:f>=70?"#10b981":f>=50?"#f59e0b":"#ef4444",marginBottom:"0.5rem"},children:[f,"%"]}),e.jsxs("p",{style:{color:"#64748b",fontSize:"1.125rem"},children:["Score: ",y," / ",M," pts ¬∑ ",c," of ",l," questions correct"]})]}),e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginBottom:"1.5rem",fontSize:"1.5rem",fontWeight:"600"},children:"Your Answers"}),e.jsx("ul",{style:{listStyle:"none",padding:0},children:(s.answers||[]).map((w,_)=>{var E,$;const N=($=(E=s.quiz)==null?void 0:E.questions)==null?void 0:$.find(U=>U._id===w.questionId||U._id===w.question);let B=!1;if(w.isCorrect!==void 0)B=w.isCorrect;else if(w.awardedScore!==void 0&&w.awardedScore>0)B=!0;else if(w.pointsAwarded!==void 0&&w.pointsAwarded>0)B=!0;else{const U=w.answer||w.selectedOption||w.textAnswer||"";B=U&&U===(N==null?void 0:N.correctAnswer)}return e.jsx("li",{style:{marginBottom:"1.5rem",padding:"1.5rem",borderRadius:"12px",border:`2px solid ${B?"#d1fae5":"#fee2e2"}`,background:B?"#f0fdf4":"#fef2f2"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"1rem"},children:[e.jsx("div",{style:{minWidth:"32px",height:"32px",borderRadius:"50%",background:B?"#10b981":"#ef4444",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"0.875rem"},children:_+1}),e.jsxs("div",{style:{flex:1},children:[e.jsx("p",{style:{fontWeight:600,marginBottom:"1rem",fontSize:"1.125rem"},children:N==null?void 0:N.questionText}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.75rem"},children:[B?e.jsx(be,{size:20,color:"#10b981"}):e.jsx(It,{size:20,color:"#ef4444"}),e.jsx("span",{style:{fontWeight:"600",color:B?"#10b981":"#ef4444"},children:"Your Answer:"}),e.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"6px",background:B?"#d1fae5":"#fee2e2",color:B?"#065f46":"#991b1b",fontWeight:"500"},children:w.answer||w.selectedOption||w.textAnswer||"Not answered"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(be,{size:20,color:"#10b981"}),e.jsx("span",{style:{fontWeight:"600",color:"#10b981"},children:"Correct Answer:"}),e.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"6px",background:"#d1fae5",color:"#065f46",fontWeight:"500"},children:N==null?void 0:N.correctAnswer})]})]}),(N==null?void 0:N.questionType)==="multiple-choice"&&(N==null?void 0:N.options)&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"white",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",marginBottom:"0.5rem",fontWeight:"600"},children:"All Options:"}),e.jsx("ul",{style:{listStyle:"none",padding:0,display:"flex",flexDirection:"column",gap:"0.5rem"},children:N.options.map((U,O)=>e.jsx("li",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:U===N.correctAnswer?"#f0fdf4":"#f8fafc",border:`1px solid ${U===N.correctAnswer?"#10b981":"#e2e8f0"}`,fontSize:"0.875rem"},children:U},O))})]})]})]})},w.questionId)})})]}),e.jsxs("div",{style:{marginTop:"2rem",border:"1px solid #e2e8f0",borderRadius:"12px",overflow:"hidden"},children:[e.jsxs("button",{onClick:()=>n(!i),style:{width:"100%",padding:"1rem 1.5rem",background:"#f8fafc",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"1.125rem",fontWeight:"600",transition:"background 0.2s"},onMouseEnter:w=>w.currentTarget.style.background="#f1f5f9",onMouseLeave:w=>w.currentTarget.style.background="#f8fafc",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("span",{children:"üîí Proctoring Timeline"}),s.proctoringLog&&s.proctoringLog.length>0&&e.jsxs("span",{style:{padding:"0.25rem 0.75rem",background:"#fee2e2",color:"#991b1b",borderRadius:"9999px",fontSize:"0.875rem",fontWeight:"600"},children:[s.proctoringLog.length," ",s.proctoringLog.length===1?"event":"events"]})]}),i?e.jsx(kt,{size:24}):e.jsx(nt,{size:24})]}),i&&e.jsx("div",{style:{padding:"1.5rem",background:"white"},children:s.proctoringLog&&s.proctoringLog.length>0?e.jsx("ul",{style:{listStyle:"none",padding:0},children:s.proctoringLog.map(w=>e.jsxs("li",{style:{marginBottom:"1rem",padding:"1rem",borderRadius:"12px",border:"1px solid #e2e8f0",background:"#fafafa"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("strong",{style:{fontSize:"1rem"},children:w.eventType}),e.jsx("span",{style:{color:Rt[w.severity],fontWeight:"600",fontSize:"0.875rem",padding:"0.25rem 0.5rem",background:`${Rt[w.severity]}20`,borderRadius:"6px"},children:w.severity.toUpperCase()})]}),e.jsx("small",{style:{color:"#94a3b8",display:"block",marginBottom:"0.5rem"},children:new Date(w.timestamp).toLocaleString()}),w.eventData&&Object.keys(w.eventData).length>0&&e.jsx("pre",{style:{background:"#f1f5f9",padding:"0.75rem",borderRadius:"8px",marginTop:"0.5rem",overflowX:"auto",fontSize:"0.875rem"},children:JSON.stringify(w.eventData,null,2)})]},w._id))}):e.jsxs("div",{style:{textAlign:"center",padding:"2rem"},children:[e.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"üéâ"}),e.jsx("p",{style:{color:"#10b981",fontWeight:"600",fontSize:"1.125rem"},children:"No proctoring events recorded"}),e.jsx("p",{style:{color:"#64748b",fontSize:"0.875rem",marginTop:"0.5rem"},children:"You completed this quiz without any issues!"})]})})]})]})},it="javascript",Mr=["javascript","typescript","python","java","csharp","cpp"],Ne=["True","False"],Gt=()=>({questionText:"",questionType:"multiple-choice",options:["",""],correctAnswer:"",codeLanguage:it,starterCode:"",evaluationNotes:"",referenceSolution:"",maxScore:1,blankAnswers:[""],caseSensitive:!1,matchingPairs:[{left:"",right:""}],wordLimit:"",rubric:"",sampleAnswer:"",allowedFileTypes:["pdf"],maxFileSize:5,partialCredit:!0}),ht=a=>a?{title:a.title||"",description:a.description||"",isPublished:a.isPublished!==void 0?a.isPublished:!0,timeLimit:a.timeLimit||null,expiryDate:a.expiryDate||null,maxAttempts:a.maxAttempts||null,questions:(a.questions||[]).map(t=>{const s=t.questionType||"multiple-choice",r=Number.isFinite(t.maxScore)&&t.maxScore>0?t.maxScore:1,i={questionText:t.questionText||"",questionType:s,maxScore:r,options:Array.isArray(t.options)?t.options.map(n=>`${n}`):[],correctAnswer:t.correctAnswer||"",codeLanguage:t.codeLanguage||it,starterCode:t.starterCode||"",evaluationNotes:t.evaluationNotes||"",referenceSolution:t.referenceSolution||"",blankAnswers:Array.isArray(t.blankAnswers)&&t.blankAnswers.length?t.blankAnswers.map(n=>`${n}`):[""],caseSensitive:!!t.caseSensitive,matchingPairs:Array.isArray(t.matchingPairs)&&t.matchingPairs.length?t.matchingPairs.map(n=>({left:(n==null?void 0:n.left)||"",right:(n==null?void 0:n.right)||""})):[{left:"",right:""}],wordLimit:t.wordLimit!==null&&t.wordLimit!==void 0?`${t.wordLimit}`:"",rubric:t.rubric||"",sampleAnswer:t.sampleAnswer||"",allowedFileTypes:Array.isArray(t.allowedFileTypes)&&t.allowedFileTypes.length?t.allowedFileTypes:["pdf"],maxFileSize:Number.isFinite(t.maxFileSize)&&t.maxFileSize>0?t.maxFileSize:5,partialCredit:t.partialCredit!==void 0?!!t.partialCredit:s==="matching"};switch(s){case"code":return{...i,questionType:"code",options:[],partialCredit:!1};case"true-false":return{...i,questionType:"true-false",options:Ne,correctAnswer:Ne.includes(i.correctAnswer)?i.correctAnswer:"True",partialCredit:!1};case"fill-in-blank":return{...i,questionType:"fill-in-blank",options:[],correctAnswer:"",partialCredit:!!i.partialCredit};case"matching":return{...i,questionType:"matching",options:[],correctAnswer:"",partialCredit:i.partialCredit!==void 0?i.partialCredit:!0};case"essay":return{...i,questionType:"essay",options:[],correctAnswer:"",partialCredit:!1};case"file-upload":return{...i,questionType:"file-upload",options:[],correctAnswer:"",partialCredit:!1};case"multiple-choice":default:{const n=i.options&&i.options.length>=2?i.options:["",""],l=n.includes(i.correctAnswer)?i.correctAnswer:n[0];return{...i,questionType:"multiple-choice",options:n,correctAnswer:l||"",partialCredit:!1}}}})}:{title:"",description:"",isPublished:!0,timeLimit:null,expiryDate:null,maxAttempts:null,questions:[Gt()]},Pr=({initialQuiz:a,onSubmit:t,onCancel:s,submitLabel:r="Save quiz",isSubmitting:i=!1,errorMessage:n="",successMessage:l="",className:g="card",resetSignal:d=0})=>{const[c,f]=m.useState(()=>ht(a)),y=m.useRef(d);m.useEffect(()=>{f(ht(a))},[a]),m.useEffect(()=>{d!==y.current&&(f(ht(a)),y.current=d)},[a,d]);const M=c.questions.length,A=m.useMemo(()=>!c.title.trim()||c.questions.length===0?!1:c.questions.every(h=>{if(!h.questionText.trim())return!1;const o=Number(h.maxScore);if(!Number.isFinite(o)||o<=0)return!1;switch(h.questionType){case"code":return!0;case"multiple-choice":return Array.isArray(h.options)&&h.options.length>=2&&h.options.every(x=>x.trim())&&h.options.includes(h.correctAnswer);case"true-false":return Ne.includes(h.correctAnswer);case"fill-in-blank":return(Array.isArray(h.blankAnswers)?h.blankAnswers.map(u=>u.trim()).filter(Boolean):[]).length>0;case"matching":return(Array.isArray(h.matchingPairs)?h.matchingPairs.filter(u=>u&&u.left&&u.right&&u.left.trim()&&u.right.trim()):[]).length>0;case"essay":{if(!h.wordLimit)return!0;const x=Number(h.wordLimit);return!Number.isNaN(x)&&x>0}case"file-upload":return(Array.isArray(h.allowedFileTypes)?h.allowedFileTypes.filter(u=>u&&u.trim()):[]).length>0&&Number(h.maxFileSize)>0;default:return!1}}),[c]),S=(h,o)=>{f(x=>{const u=[...x.questions],b={...u[h]},D=o(b);return u[h]=D,{...x,questions:u}})},R=(h,o,x)=>{S(h,u=>{if(o==="questionType")switch(x){case"code":return{...u,questionType:"code",options:[],correctAnswer:u.correctAnswer||"",codeLanguage:u.codeLanguage||it,starterCode:u.starterCode||"",evaluationNotes:u.evaluationNotes||"",referenceSolution:u.referenceSolution||"",partialCredit:!1};case"true-false":return{...u,questionType:"true-false",options:Ne,correctAnswer:Ne.includes(u.correctAnswer)?u.correctAnswer:"True",partialCredit:!1};case"fill-in-blank":return{...u,questionType:"fill-in-blank",options:[],correctAnswer:"",blankAnswers:u.blankAnswers&&u.blankAnswers.length?u.blankAnswers:[""],caseSensitive:!!u.caseSensitive,partialCredit:!!u.partialCredit};case"matching":return{...u,questionType:"matching",options:[],correctAnswer:"",matchingPairs:u.matchingPairs&&u.matchingPairs.length?u.matchingPairs:[{left:"",right:""}],partialCredit:u.partialCredit!==void 0?u.partialCredit:!0};case"essay":return{...u,questionType:"essay",options:[],correctAnswer:"",wordLimit:u.wordLimit||"",rubric:u.rubric||"",sampleAnswer:u.sampleAnswer||"",partialCredit:!1};case"file-upload":return{...u,questionType:"file-upload",options:[],correctAnswer:"",allowedFileTypes:u.allowedFileTypes&&u.allowedFileTypes.length?u.allowedFileTypes:["pdf"],maxFileSize:Number.isFinite(Number(u.maxFileSize))&&Number(u.maxFileSize)>0?Number(u.maxFileSize):5,partialCredit:!1};case"multiple-choice":default:{const b=u.options&&u.options.length>=2?u.options:["",""];return{...u,questionType:"multiple-choice",options:b,correctAnswer:b[0]||"",codeLanguage:it,starterCode:"",evaluationNotes:"",referenceSolution:"",partialCredit:!1}}}if(o==="maxScore"){const b=Number.parseFloat(x);return{...u,maxScore:Number.isFinite(b)&&b>0?b:1}}return o==="partialCredit"||o==="caseSensitive"?{...u,[o]:!!x}:{...u,[o]:x}})},w=(h,o,x)=>{S(h,u=>{const b=[...u.options];return b[o]=x,{...u,options:b}})},_=h=>{S(h,o=>({...o,options:[...o.options,""]}))},N=(h,o)=>{S(h,x=>{if(x.questionType!=="multiple-choice")return x;const u=x.options.filter((D,I)=>I!==o);if(u.length<2)return x;const b=u.includes(x.correctAnswer)?x.correctAnswer:u[0];return{...x,options:u,correctAnswer:b||""}})},B=(h,o,x)=>{S(h,u=>{const b=Array.isArray(u.blankAnswers)?[...u.blankAnswers]:[];return b[o]=x,{...u,blankAnswers:b}})},E=h=>{S(h,o=>({...o,blankAnswers:[...o.blankAnswers||[],""]}))},$=(h,o)=>{S(h,x=>{const u=Array.isArray(x.blankAnswers)?x.blankAnswers.filter((b,D)=>D!==o):[];return{...x,blankAnswers:u.length>0?u:[""]}})},U=(h,o,x,u)=>{S(h,b=>{const D=Array.isArray(b.matchingPairs)?b.matchingPairs.map(I=>({...I})):[];return D[o]={...D[o],[x]:u},{...b,matchingPairs:D}})},O=h=>{S(h,o=>({...o,matchingPairs:[...o.matchingPairs||[],{left:"",right:""}]}))},j=(h,o)=>{S(h,x=>{const u=Array.isArray(x.matchingPairs)?x.matchingPairs.filter((b,D)=>D!==o):[];return{...x,matchingPairs:u.length>0?u:[{left:"",right:""}]}})},K=()=>{f(h=>({...h,questions:[...h.questions,Gt()]}))},p=h=>{f(o=>o.questions.length===1?o:{...o,questions:o.questions.filter((x,u)=>u!==h)})},C=h=>{if(h.preventDefault(),!A||i)return;const o={title:c.title.trim(),description:c.description.trim(),isPublished:c.isPublished,timeLimit:c.timeLimit,expiryDate:c.expiryDate,maxAttempts:c.maxAttempts,questions:c.questions.map(x=>{var b,D;const u={questionText:x.questionText.trim(),questionType:x.questionType,maxScore:Number(x.maxScore)>0?Number(x.maxScore):1};switch(x.questionType){case"multiple-choice":{const I=(x.options||[]).map(Z=>Z.trim());u.options=I,u.correctAnswer=x.correctAnswer;break}case"true-false":{u.options=[...Ne],u.correctAnswer=Ne.includes(x.correctAnswer)?x.correctAnswer:Ne[0];break}case"code":{u.codeLanguage=x.codeLanguage,u.starterCode=x.starterCode||void 0,u.referenceSolution=x.referenceSolution||void 0,u.evaluationNotes=x.evaluationNotes||void 0;break}case"fill-in-blank":{u.blankAnswers=(x.blankAnswers||[]).map(I=>I.trim()).filter(Boolean),u.caseSensitive=!!x.caseSensitive,u.partialCredit=!!x.partialCredit;break}case"matching":{u.matchingPairs=(x.matchingPairs||[]).map(I=>{var Z,Y;return{left:((Z=I==null?void 0:I.left)==null?void 0:Z.trim())||"",right:((Y=I==null?void 0:I.right)==null?void 0:Y.trim())||""}}).filter(I=>I.left&&I.right),u.partialCredit=!!x.partialCredit;break}case"essay":{const I=Number(x.wordLimit);u.wordLimit=Number.isFinite(I)&&I>0?I:void 0,u.rubric=((b=x.rubric)==null?void 0:b.trim())||void 0,u.sampleAnswer=((D=x.sampleAnswer)==null?void 0:D.trim())||void 0;break}case"file-upload":{u.allowedFileTypes=(x.allowedFileTypes||[]).map(Z=>Z.trim()).filter(Boolean);const I=Number(x.maxFileSize);u.maxFileSize=Number.isFinite(I)&&I>0?I:void 0;break}default:u.correctAnswer=x.correctAnswer}return Object.fromEntries(Object.entries(u).filter(([,I])=>I!==void 0))})};t==null||t(o)};return e.jsxs("form",{onSubmit:C,className:"quiz-form-container",children:[e.jsx("label",{htmlFor:"quiz-title",children:"Quiz Title"}),e.jsx("input",{id:"quiz-title",value:c.title,onChange:h=>f(o=>({...o,title:h.target.value})),placeholder:"e.g., JavaScript Fundamentals Quiz",required:!0}),e.jsx("label",{htmlFor:"quiz-description",children:"Description"}),e.jsx("textarea",{id:"quiz-description",rows:3,value:c.description,onChange:h=>f(o=>({...o,description:h.target.value})),placeholder:"Provide a brief overview of what this quiz covers..."}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"quiz-time-limit",children:"Time Limit (minutes)"}),e.jsx("input",{id:"quiz-time-limit",type:"number",min:"1",value:c.timeLimit||"",onChange:h=>f(o=>({...o,timeLimit:h.target.value?parseInt(h.target.value):null})),placeholder:"Optional (e.g., 30)"}),e.jsx("small",{style:{color:"#6b7280",fontSize:"0.85rem"},children:"Leave empty for no time limit"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"quiz-expiry-date",children:"Expiry Date"}),e.jsx("input",{id:"quiz-expiry-date",type:"datetime-local",value:c.expiryDate?new Date(c.expiryDate).toISOString().slice(0,16):"",onChange:h=>f(o=>({...o,expiryDate:h.target.value?new Date(h.target.value).toISOString():null}))}),e.jsx("small",{style:{color:"#6b7280",fontSize:"0.85rem"},children:"Leave empty for no expiry"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"quiz-max-attempts",children:"Max Attempts"}),e.jsx("input",{id:"quiz-max-attempts",type:"number",min:"1",value:c.maxAttempts||"",onChange:h=>f(o=>({...o,maxAttempts:h.target.value?parseInt(h.target.value):null})),placeholder:"Optional (e.g., 3)"}),e.jsx("small",{style:{color:"#6b7280",fontSize:"0.85rem"},children:"Leave empty for unlimited attempts"})]})]}),c.questions.map((h,o)=>{var x,u;return e.jsxs("div",{className:"question-card",children:[e.jsxs("div",{className:"question-header",children:[e.jsx("h3",{children:e.jsxs("span",{className:"question-number-badge",children:["Question ",o+1]})}),M>1&&e.jsxs("button",{type:"button",className:"remove-question-btn",onClick:()=>p(o),children:[e.jsx(Bt,{size:16,style:{display:"inline-block",verticalAlign:"middle",marginRight:"0.25rem"}}),"Remove"]})]}),e.jsx("label",{htmlFor:`question-type-${o}`,children:"Question type"}),e.jsxs("select",{id:`question-type-${o}`,value:h.questionType,onChange:b=>R(o,"questionType",b.target.value),children:[e.jsx("option",{value:"multiple-choice",children:"Multiple choice"}),e.jsx("option",{value:"true-false",children:"True / False"}),e.jsx("option",{value:"code",children:"Code response"}),e.jsx("option",{value:"fill-in-blank",children:"Fill in the blank"}),e.jsx("option",{value:"matching",children:"Matching pairs"}),e.jsx("option",{value:"essay",children:"Essay response"}),e.jsx("option",{value:"file-upload",children:"File upload"})]}),e.jsx("label",{htmlFor:`question-text-${o}`,children:"Prompt"}),e.jsx("input",{id:`question-text-${o}`,value:h.questionText,onChange:b=>R(o,"questionText",b.target.value),required:!0}),e.jsxs("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{flex:"1 1 160px"},children:[e.jsx("label",{htmlFor:`max-score-${o}`,children:"Points available"}),e.jsx("input",{id:`max-score-${o}`,type:"number",min:"0.5",step:"0.5",value:h.maxScore,onChange:b=>R(o,"maxScore",b.target.value),required:!0})]}),h.questionType==="code"&&e.jsxs("div",{style:{flex:"1 1 200px"},children:[e.jsx("label",{htmlFor:`language-${o}`,children:"Preferred language"}),e.jsx("select",{id:`language-${o}`,value:h.codeLanguage,onChange:b=>R(o,"codeLanguage",b.target.value),children:Mr.map(b=>e.jsx("option",{value:b,children:b},b))})]})]}),h.questionType==="multiple-choice"&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"Options"}),h.options.map((b,D)=>e.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[e.jsx("input",{value:b,onChange:I=>w(o,D,I.target.value),required:!0,placeholder:`Option ${D+1}`}),h.options.length>2&&e.jsx("button",{type:"button",className:"primary-btn danger",onClick:()=>N(o,D),style:{padding:"0.35rem 0.75rem"},children:"Remove"})]},`question-${o}-option-${D}`)),e.jsxs("div",{style:{marginTop:"0.75rem",display:"flex",gap:"0.75rem",flexWrap:"wrap",alignItems:"center"},children:[e.jsx("button",{type:"button",className:"primary-btn",onClick:()=>_(o),children:"Add option"}),e.jsxs("label",{htmlFor:`correct-answer-${o}`,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:["Correct answer",e.jsxs("select",{id:`correct-answer-${o}`,value:h.correctAnswer,onChange:b=>R(o,"correctAnswer",b.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select the correct option"}),h.options.map((b,D)=>e.jsx("option",{value:b,children:b||`Option ${D+1}`},`correct-${o}-${D}`))]})]})]})]}),h.questionType==="true-false"&&e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("h4",{children:"Correct answer"}),e.jsx("div",{style:{display:"flex",gap:"1.5rem"},children:Ne.map(b=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"radio",name:`true-false-${o}`,value:b,checked:h.correctAnswer===b,onChange:D=>R(o,"correctAnswer",D.target.value)}),b]},`${b}-${o}`))})]}),h.questionType==="code"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:`starter-code-${o}`,children:"Starter code (optional)"}),e.jsx("textarea",{id:`starter-code-${o}`,rows:6,value:h.starterCode,onChange:b=>R(o,"starterCode",b.target.value),style:{fontFamily:'"Fira Code", "Source Code Pro", monospace'},placeholder:`// Provide starter code or function signature
function solve() {
  // ...
}`}),e.jsx("label",{htmlFor:`reference-solution-${o}`,children:"Reference solution (optional)"}),e.jsx("textarea",{id:`reference-solution-${o}`,rows:6,value:h.referenceSolution,onChange:b=>R(o,"referenceSolution",b.target.value),style:{fontFamily:'"Fira Code", "Source Code Pro", monospace'},placeholder:"Keep for graders only. This will not be shown to students."}),e.jsx("label",{htmlFor:`evaluation-notes-${o}`,children:"Evaluation notes for graders (optional)"}),e.jsx("textarea",{id:`evaluation-notes-${o}`,rows:3,value:h.evaluationNotes,onChange:b=>R(o,"evaluationNotes",b.target.value),placeholder:"Highlight what a strong answer should include."})]}),h.questionType==="fill-in-blank"&&e.jsxs("div",{className:"question-subsection",style:{marginTop:"1rem",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[e.jsx("h4",{children:"Acceptable answers"}),(x=h.blankAnswers)==null?void 0:x.map((b,D)=>e.jsxs("div",{style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[e.jsx("input",{value:b,onChange:I=>B(o,D,I.target.value),placeholder:"Accepted answer",required:!0}),Array.isArray(h.blankAnswers)&&h.blankAnswers.length>1&&e.jsx("button",{type:"button",className:"primary-btn danger",onClick:()=>$(o,D),style:{padding:"0.35rem 0.75rem"},children:"Remove"})]},`blank-${o}-${D}`)),e.jsx("button",{type:"button",className:"primary-btn",onClick:()=>E(o),children:"Add acceptable answer"}),e.jsxs("div",{style:{display:"flex",gap:"1.5rem",flexWrap:"wrap"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",checked:!!h.caseSensitive,onChange:b=>R(o,"caseSensitive",b.target.checked)}),"Case sensitive"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",checked:!!h.partialCredit,onChange:b=>R(o,"partialCredit",b.target.checked)}),"Allow partial credit"]})]})]}),h.questionType==="matching"&&e.jsxs("div",{className:"question-subsection",style:{marginTop:"1rem",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[e.jsx("h4",{children:"Matching pairs"}),(u=h.matchingPairs)==null?void 0:u.map((b,D)=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"0.75rem",alignItems:"center"},children:[e.jsx("input",{value:(b==null?void 0:b.left)||"",onChange:I=>U(o,D,"left",I.target.value),placeholder:"Prompt",required:!0}),e.jsx("input",{value:(b==null?void 0:b.right)||"",onChange:I=>U(o,D,"right",I.target.value),placeholder:"Correct match",required:!0}),Array.isArray(h.matchingPairs)&&h.matchingPairs.length>1&&e.jsx("button",{type:"button",className:"primary-btn danger",onClick:()=>j(o,D),style:{padding:"0.35rem 0.75rem"},children:"Remove"})]},`matching-${o}-${D}`)),e.jsx("button",{type:"button",className:"primary-btn",onClick:()=>O(o),children:"Add pair"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",checked:!!h.partialCredit,onChange:b=>R(o,"partialCredit",b.target.checked)}),"Allow partial credit for partially correct matches"]})]}),h.questionType==="essay"&&e.jsxs("div",{className:"question-subsection",style:{marginTop:"1rem",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`word-limit-${o}`,children:"Word limit (optional)"}),e.jsx("input",{id:`word-limit-${o}`,type:"number",min:"1",value:h.wordLimit||"",onChange:b=>R(o,"wordLimit",b.target.value),placeholder:"e.g., 250"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`rubric-${o}`,children:"Rubric criteria (optional)"}),e.jsx("input",{id:`rubric-${o}`,value:h.rubric||"",onChange:b=>R(o,"rubric",b.target.value),placeholder:"e.g., Thesis|Evidence|Clarity"}),e.jsx("small",{style:{color:"#6b7280"},children:"Separate criteria with the | character"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`sample-answer-${o}`,children:"Sample answer (optional)"}),e.jsx("textarea",{id:`sample-answer-${o}`,rows:4,value:h.sampleAnswer||"",onChange:b=>R(o,"sampleAnswer",b.target.value),placeholder:"Provide a model answer or grading notes..."})]})]}),h.questionType==="file-upload"&&e.jsxs("div",{className:"question-subsection",style:{marginTop:"1rem",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:`file-types-${o}`,children:"Allowed file types"}),e.jsx("input",{id:`file-types-${o}`,value:(h.allowedFileTypes||[]).join(", "),onChange:b=>{const D=b.target.value.split(",").map(I=>I.trim()).filter(Boolean);R(o,"allowedFileTypes",D.length?D:["pdf"])},placeholder:"e.g., pdf, docx, zip"}),e.jsx("small",{style:{color:"#6b7280"},children:"Separate file extensions with commas"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`max-file-size-${o}`,children:"Max file size (MB)"}),e.jsx("input",{id:`max-file-size-${o}`,type:"number",min:"1",value:h.maxFileSize||"",onChange:b=>{const D=Number.parseFloat(b.target.value);S(o,I=>({...I,maxFileSize:Number.isFinite(D)&&D>0?D:""}))},placeholder:"e.g., 10"})]})]})]},`question-${o}`)}),e.jsxs("button",{type:"button",className:"add-question-btn",onClick:K,children:[e.jsx(He,{size:20}),"Add Another Question"]}),n&&e.jsx("div",{className:"message error",children:n}),l&&e.jsx("div",{className:"message success",children:l}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"submit-btn",disabled:!A||i,children:i?"Saving‚Ä¶":r}),s&&e.jsx("button",{type:"button",className:"cancel-btn",onClick:s,children:"Cancel"})]})]})},Dt=()=>{const{quizId:a}=wt(),[t]=ss(),s=t.get("edit"),r=a||s,i=!!r,n=pe(),l=je(),{user:g}=J(U=>U.auth),{current:d,status:c,error:f}=J(U=>U.quizzes),[y,M]=m.useState(""),[A,S]=m.useState(""),[R,w]=m.useState(!1),[_,N]=m.useState(0),B=(g==null?void 0:g.role)==="admin"||(g==null?void 0:g.role)==="instructor";if(m.useEffect(()=>{B&&r&&n($e(r))},[n,r,B]),!B)return e.jsx(jt,{to:"/dashboard",replace:!0});const E=async U=>{w(!0),M(""),S("");try{return i?(await n(xt({quizId:r,payload:U})).unwrap(),await n(De()),S("Quiz updated successfully!")):(await n(_t(U)).unwrap(),await n(De()),S("Quiz created successfully!"),N(O=>O+1)),!0}catch(O){return M((O==null?void 0:O.message)||`Failed to ${i?"update":"create"} quiz`),!1}finally{w(!1)}},$=()=>{l("/dashboard")};if(i){if(c==="loading"&&(!d||d._id!==r))return e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:e.jsx("p",{children:"Loading quiz‚Ä¶"})});if(c==="failed"&&(!d||d._id!==r))return e.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#ef4444"},children:e.jsx("p",{children:f||"Unable to load quiz."})});if(!d||d._id!==r)return e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:e.jsx("p",{children:"Loading quiz‚Ä¶"})})}return e.jsxs("section",{style:{padding:"2rem",maxWidth:"1200px",margin:"0 auto"},children:[e.jsxs("div",{className:"card",style:{marginBottom:"1.5rem",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none"},children:[e.jsxs("button",{type:"button",className:"primary-btn outline",onClick:()=>l("/dashboard"),style:{marginBottom:"1rem",width:"fit-content",background:"rgba(255,255,255,0.2)",color:"white",border:"1px solid rgba(255,255,255,0.3)",backdropFilter:"blur(10px)"},children:[e.jsx(ot,{size:16,style:{marginRight:"0.5rem"}}),"Back to Dashboard"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"0.5rem"},children:[e.jsx(fe,{size:32}),e.jsx("h1",{style:{margin:0,fontSize:"2rem"},children:i?"Edit Quiz":"Create New Quiz"})]}),e.jsx("p",{style:{margin:0,opacity:.9},children:i?"Update the quiz content or correct answer set. Changes apply immediately for students.":"Design your quiz with multiple-choice or coding questions. Add as many questions as you need."})]}),e.jsx(Pr,{initialQuiz:i?d:null,onSubmit:E,onCancel:$,submitLabel:i?"Save Changes":"Publish Quiz",isSubmitting:R,errorMessage:y,successMessage:A,resetSignal:_})]})},Ir=Js,Yt=ve.forwardRef(({className:a,...t},s)=>e.jsx(Qs,{ref:s,className:ae("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...t}));Yt.displayName="TabsList";const Jt=ve.forwardRef(({className:a,...t},s)=>e.jsx(Gs,{ref:s,className:ae("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5","text-sm font-medium ring-offset-background transition-all","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50","data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...t}));Jt.displayName="TabsTrigger";const Kt=ve.forwardRef(({className:a,...t},s)=>e.jsx(Ys,{ref:s,className:ae("mt-2 ring-offset-background","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2",a),...t}));Kt.displayName="TabsContent";const Br=()=>{const[a,t]=m.useState({}),s=l=>{t(g=>({...g,[l]:!g[l]}))},r=[{id:"face-detection",icon:e.jsx(qe,{}),title:"Real-time Face Detection",shortDesc:"AI-powered face tracking throughout the exam",detailedDesc:["Continuous face detection using Face-API.js with TinyFaceDetector","Face landmark detection with 68-point facial feature mapping","Real-time face recognition to ensure identity consistency","Alerts when no face or multiple faces are detected","Automatic violation recording with timestamp"],tech:["Face-API.js","TensorFlow.js","WebRTC"],color:"blue"},{id:"liveness",icon:e.jsx(st,{}),title:"Liveness Detection",shortDesc:"Prevent photo/video spoofing attacks",detailedDesc:["Random challenge-based liveness checks","Blink detection to verify real person","Head movement validation","Texture analysis to detect printed photos","Depth perception using facial landmarks"],tech:["Face-API.js","Machine Learning","Computer Vision"],color:"purple"},{id:"gaze-tracking",icon:e.jsx(bs,{}),title:"Gaze & Head Pose Detection",shortDesc:"Monitor where the student is looking",detailedDesc:["Eye gaze direction tracking","Head rotation detection (yaw, pitch, roll)","Threshold-based violation detection (35¬∞ rotation)","3-second cooldown to prevent false positives","Visual warnings before violation logging"],tech:["Face Landmarks","Euler Angles","Vector Mathematics"],color:"cyan"},{id:"audio-monitoring",icon:e.jsx(vs,{}),title:"Audio Monitoring",shortDesc:"Detect suspicious sounds and voices",detailedDesc:["Real-time audio capture with Web Audio API","10x gain boost for sensitive detection","Voice activity detection (VAD)","Multiple speaker detection","Background noise analysis and filtering","Suspicious pattern recognition"],tech:["Web Audio API","FFT Analysis","Voice Detection"],color:"green"},{id:"tab-switching",icon:e.jsx(ze,{}),title:"Tab Switch Detection",shortDesc:"Monitor browser focus and window changes",detailedDesc:["Visibility API to detect tab switches","Window focus/blur event monitoring","Automatic quiz pause on suspicious activity","Violation counter with detailed logs","Warning system before penalties"],tech:["Visibility API","Focus Events","WebSockets"],color:"orange"},{id:"ai-behavior",icon:e.jsx(et,{}),title:"AI Behavior Analysis",shortDesc:"Machine learning-based anomaly detection",detailedDesc:["Pattern recognition for suspicious behavior","Answer timing analysis","Keystroke dynamics monitoring","Mouse movement pattern analysis","Statistical anomaly detection","Risk scoring algorithm"],tech:["TensorFlow.js","Statistical Analysis","ML Algorithms"],color:"pink"}],i=[{category:"Frontend",icon:e.jsx(St,{}),color:"blue",technologies:[{name:"React 18",purpose:"UI Framework",description:"Modern component-based UI with hooks and context",features:["Virtual DOM","State Management","Component Reusability"]},{name:"Vite",purpose:"Build Tool",description:"Lightning-fast development and optimized production builds",features:["Hot Module Replacement","Fast Refresh","Tree Shaking"]},{name:"Tailwind CSS",purpose:"Styling",description:"Utility-first CSS framework for rapid UI development",features:["Responsive Design","Custom Themes","JIT Compiler"]},{name:"Face-API.js",purpose:"AI/ML",description:"JavaScript face detection and recognition library",features:["Face Detection","Landmarks","Face Recognition","Expression Detection"]}]},{category:"Backend",icon:e.jsx(js,{}),color:"green",technologies:[{name:"Node.js",purpose:"Runtime",description:"JavaScript runtime for scalable server applications",features:["Event-driven","Non-blocking I/O","NPM Ecosystem"]},{name:"Express.js",purpose:"Web Framework",description:"Fast, minimalist web framework for APIs",features:["Routing","Middleware","RESTful APIs"]},{name:"Socket.io",purpose:"Real-time Communication",description:"WebSocket library for bidirectional event-based communication",features:["Real-time Proctoring","Live Monitoring","Event Broadcasting"]},{name:"Passport.js",purpose:"Authentication",description:"Authentication middleware with multiple strategies",features:["JWT","OAuth","Local Strategy","2FA Support"]}]},{category:"Database",icon:e.jsx(We,{}),color:"purple",technologies:[{name:"MongoDB",purpose:"NoSQL Database",description:"Document-based database for flexible data storage",features:["Schema Flexibility","Scalability","JSON-like Documents"]},{name:"Mongoose",purpose:"ODM",description:"Elegant MongoDB object modeling for Node.js",features:["Schema Validation","Middleware","Query Building"]}]},{category:"DevOps",icon:e.jsx(ws,{}),color:"orange",technologies:[{name:"Docker",purpose:"Containerization",description:"Container platform for consistent deployment",features:["Isolated Environments","Easy Deployment","Scalability"]},{name:"Docker Compose",purpose:"Orchestration",description:"Multi-container application management",features:["Service Definition","Network Management","Volume Mapping"]},{name:"Nginx",purpose:"Web Server",description:"High-performance reverse proxy and static file server",features:["Load Balancing","Caching","SSL/TLS"]}]},{category:"Security",icon:e.jsx(tt,{}),color:"red",technologies:[{name:"JWT",purpose:"Token-based Auth",description:"JSON Web Tokens for secure authentication",features:["Stateless","Cross-domain","Compact"]},{name:"2FA (TOTP)",purpose:"Two-Factor Authentication",description:"Time-based one-time passwords for enhanced security",features:["Speakeasy","QR Codes","Backup Codes"]},{name:"bcrypt",purpose:"Password Hashing",description:"Secure password hashing algorithm",features:["Salting","Adaptive Hashing","Brute-force Resistant"]}]}],n=[{step:"1",title:"User Authentication",description:"JWT + 2FA with role-based access control",icon:e.jsx(tt,{})},{step:"2",title:"Quiz Initialization",description:"Load quiz, start proctoring systems",icon:e.jsx(Re,{})},{step:"3",title:"Real-time Monitoring",description:"WebSocket connection for live proctoring",icon:e.jsx(Ss,{})},{step:"4",title:"AI Analysis",description:"Face detection, behavior analysis, audio monitoring",icon:e.jsx(et,{})},{step:"5",title:"Violation Detection",description:"Log violations, send alerts, update dashboard",icon:e.jsx(ze,{})},{step:"6",title:"Result Generation",description:"Calculate scores, generate reports with violation logs",icon:e.jsx(Me,{})}];return e.jsxs("div",{className:"about-page",children:[e.jsxs("section",{className:"about-hero",children:[e.jsx("div",{className:"hero-gradient"}),e.jsx("div",{className:"container",children:e.jsxs("div",{className:"hero-content",children:[e.jsxs("div",{className:"hero-badge",children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{children:"Pentacore Solutions"})]}),e.jsxs("h1",{className:"hero-title",children:["Smart Quiz Platform with",e.jsx("span",{className:"gradient-text",children:" Advanced Anti-Cheat"})]}),e.jsx("p",{className:"hero-subtitle",children:"A comprehensive assessment platform powered by AI, machine learning, and cutting-edge web technologies"})]})})]}),e.jsxs("div",{className:"container about-content",children:[e.jsxs("section",{className:"section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{className:"section-title",children:"Anti-Cheat Features"}),e.jsx("p",{className:"section-subtitle",children:"Multi-layered security system powered by AI and real-time monitoring"})]}),e.jsx("div",{className:"features-list",children:r.map(l=>e.jsxs(V,{className:`feature-detail-card feature-detail-card--${l.color}`,children:[e.jsxs("div",{className:"feature-header",onClick:()=>s(l.id),children:[e.jsxs("div",{className:"feature-header-left",children:[e.jsx("div",{className:`feature-icon feature-icon--${l.color}`,children:l.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"feature-title",children:l.title}),e.jsx("p",{className:"feature-short-desc",children:l.shortDesc})]})]}),e.jsx("button",{className:"expand-button",children:a[l.id]?e.jsx(kt,{}):e.jsx(nt,{})})]}),a[l.id]&&e.jsxs("div",{className:"feature-details",children:[e.jsxs("div",{className:"feature-capabilities",children:[e.jsx("h4",{children:"Capabilities:"}),e.jsx("ul",{children:l.detailedDesc.map((g,d)=>e.jsxs("li",{children:[e.jsx(be,{className:"check-icon"}),e.jsx("span",{children:g})]},d))})]}),e.jsxs("div",{className:"feature-tech-tags",children:[e.jsx("strong",{children:"Technologies:"}),l.tech.map((g,d)=>e.jsx("span",{className:"tech-tag",children:g},d))]})]})]},l.id))})]}),e.jsxs("section",{className:"section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{className:"section-title",children:"Technology Stack"}),e.jsx("p",{className:"section-subtitle",children:"Built with modern, reliable, and scalable technologies"})]}),e.jsxs(Ir,{defaultValue:"Frontend",className:"tech-tabs",children:[e.jsx(Yt,{className:"tech-tabs-list",children:i.map(l=>e.jsxs(Jt,{value:l.category,children:[l.icon,e.jsx("span",{children:l.category})]},l.category))}),i.map(l=>e.jsx(Kt,{value:l.category,children:e.jsx("div",{className:"tech-stack-section",children:l.technologies.map((g,d)=>e.jsxs(V,{className:"tech-detail-card",children:[e.jsxs("div",{className:"tech-header",children:[e.jsx("h3",{className:"tech-name",children:g.name}),e.jsx("span",{className:`tech-badge tech-badge--${l.color}`,children:g.purpose})]}),e.jsx("p",{className:"tech-description",children:g.description}),e.jsx("div",{className:"tech-features",children:g.features.map((c,f)=>e.jsx("span",{className:"tech-feature-tag",children:c},f))})]},d))})},l.category))]})]}),e.jsxs("section",{className:"section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{className:"section-title",children:"System Architecture"}),e.jsx("p",{className:"section-subtitle",children:"How the platform works from authentication to result generation"})]}),e.jsx("div",{className:"architecture-flow",children:n.map((l,g)=>e.jsxs(ve.Fragment,{children:[e.jsxs(V,{className:"architecture-card",children:[e.jsx("div",{className:"architecture-step",children:l.step}),e.jsx("div",{className:"architecture-icon",children:l.icon}),e.jsx("h3",{className:"architecture-title",children:l.title}),e.jsx("p",{className:"architecture-description",children:l.description})]}),g<n.length-1&&e.jsx("div",{className:"architecture-arrow",children:"‚Üí"})]},l.step))})]}),e.jsx("section",{className:"section",children:e.jsx(V,{className:"stats-banner",children:e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Le,{})}),e.jsx("div",{className:"stat-value",children:"6"}),e.jsx("div",{className:"stat-label",children:"Anti-Cheat Layers"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ys,{})}),e.jsx("div",{className:"stat-value",children:"20+"}),e.jsx("div",{className:"stat-label",children:"Technologies"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Nt,{})}),e.jsx("div",{className:"stat-value",children:"50ms"}),e.jsx("div",{className:"stat-label",children:"Detection Speed"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(gt,{})}),e.jsx("div",{className:"stat-value",children:"99.9%"}),e.jsx("div",{className:"stat-label",children:"Accuracy"})]})]})})}),e.jsx("section",{className:"credits-section",children:e.jsxs(V,{className:"credits-banner",children:[e.jsx(Le,{className:"credits-logo"}),e.jsxs("div",{className:"credits-content",children:[e.jsx("h2",{children:"Developed by Pentacore Solutions"}),e.jsx("p",{children:"A comprehensive quiz platform with advanced anti-cheat features, built with modern web technologies and AI-powered proctoring"}),e.jsxs("div",{className:"credits-meta",children:[e.jsx("span",{children:"Version 2.0.0"}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:"¬© 2025 Pentacore Solutions"})]})]})]})})]})]})},Wr=()=>{const a=pe(),t=je(),{user:s}=J(y=>y.auth),{list:r,listStatus:i}=J(y=>y.results),n=m.useMemo(()=>Te(s),[s]);m.useEffect(()=>{n&&a(Ce(n))},[a,n]);const l=m.useMemo(()=>n?r.filter(y=>(y.status==="submitted"||y.status==="completed")&&Ie(y)===n):[],[r,n]),g=l.length,d=g>0?Math.round(l.reduce((y,M)=>y+(M.score||0),0)/g):null,c=l.filter(y=>(y.score||0)>=70).length,f=d===null?"Getting Started":d>=70?"Excellent":d>=50?"Good":"Improving";return e.jsxs("div",{className:"dashboard-page",children:[e.jsxs("section",{className:"dashboard-hero",style:{paddingBottom:"2rem"},children:[e.jsx("div",{className:"hero-gradient"}),e.jsx("div",{className:"container",children:e.jsxs("div",{className:"hero-content",children:[e.jsxs(se,{variant:"outline",onClick:()=>t("/dashboard"),style:{marginBottom:"1rem",width:"fit-content"},children:[e.jsx(ot,{size:16}),"Back to Dashboard"]}),e.jsxs("div",{className:"welcome-section",children:[e.jsxs("h1",{className:"welcome-title",children:["My ",e.jsx("span",{className:"gradient-text",children:"Quiz Attempts"})]}),e.jsx("p",{className:"welcome-subtitle",children:"View all your attempted quizzes and track your progress"})]}),e.jsxs("div",{className:"stats-cards",children:[e.jsxs(V,{className:"stat-card stat-card--blue",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(fe,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:g}),e.jsx("div",{className:"stat-label",children:"Total Attempts"})]})]}),e.jsxs(V,{className:"stat-card stat-card--green",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(be,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:c}),e.jsx("div",{className:"stat-label",children:"Passed Quizzes"})]})]}),e.jsxs(V,{className:"stat-card stat-card--purple",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Ve,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:d===null?"‚Äî":`${d}%`}),e.jsx("div",{className:"stat-label",children:"Average Score"})]})]}),e.jsxs(V,{className:"stat-card stat-card--orange",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Me,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:f}),e.jsx("div",{className:"stat-label",children:"Performance"})]})]})]})]})})]}),e.jsx("div",{className:"container dashboard-content",children:i==="loading"?e.jsxs("div",{className:"empty-state",children:[e.jsx(ke,{size:64,className:"empty-icon"}),e.jsx("h3",{children:"Loading your attempts..."})]}):l.length>0?e.jsx("section",{className:"section",style:{marginTop:0},children:e.jsx("div",{className:"quizzes-grid",children:l.map(y=>{var B;const M=((B=y.quiz)==null?void 0:B.title)||"Untitled Quiz",A=typeof y.score=="number"?Math.round(y.score):null,R=y.status==="submitted"&&(y.requiresManualReview||y.manuallyGraded===!1)?"Awaiting grading":A!==null?`${A}%`:"Pending",w=A!==null?A>=70?"score-high":A>=50?"score-mid":"score-low":"score-mid",_=y.submittedAt||y.updatedAt||y.createdAt,N=y.proctoringLog&&y.proctoringLog.length>0;return e.jsxs(V,{className:"quiz-card",children:[e.jsxs("div",{className:"quiz-card-header",children:[e.jsx("div",{className:"quiz-icon",children:e.jsx(be,{})}),e.jsx("h3",{className:"quiz-title",children:M})]}),e.jsxs("div",{className:"quiz-result-info",children:[e.jsxs("div",{className:"result-score-section",children:[e.jsx("span",{className:"result-score-label",children:"Score:"}),e.jsx("span",{className:`result-score ${w}`,children:R})]}),e.jsxs("div",{className:"quiz-meta",children:[e.jsxs("span",{className:"quiz-created",children:[e.jsx(ke,{size:14}),_&&new Date(_).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),N&&e.jsxs("span",{className:"quiz-alerts",children:[e.jsx(ze,{size:14}),y.proctoringLog.length," alerts"]})]})]}),e.jsxs("div",{className:"quiz-actions",children:[e.jsxs(se,{variant:"outline",size:"sm",onClick:()=>t(`/results/${y._id}`),style:{flex:1},children:[e.jsx(Re,{size:16}),"View Details"]}),e.jsxs(se,{variant:"primary",size:"sm",onClick:()=>{var E;return t(`/quiz/${((E=y.quiz)==null?void 0:E._id)||y.quiz}`)},style:{flex:1},children:[e.jsx(fe,{size:16}),"Retake"]})]})]},y._id)})})}):e.jsxs("div",{className:"empty-state",children:[e.jsx(be,{size:64,className:"empty-icon"}),e.jsx("h3",{children:"No Quiz Attempts Yet"}),e.jsx("p",{children:"Start taking quizzes to see your attempts here"}),e.jsxs(se,{variant:"primary",onClick:()=>t("/dashboard"),children:[e.jsx(fe,{size:18}),"Browse Quizzes"]})]})})]})},_r=()=>{const a=pe(),t=je(),{user:s}=J(S=>S.auth),{list:r,listStatus:i}=J(S=>S.results),n=(s==null?void 0:s.role)==="admin",l=(s==null?void 0:s.role)==="instructor",g=m.useMemo(()=>Te(s),[s]);m.useEffect(()=>{s&&(n||l?a(Ee()):g&&a(Ce(g)))},[a,s,n,l,g]);const d=m.useMemo(()=>Array.isArray(r)?n?r:l?r.filter(S=>{const R=Oe(S==null?void 0:S.quiz);return g&&R===g}):g?r.filter(S=>Ie(S)===g):r:[],[r,n,l,g]),c=m.useMemo(()=>d.filter(R=>R.status==="submitted"||R.status==="completed").sort((R,w)=>{const _=new Date(R.submittedAt||R.updatedAt||R.createdAt);return new Date(w.submittedAt||w.updatedAt||w.createdAt)-_}).slice(0,20),[d]),f=c.length,y=f>0?Math.round(c.reduce((S,R)=>S+(R.score||0),0)/f):null,M=c.filter(S=>(S.score||0)>=80).length,A=c.reduce((S,R)=>{var w;return S+(((w=R.proctoringLog)==null?void 0:w.length)||0)},0);return e.jsxs("div",{className:"dashboard-page",children:[e.jsxs("section",{className:"dashboard-hero",style:{paddingBottom:"2rem"},children:[e.jsx("div",{className:"hero-gradient"}),e.jsx("div",{className:"container",children:e.jsxs("div",{className:"hero-content",children:[e.jsxs(se,{variant:"outline",onClick:()=>t("/dashboard"),style:{marginBottom:"1rem",width:"fit-content"},children:[e.jsx(ot,{size:16}),"Back to Dashboard"]}),e.jsxs("div",{className:"welcome-section",children:[e.jsxs("h1",{className:"welcome-title",children:["Recent ",e.jsx("span",{className:"gradient-text",children:"Activity"})]}),e.jsx("p",{className:"welcome-subtitle",children:n?"Latest quiz submissions across all students":l?"Learner activity across the quizzes you manage":"Your recent quiz submissions and performance"})]}),e.jsxs("div",{className:"stats-cards",children:[e.jsxs(V,{className:"stat-card stat-card--blue",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(st,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:f}),e.jsx("div",{className:"stat-label",children:"Total Submissions"})]})]}),e.jsxs(V,{className:"stat-card stat-card--green",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(be,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:M}),e.jsx("div",{className:"stat-label",children:"High Scores (80%+)"})]})]}),e.jsxs(V,{className:"stat-card stat-card--purple",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Ve,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:y===null?"‚Äî":`${y}%`}),e.jsx("div",{className:"stat-label",children:"Average Score"})]})]}),e.jsxs(V,{className:"stat-card stat-card--orange",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ze,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:A}),e.jsx("div",{className:"stat-label",children:"Total Alerts"})]})]})]})]})})]}),e.jsx("div",{className:"container dashboard-content",children:i==="loading"?e.jsxs("div",{className:"empty-state",children:[e.jsx(ke,{size:64,className:"empty-icon"}),e.jsx("h3",{children:"Loading activity..."})]}):c.length>0?e.jsx("section",{className:"section",style:{marginTop:0},children:e.jsx(V,{className:"activity-card",children:e.jsx("div",{className:"activity-list",children:c.map((S,R)=>{var E,$;const w=((E=S.quiz)==null?void 0:E.title)||"Untitled Quiz",_=S.score||0,N=(($=S.user)==null?void 0:$.username)||"Student",B=S.submittedAt||S.updatedAt||S.createdAt;return e.jsxs("div",{className:"activity-item",children:[e.jsx("div",{className:"activity-icon",children:e.jsx(be,{})}),e.jsxs("div",{className:"activity-info",children:[e.jsxs("div",{className:"activity-title",children:[w,(n||l)&&e.jsxs("span",{className:"activity-user",children:[" by ",N]})]}),e.jsxs("div",{className:"activity-meta",children:[e.jsxs("span",{className:"activity-score",children:[_,"%"]}),B&&e.jsxs("span",{className:"activity-date",children:[new Date(B).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})," at ",new Date(B).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]}),S.proctoringLog&&S.proctoringLog.length>0&&e.jsxs("span",{className:"activity-alerts",children:[e.jsx(ze,{size:14}),S.proctoringLog.length," alerts"]})]})]}),(n||l)&&e.jsxs(se,{variant:"outline",size:"sm",onClick:()=>t(`/results/${S._id}`),children:[e.jsx(Re,{size:14}),"Review"]}),!n&&!l&&e.jsx("div",{className:`activity-badge ${_>=70?"success":_>=50?"warning":"danger"}`,children:_>=70?"Pass":_>=50?"Average":"Needs Review"})]},S._id||R)})})})}):e.jsxs("div",{className:"empty-state",children:[e.jsx(st,{size:64,className:"empty-icon"}),e.jsx("h3",{children:"No Activity Yet"}),e.jsx("p",{children:n?"Quiz submissions will appear here":l?"Learner submissions will appear here once your quizzes are completed":"Start taking quizzes to see your activity"}),e.jsx(se,{variant:"primary",onClick:()=>t("/dashboard"),children:"Browse Quizzes"})]})})]})},Ur=()=>{const a=pe(),t=je(),{user:s}=J(j=>j.auth),{items:r,status:i}=J(j=>j.quizzes),{list:n}=J(j=>j.results),[l,g]=m.useState(null),d=(s==null?void 0:s.role)==="admin",c=(s==null?void 0:s.role)==="instructor",f=m.useMemo(()=>Te(s),[s]);m.useEffect(()=>{a(De())},[a]),m.useEffect(()=>{s&&(d||c?a(Ee()):f&&a(Ce(f)))},[a,s,d,c,f]);const y=(j,K)=>{l===j?(a(yt(j)),g(null)):(g(j),setTimeout(()=>g(null),3e3))},M=(j,K)=>{a(bt({quizId:j,isPublished:!K}))},A=m.useMemo(()=>!c||!f?[]:r.filter(j=>Oe(j)===f),[r,c,f]),S=m.useMemo(()=>d?r:c?A:r.filter(j=>j.isPublished),[r,d,c,A]),R=d?r.length:c?A.length:r.filter(j=>j.isPublished).length,w=m.useMemo(()=>d||c?n:f?n.filter(j=>Ie(j)===f):n,[n,d,c,f]),_=w.filter(j=>j.status==="submitted"||j.status==="completed"),N=new Set;_.forEach(j=>{const K=rt(j.quiz);K&&N.add(K)});const B=N.size,E=Math.max(0,R-B),$=R>0?Math.round(B/R*100):0,U=d?r.filter(j=>!j.isPublished).length:c?A.filter(j=>!j.isPublished).length:0,O=d?r.filter(j=>j.isPublished).length:c?A.filter(j=>j.isPublished).length:0;return e.jsxs("div",{className:"dashboard-page",children:[e.jsxs("section",{className:"dashboard-hero",style:{paddingBottom:"2rem"},children:[e.jsx("div",{className:"hero-gradient"}),e.jsx("div",{className:"container",children:e.jsxs("div",{className:"hero-content",children:[e.jsxs(se,{variant:"outline",onClick:()=>t("/dashboard"),style:{marginBottom:"1rem",width:"fit-content"},children:[e.jsx(ot,{size:16}),"Back to Dashboard"]}),e.jsxs("div",{className:"welcome-section",children:[e.jsxs("h1",{className:"welcome-title",children:[d?"All":c?"Manage":"Available"," ",e.jsx("span",{className:"gradient-text",children:"Quizzes"})]}),e.jsx("p",{className:"welcome-subtitle",children:d?"Create, edit, and manage all quizzes":c?"Design assessments, monitor drafts, and track learner progress":"Choose a quiz to start your assessment"})]}),e.jsxs("div",{className:"stats-cards",children:[e.jsxs(V,{className:"stat-card stat-card--blue",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(fe,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:R}),e.jsx("div",{className:"stat-label",children:d?"Total Quizzes":c?"My Quizzes":"Available Quizzes"})]})]}),d||c?e.jsxs(e.Fragment,{children:[e.jsxs(V,{className:"stat-card stat-card--green",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(be,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:O}),e.jsx("div",{className:"stat-label",children:"Published"})]})]}),e.jsxs(V,{className:"stat-card stat-card--orange",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ke,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:U}),e.jsx("div",{className:"stat-label",children:"Drafts"})]})]}),e.jsxs(V,{className:"stat-card stat-card--purple",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Ve,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:w.length}),e.jsx("div",{className:"stat-label",children:c?"Learner Submissions":"Total Submissions"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(V,{className:"stat-card stat-card--green",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(be,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:B}),e.jsx("div",{className:"stat-label",children:"Completed"})]})]}),e.jsxs(V,{className:"stat-card stat-card--orange",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(ke,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"stat-value",children:E}),e.jsx("div",{className:"stat-label",children:"Remaining"})]})]}),e.jsxs(V,{className:"stat-card stat-card--purple",children:[e.jsx("div",{className:"stat-icon",children:e.jsx(Me,{})}),e.jsxs("div",{className:"stat-info",children:[e.jsxs("div",{className:"stat-value",children:[$,"%"]}),e.jsx("div",{className:"stat-label",children:"Progress"})]})]})]})]})]})})]}),e.jsxs("div",{className:"container dashboard-content",children:[(d||c)&&e.jsx("div",{style:{marginBottom:"2rem",marginTop:0},children:e.jsxs(se,{variant:"primary",onClick:()=>t("/manage-quiz"),size:"lg",children:[e.jsx(He,{size:18}),"Create New Quiz"]})}),i==="loading"?e.jsxs("div",{className:"empty-state",children:[e.jsx(ke,{size:64,className:"empty-icon"}),e.jsx("h3",{children:"Loading quizzes..."})]}):S.length>0?e.jsx("section",{className:"section",style:{marginTop:0},children:e.jsx("div",{className:"quizzes-grid",children:S.map(j=>{var C;const K=j._id,p=_.some(h=>rt(h.quiz)===String(K));return e.jsxs(V,{className:"quiz-card",children:[e.jsxs("div",{className:"quiz-card-header",children:[e.jsx("div",{className:"quiz-icon",children:e.jsx(fe,{})}),e.jsx("h3",{className:"quiz-title",children:j.title})]}),j.description&&e.jsx("p",{className:"quiz-description",children:j.description}),(d||c)&&e.jsxs("div",{className:"quiz-publish-toggle",onClick:h=>h.stopPropagation(),children:[e.jsxs("label",{className:"publish-switch",children:[e.jsx("input",{type:"checkbox",checked:j.isPublished,onChange:()=>M(j._id,j.isPublished)}),e.jsx("span",{className:"publish-slider"})]}),e.jsx("span",{className:`publish-label ${j.isPublished?"published":"draft"}`,children:j.isPublished?"‚úÖ Published":"üîí Draft"})]}),e.jsxs("div",{className:"quiz-meta",children:[e.jsxs("span",{className:"quiz-questions",children:[e.jsx(fe,{size:14}),((C=j.questions)==null?void 0:C.length)||0," questions"]}),(d||c)&&e.jsxs("span",{className:"quiz-created",children:[e.jsx(ke,{size:14}),new Date(j.createdAt).toLocaleDateString()]})]}),d||c?e.jsxs("div",{className:"quiz-admin-actions",children:[e.jsxs(se,{variant:"primary",size:"sm",onClick:()=>t(`/manage-quiz?edit=${j._id}`),style:{flex:1},children:[e.jsx(Ns,{size:16}),"Edit"]}),e.jsxs(se,{variant:l===j._id?"danger":"outline",size:"sm",onClick:h=>{h.stopPropagation(),y(j._id,j.title)},style:{flex:1},children:[e.jsx(Bt,{size:16}),l===j._id?"Confirm?":"Delete"]})]}):e.jsx(se,{variant:"primary",size:"sm",className:"quiz-start-btn",onClick:()=>t(`/quiz/${j._id}`),children:p?"Retake Quiz":"Start Quiz"})]},j._id)})})}):e.jsxs("div",{className:"empty-state",children:[e.jsx(fe,{size:64,className:"empty-icon"}),e.jsx("h3",{children:"No Quizzes Available"}),e.jsx("p",{children:d||c?"Create your first quiz to get started":"Check back later for new quizzes"}),(d||c)&&e.jsxs(se,{variant:"primary",onClick:()=>t("/manage-quiz"),children:[e.jsx(He,{size:18}),"Create Quiz"]})]})]})]})},$r=(a={})=>{const t=new URLSearchParams;Object.entries(a).forEach(([r,i])=>{i!=null&&i!==""&&t.append(r,i)});const s=t.toString();return s?`?${s}`:""},Pe=ce("admin/fetchUsers",async(a={},{rejectWithValue:t})=>{var s;try{const r=$r({role:"student",limit:100,...a}),{data:i}=await ie.get(`/api/admin/users${r}`);return i.users}catch(r){return t(((s=r.response)==null?void 0:s.data)||{message:"Unable to load users"})}}),Ze=ce("admin/uploadReferenceFace",async({email:a,descriptor:t,photoData:s},{rejectWithValue:r})=>{var i;try{const{data:n}=await ie.post("/api/admin/users/reference-face",{email:a,descriptor:t,photoData:s});return n.user}catch(n){return r(((i=n.response)==null?void 0:i.data)||{message:"Failed to store reference face"})}}),Xt=at({name:"admin",initialState:{users:[],listStatus:"idle",listError:null,uploadStatus:"idle",uploadError:null,lastUpdatedUserId:null},reducers:{resetUploadState(a){a.uploadStatus="idle",a.uploadError=null,a.lastUpdatedUserId=null}},extraReducers:a=>{a.addCase(Pe.pending,t=>{t.listStatus="loading",t.listError=null}).addCase(Pe.fulfilled,(t,s)=>{t.listStatus="succeeded",t.users=s.payload}).addCase(Pe.rejected,(t,s)=>{var r;t.listStatus="failed",t.listError=((r=s.payload)==null?void 0:r.message)||"Unable to load users"}).addCase(Ze.pending,t=>{t.uploadStatus="loading",t.uploadError=null,t.lastUpdatedUserId=null}).addCase(Ze.fulfilled,(t,s)=>{var r,i;if(t.uploadStatus="succeeded",t.uploadError=null,t.lastUpdatedUserId=((r=s.payload)==null?void 0:r.id)||null,(i=s.payload)!=null&&i.id){const n=t.users.findIndex(l=>l.id===s.payload.id);n>=0?t.users[n]=s.payload:t.users.push(s.payload)}}).addCase(Ze.rejected,(t,s)=>{var r;t.uploadStatus="failed",t.uploadError=((r=s.payload)==null?void 0:r.message)||"Failed to store reference face"})}}),{resetUploadState:qr}=Xt.actions,Hr=Xt.reducer,Vr=8*1024*1024,Or=a=>{if(!a)return"‚Äî";try{const t=typeof a=="string"?new Date(a):a;return new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)}catch{return a}},Qr=()=>{const a=pe(),t=m.useRef(null),[s,r]=m.useState(""),[i,n]=m.useState(null),[l,g]=m.useState(""),[d,c]=m.useState(null),[f,y]=m.useState("idle"),[M,A]=m.useState(""),[S,R]=m.useState(null),[w,_]=m.useState(!1),{users:N,listStatus:B,listError:E,uploadStatus:$,uploadError:U,lastUpdatedUserId:O}=J(o=>o.admin),j=m.useMemo(()=>i&&N.find(o=>Te(o)===i)||null,[i,N]);m.useEffect(()=>{a(Pe())},[a]),m.useEffect(()=>{if(s==="")return;const o=setTimeout(()=>{a(Pe({search:s}))},350);return()=>clearTimeout(o)},[a,s]),m.useEffect(()=>{$==="succeeded"&&O&&(a(Pe({search:s})),y("success"),A(""),c(null),R(null),t.current&&(t.current.value=""),a(qr()))},[a,O,s,$]);const K=async()=>{if(!w){console.log("üì¶ Loading face-api models...");try{await ct(),_(!0),console.log("‚úÖ Face-api models loaded successfully")}catch(o){throw console.error("‚ùå Failed to load face-api models:",o),new Error(`Failed to load face detection models: ${o.message}`)}}},p=async o=>{if(!o)return;if(!j){A("Select a student before uploading a photo.");return}if(o.size>Vr){A("Photo is too large. Choose an image under 8MB.");return}y("processing"),A(""),c(null),R(null);const x=new FileReader;x.onload=async()=>{try{const u=x.result;g(String(u)),console.log("üîÑ Ensuring models are loaded..."),await K(),console.log("üñºÔ∏è Fetching image element...");const b=await xe.fetchImage(String(u));console.log("üë§ Detecting faces...");const D=await xe.detectAllFaces(b,new xe.TinyFaceDetectorOptions({inputSize:416,scoreThreshold:.5})).withFaceLandmarks(!0).withFaceDescriptors();if(console.log(`‚úÖ Detection complete. Found ${(D==null?void 0:D.length)||0} face(s)`),!D||D.length===0){y("idle"),A("No face detected in the uploaded photo. Try a different image with better lighting.");return}if(D.length>1){y("idle"),A("Multiple faces detected. Upload a photo containing only the student.");return}const I=D[0].descriptor,Z=Array.from(I);if(c({raw:Z,dataUrl:String(u)}),j!=null&&j.referenceDescriptor){const Y=new Float32Array(j.referenceDescriptor),F=xe.euclideanDistance(Y,new Float32Array(Z));R(F)}y("ready")}catch(u){y("idle"),A((u==null?void 0:u.message)||"Unable to analyze the photo. Please try again.")}},x.onerror=()=>{y("idle"),A("Unable to read the file. Please choose a different image.")},x.readAsDataURL(o)},C=async()=>{if(!j){A("Select a student before uploading a photo.");return}if(!(d!=null&&d.raw)||!d.dataUrl){A("Process a photo to generate a descriptor before saving.");return}try{await a(Ze({email:j.email,descriptor:d.raw,photoData:d.dataUrl})).unwrap()}catch(o){y("idle"),A((o==null?void 0:o.message)||"Failed to store the reference photo.")}},h=o=>{const x={padding:"0.25rem 0.6rem",borderRadius:"999px",fontSize:"0.75rem",display:"inline-flex",alignItems:"center",gap:"0.35rem"};return o.hasReferenceFace?e.jsxs("span",{style:{...x,background:"#dcfce7",color:"#166534"},children:[e.jsx("span",{"aria-hidden":!0,children:"‚óè"}),"Verified reference"]}):e.jsxs("span",{style:{...x,background:"#fee2e2",color:"#b91c1c"},children:[e.jsx("span",{"aria-hidden":!0,children:"‚óè"}),"Reference missing"]})};return e.jsxs("section",{className:"card",style:{marginBottom:"2rem"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0},children:"Identity reference center"}),e.jsx("p",{style:{color:"#64748b",marginTop:"0.25rem"},children:"Upload administrator-approved photos to verify students before and during proctoring."})]})}),e.jsxs("div",{style:{marginTop:"1.5rem",display:"grid",gap:"1.5rem",gridTemplateColumns:"minmax(260px, 1fr) 2fr"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"identity-search",style:{display:"block",fontSize:"0.85rem",color:"#64748b"},children:"Search students"}),e.jsx("input",{id:"identity-search",type:"search",placeholder:"Search by name or email",value:s,onChange:o=>r(o.target.value)})]}),e.jsxs("div",{style:{border:"1px solid rgba(148, 163, 184, 0.25)",borderRadius:"12px",overflow:"hidden",maxHeight:360,display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{padding:"0.75rem 1rem",background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:e.jsx("strong",{style:{fontSize:"0.85rem",color:"#475569"},children:"Students"})}),e.jsxs("div",{style:{flex:1,overflowY:"auto"},children:[B==="loading"&&e.jsx("p",{style:{padding:"1rem"},children:"Loading students‚Ä¶"}),B==="failed"&&e.jsx("p",{style:{padding:"1rem",color:"#ef4444"},children:E||"Unable to load students."}),B==="succeeded"&&N.length===0&&e.jsx("p",{style:{padding:"1rem",color:"#94a3b8"},children:"No students found. Try adjusting your search."}),B==="succeeded"&&N.length>0&&e.jsx("ul",{style:{listStyle:"none",margin:0,padding:0},children:N.map(o=>{const x=Te(o),u=x&&x===i;return e.jsx("li",{style:{borderBottom:"1px solid #e2e8f0",background:u?"#eff6ff":"#fff",cursor:"pointer"},children:e.jsxs("button",{type:"button",onClick:()=>{x&&n(x),y("idle"),A(""),c(null),R(null),g(""),t.current&&(t.current.value="")},style:{display:"flex",flexDirection:"column",width:"100%",padding:"0.9rem 1rem",textAlign:"left",gap:"0.35rem",background:"transparent",border:"none"},children:[e.jsx("span",{style:{fontWeight:600,color:"#0f172a"},children:o.username}),e.jsx("span",{style:{fontSize:"0.85rem",color:"#64748b"},children:o.email}),h(o)]})},x||o.email)})})]})]})]}),e.jsx("div",{style:{border:"1px solid rgba(148, 163, 184, 0.25)",borderRadius:"12px",padding:"1.5rem"},children:j?e.jsxs("div",{style:{display:"grid",gap:"1.5rem",gridTemplateColumns:"1fr 1fr",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{marginTop:0},children:"Selected student"}),e.jsxs("p",{style:{color:"#475569"},children:[j.username,e.jsx("br",{}),e.jsx("span",{style:{color:"#94a3b8",fontSize:"0.85rem"},children:j.email})]}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("p",{style:{color:"#64748b",fontSize:"0.85rem",marginBottom:"0.25rem"},children:"Current reference"}),j.referencePhoto?e.jsx("img",{src:j.referencePhoto,alt:`Reference for ${j.username}`,style:{width:"100%",maxWidth:220,borderRadius:"12px",border:"1px solid #e2e8f0"}}):e.jsx("div",{style:{width:"100%",maxWidth:220,height:160,borderRadius:"12px",border:"1px dashed #cbd5f5",display:"grid",placeItems:"center",color:"#94a3b8",fontSize:"0.85rem"},children:"No reference uploaded"}),e.jsxs("p",{style:{color:"#94a3b8",fontSize:"0.8rem",marginTop:"0.5rem"},children:["Last updated: ",Or(j.referenceUploadedAt)]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{marginTop:0},children:"Upload new reference"}),e.jsx("p",{style:{color:"#64748b",fontSize:"0.9rem"},children:"Use a well-lit, front-facing photo with the student alone. We'll automatically validate and extract the biometric descriptor before storing it securely."}),e.jsx("label",{htmlFor:"reference-photo",style:{display:"inline-block",padding:"0.75rem 1.5rem",borderRadius:"12px",border:"1px dashed #2563eb",color:"#2563eb",cursor:"pointer",fontWeight:600,marginBottom:"0.75rem"},children:"Choose photo"}),e.jsx("input",{id:"reference-photo",ref:t,type:"file",accept:"image/*",style:{display:"none"},onChange:o=>{var x;return p(((x=o.target.files)==null?void 0:x[0])||null)}}),l&&e.jsxs("div",{style:{marginTop:"0.75rem"},children:[e.jsx("p",{style:{color:"#94a3b8",fontSize:"0.8rem",marginBottom:"0.25rem"},children:"Detected preview"}),e.jsx("img",{src:l,alt:"Uploaded preview",style:{width:"100%",maxWidth:220,borderRadius:"12px",border:"1px solid #e2e8f0"}})]}),f==="processing"&&e.jsx("p",{style:{color:"#2563eb",marginTop:"0.75rem"},children:"Analyzing face‚Ä¶"}),M&&e.jsx("p",{style:{color:"#ef4444",marginTop:"0.75rem"},role:"alert",children:M}),S!==null&&e.jsxs("p",{style:{color:"#475569",fontSize:"0.85rem",marginTop:"0.75rem"},children:["Distance from existing reference: ",e.jsx("strong",{children:S.toFixed(3)})]}),e.jsx("button",{type:"button",className:"primary-btn",onClick:C,disabled:f!=="ready"||$==="loading",style:{marginTop:"1rem"},children:$==="loading"?"Saving‚Ä¶":"Save reference"}),U&&e.jsx("p",{style:{color:"#ef4444",marginTop:"0.75rem"},role:"alert",children:U}),f==="success"&&e.jsx("p",{style:{color:"#166534",marginTop:"0.75rem"},children:"Reference updated successfully."})]})]}):e.jsx("div",{style:{color:"#94a3b8",minHeight:180},children:e.jsx("p",{children:"Select a student to begin uploading a reference photo."})})})]})]})},Gr=()=>{const a=pe(),{user:t,token:s}=J(l=>l.auth),r=m.useRef(!1),i=t&&t.role==="student"&&!!t.hasReferenceFace&&!t.isFaceVerified,n=t&&t.role==="student"&&!t.hasReferenceFace;return m.useEffect(()=>{if(!s){r.current=!1;return}r.current||(r.current=!0,a(Ke()))},[a,s]),e.jsxs("div",{className:"app-shell",children:[e.jsx(tr,{}),e.jsx("main",{className:"main-content",children:e.jsxs(ns,{children:[e.jsx(me,{path:"/",element:e.jsx(ir,{})}),e.jsx(me,{path:"/about",element:e.jsx(Br,{})}),e.jsx(me,{path:"/login",element:e.jsx(ar,{})}),e.jsx(me,{path:"/register",element:e.jsx(nr,{})}),e.jsx(me,{path:"/face-enrollment",element:e.jsx(we,{children:e.jsx(xr,{})})}),e.jsx(me,{path:"/dashboard",element:e.jsx(we,{children:i||n?e.jsx(jt,{to:"/face-enrollment",replace:!0}):e.jsx(gr,{})})}),e.jsx(me,{path:"/quiz/:quizId",element:e.jsx(we,{children:e.jsx(Dr,{})})}),e.jsx(me,{path:"/dashboard/quizzes/:quizId",element:e.jsx(we,{children:e.jsx(Dt,{})})}),e.jsx(me,{path:"/results",element:e.jsx(we,{children:e.jsx(Er,{})})}),e.jsx(me,{path:"/results/:resultId",element:e.jsx(we,{children:e.jsx(Lr,{})})}),e.jsx(me,{path:"/my-attempts",element:e.jsx(we,{children:e.jsx(Wr,{})})}),e.jsx(me,{path:"/activity",element:e.jsx(we,{children:e.jsx(_r,{})})}),e.jsx(me,{path:"/quizzes",element:e.jsx(we,{children:e.jsx(Ur,{})})}),e.jsx(me,{path:"/manage-quiz",element:e.jsx(we,{children:e.jsx(Dt,{})})}),e.jsx(me,{path:"/admin/references",element:e.jsx(we,{children:e.jsx(Qr,{})})})]})}),e.jsx(sr,{})]})},Yr=is({reducer:{auth:Zs,quizzes:lr,results:cr,admin:Hr}});es.createRoot(document.getElementById("root")).render(e.jsx(ve.StrictMode,{children:e.jsx(ts,{store:Yr,children:e.jsx(rs,{children:e.jsx(Gr,{})})})}));
